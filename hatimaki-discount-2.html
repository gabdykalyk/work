<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Добавление кампании</title>
    <!-- Bootstrap -->
    <link href="bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- Icons -->
    <link href="fonts/fontawesome/css/all.css" rel="stylesheet">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel="stylesheet">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.4/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css" />

    <link href="css/styles.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body>
    <nav class="navbar navbar-fixed-top navbar-lk">
        <div class="container-fluid">
            <div class="navbar-collapse collapse" id="navbar-collapse-block">
                <ul class="nav navbar-nav navbar-nav-main">
                    <li class="item-menu-manper active"><a href="#">Расчёты<span class="count">1</span></a></li>
                    <li class="item-menu-messages"><a href="#">Новый расчёт<span class="count">5</span></a></li>
                    <li class="item-menu-alerts"><a href="#">Штрафы/Премии<span class="count">2</span></a></li>
                    <li class="item-menu-schedule"><a href="#">Приказы/Инструкции</a></li>
                    <li class="item-menu-index"><a href="#">Кадры<span class="count">3</span></a></li>
                    <li class="item-menu-docs"><a href="#">Отчёты<span class="count">1</span></a></li>
                    <li class="item-menu-discus"><a href="#">Обсуждения<span class="count">4</span></a></li>
                    <li class="item-menu-complaints"><a href="#">Жалобы и предложения<span class="count">1</span></a></li>
                    <li class="item-menu-friends"><a href="#">Друзья</a></li>
                    <li class="item-menu-groups"><a href="#">Группы</a></li>
                    <li class="item-menu-settings"><a href="#">Настройки</a></li>
                    <li class="item-menu-help"><a href="#">Помощь</a></li>
                </ul>
            </div>
            <button type="button" class="navbar-toggle collapsed" id="navbar-toggle">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <i class="fa fa-chevron-left" aria-hidden="true"></i>
            </button>
            <div class="navbar-right navbar-login">
                <a href="#" class="btn"><span>Александр Константиновский</span> <i class="fa fa-sign-out hidden-sm hidden-xs" aria-hidden="true"></i></a>
            </div>
            <ul class="nav navbar-nav navbar-right navbar-nav-social">
                <li><a href="#" title="Вконтакте"><i class="fab fa-vk" aria-hidden="true"></i></a></li>
                <li><a href="#" title="Есть непросмотренные сообщения"><i class="fa fa-envelope" aria-hidden="true"></i><span class="badge"></span></a></li>
                <li class="item-bell" title="Есть непросмотренные уведомления"><a href="#"><i class="fa fa-bell" aria-hidden="true"></i><span class="badge"></span></a></li>
            </ul>
        </div>
    </nav>

    <div class="container-fluid content discount">

        <h1>
            Добавление кампании
        </h1>
        <hr class="hr-margin hr-xs-100 hidden-xs">
		<div class="btn-group" role="group">
			<a href="#" type="button" class="btn btn-default">Основные настройки</a>
			<a href="#" type="button" class="btn btn-default active">Свойства</a>
			<a href="#" type="button" class="btn btn-default">Действия</a>
		</div>
		<form class="form-respons discount__props js-discount-form" action="" method="post">
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-4 form-group">
					<label for="actiontype">Тип акции</label>
					<select class="form-control js-action-type" name="actiontype">
						<option value="promocode">Промокод</option>
						<option value="requirement">Условие</option>
						<option value="both" selected="">Промокод и условие</option>
					</select>
				</div>
				<div class="clearfix visible-lg visible-md"></div>
				<div class="js-promocode-block">
					<div class="col-sm-12">
						<h3>Промокод</h3>
					</div>
					<div class="col-lg-2 col-md-2 col-sm-3 col-xs-6 form-group">
	                    <label for="number_of_coupons">Кол-во купонов</label>
	                    <input class="form-control" type="text" name="number_of_coupons" id="number_of_coupons" />		
					</div>
					<div class="col-lg-3 col-md-3 col-sm-4 col-xs-6 form-group">
						<label for="actiontype">Тип купона</label>
						<select class="form-control" name="actiontype">
							<option value="promocode">Разовый</option>
							<option value="requirement">Многоповторный</option>
						</select>
					</div>
					<div class="clearfix visible-lg visible-md visible-sm"></div>
					<div class="col-lg-2 col-md-2 col-sm-3 col-xs-4 form-group">
	                    <label for="prefix">Префикс купонов</label>
	                    <input class="form-control" type="text" name="prefix" id="prefix" />		
					</div>
					<div class="col-lg-3 col-md-3 col-sm-4 col-xs-7 form-group">
	                    <label class="full-width">Кол-во символов</label>
	                    <div class="discount__flex">
		                    <input class="form-control" type="text" name="letters" id="letters" /> 
		                    <label class="black-label" for="letters">букв</label>	
		                    <input class="form-control" type="text" name="numbers" id="numbers" />
		                    <label class="black-label" for="numbers">цифр</label>
						</div>
					</div>
					<div class="col-lg-3 col-md-3 col-sm-5 col-xs-8 form-group no-label discount__letters">
						<select class="form-control" name="which_letter">
							<option value="en">Английские буквы</option>
							<option value="ru">Русские буквы</option>
							<option value="en_ru">Английские и русские буквы</option>
						</select>
					</div>
				</div>
				<div class="clearfix visible-xs"></div>
				<div class="js-requirement-block">
					<div class="col-sm-12">
						<h3>Условие</h3>
					</div>
					<div class="col-lg-4 col-md-4 col-sm-6 form-group">
	                    <label for="condition_type">Тип условия</label>
	                    <select class="form-control js-select-multiple js-condition-type" name="condition_type[]" id="condition_type" multiple="" tabindex="-1" aria-hidden="true">
	                        <option value="time">Время</option>
	                        <option value="summ">Сумма заказа</option>
	                        <option value="order">Состав заказа</option>
	                    </select>
					</div>
				</div>
				<div class="js-time-block" style="display:none;">
					<div class="col-sm-12">
						<h4>Время</h4>
					</div>
					<div class="js-time-row">
						<div class="col-lg-4 col-md-4 col-sm-6 form-group">
		                    <label for="period">Период проведения</label>
							<select class="form-control" name="period">
								<option value="1">Определенные даты</option>
								<option value="2">Период</option>
								<option value="3">День недели</option>
								<option value="4" selected="">Нечетные числа месяца</option>
								<option value="5">Число месяца</option>
								<option value="6">Период месяца</option>
							</select>
						</div>
						<div class="col-lg-2 col-md-2 col-sm-3 discount__times no-label">
							<div class="form-group">
								<input type="text" class="form-control js-timework" value="" name="" id="timebeg" maxlength="5" placeholder="00:00">
							</div>
							<div class="form-group-dash">&ndash;</div>
							<div class="form-group">
								<input type="text" class="form-control js-timework" value="" name="" id="timeend" maxlength="5" placeholder="00:00">
							</div>
						</div>
						<div class="clearfix visible-sm"></div>
						<div class="col-lg-2 col-md-2 col-sm-3 col-xs-6 form-group">
							<label for="to-repeat">Повторять</label>
							<select class="form-control js-select-repeat" name="to-repeat">
								<option value="no-repeat">Не повторять</option>
								<option value="repeat" selected="">Кол-во повторов</option>
								<option value="all">Весь период акции</option>
							</select>
						</div>
						<div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 time-btn-block no-label">
							<div class="form-group js-repeat-block repeat-block">
								<input type="text" class="form-control" value="" name="num_repeats" id="num_repeats">
							</div>
							<div class="form-group hidden-sm">
								<button type="button" class="btn btn-danger btn-remove-row jsRemoveTime" title="Удалить" style="display: none;"><i class="fa fa-times" aria-hidden="true"></i></button>
								<button type="button" class="btn btn-success btn-add-row jsAddNewTime" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
							</div>
						</div>
						<div class="col-sm-3 visible-sm time-btn-block no-label">
							<div class="form-group visible-sm">
								<button type="button" class="btn btn-danger btn-remove-row jsRemoveTime" title="Удалить" style="display: none;"><i class="fa fa-times" aria-hidden="true"></i></button>
								<button type="button" class="btn btn-success btn-add-row jsAddNewTime" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
							</div>
						</div>
					</div>
					<div class="clearfix visible-xs"></div>
	            </div>
	            <div class="js-summ-block" style="display:none;">
					<div class="col-sm-12">
						<h4>Сумма заказа</h4>
					</div>
	                <div class="col-lg-3 col-md-3 col-sm-4 form-group discount__summ">
	                    <label for="sum_start">От</label>
	                    <input class="form-control" type="text" name="sum_start" id="sum_start" /> 
	                    <label for="sum_end">до</label>
	                    <input class="form-control" type="text" name="sum_end" id="sum_end" />
	                    <i class="fas fa-ruble-sign"></i>
					</div>
				</div>
				<div class="js-order-block order-block" style="display:none;">
					<div class="col-sm-12">
						<h4>Состав заказа</h4>
					</div>
					<div class="js-order-row">
						<div class="col-lg-3 col-md-3 col-sm-4 col-xs-8 form-group">
							<label class="hidden-xs" for="category">Категория</label>
							<select class="form-control js-select-placeholder" name="category" id="category">
								<option value="" disabled selected>Категория</option> <!-- placeholder -->
								<option value="1">Суши</option>
								<option value="2">Роллы</option>
								<option value="3">Сеты</option>
							</select>
						</div>
						<div class="col-lg-4 col-md-4 col-sm-5 col-xs-8 form-group">
							<label class="hidden-xs" for="cat_name">Наименование</label>
							<select class="form-control js-select-placeholder" name="cat_name" id="cat_name">
								<option value="" disabled selected>Наименование</option> <!-- placeholder -->
								<option value="1">Товар 1</option>
								<option value="2">Товар 2</option>
								<option value="3">Товар 3</option>
							</select>
						</div>
						<div class="col-lg-5 col-md-5 col-sm-3 col-xs-4 form-group order-btn-block no-label">
		                	<button type="button" class="btn btn-danger btn-remove-row jsRemoveCat" title="Удалить" style="display: none;"><i class="fa fa-times" aria-hidden="true"></i></button>
		                	<button type="button" class="btn btn-success btn-add-row jsAddNewCat" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
		                </div>
		            </div>
	            </div>
				<div class="clearfix visible-lg visible-md visible-xs"></div>
				<div class="col-lg-9 col-md-9 col-sm-12 discount__right-btn">
					<button class="btn btn-default" type="submit">Вернуться</button>
					<button class="btn btn-primary" type="submit">Сохранить</button>
				</div>
			</div>
		</form>
    </div>

    <script id="timeRowTemplate" type="text/template">
        <div class="js-time-row" style="display:none;">
			<div class="col-lg-4 col-md-4 col-sm-6 form-group">
                <label for="period">Период проведения</label>
				<select class="form-control" name="period">
					<option value="1">Определенные даты</option>
					<option value="2">Период</option>
					<option value="3">День недели</option>
					<option value="4" selected="">Нечетные числа месяца</option>
					<option value="5">Число месяца</option>
					<option value="6">Период месяца</option>
				</select>
			</div>
			<div class="col-lg-2 col-md-2 col-sm-3 discount__times no-label">
				<div class="form-group">
					<input type="text" class="form-control js-timework" value="" name="" id="timebeg" maxlength="5" placeholder="00:00">
				</div>
				<div class="form-group-dash">&ndash;</div>
				<div class="form-group">
					<input type="text" class="form-control js-timework" value="" name="" id="timeend" maxlength="5" placeholder="00:00">
				</div>
			</div>
			<div class="clearfix visible-sm"></div>
			<div class="col-lg-2 col-md-2 col-sm-3 col-xs-6 form-group">
				<label for="to-repeat">Повторять</label>
				<select class="form-control js-select-repeat" name="to-repeat">
					<option value="no-repeat">Не повторять</option>
					<option value="repeat" selected="">Кол-во повторов</option>
					<option value="all">Весь период акции</option>
				</select>
			</div>
			<div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 time-btn-block no-label">
				<div class="form-group js-repeat-block repeat-block">
					<input type="text" class="form-control" value="" name="num_repeats" id="num_repeats">
				</div>
				<div class="form-group hidden-sm">
					<button type="button" class="btn btn-danger btn-remove-row jsRemoveTime" title="Удалить"><i class="fa fa-times" aria-hidden="true"></i></button>
					<button type="button" class="btn btn-success btn-add-row jsAddNewTime" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
				</div>
			</div>
			<div class="col-sm-3 visible-sm time-btn-block no-label">
				<div class="form-group">
					<button type="button" class="btn btn-danger btn-remove-row jsRemoveTime" title="Удалить"><i class="fa fa-times" aria-hidden="true"></i></button>
					<button type="button" class="btn btn-success btn-add-row jsAddNewTime" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
				</div>
			</div>
		</div>
	</script>
	
    <script id="orderRowTemplate" type="text/template">
		<div class="js-order-row" style="display:none;">
			<div class="col-lg-3 col-md-3 col-sm-4 col-xs-8 form-group">
				<label class="hidden-xs" for="category">Категория</label>
				<select class="form-control js-select-placeholder" name="category" id="category_">
					<option value="" disabled selected>Категория</option> <!-- placeholder -->
					<option value="1">Суши</option>
					<option value="2">Роллы</option>
					<option value="3">Сеты</option>
				</select>
			</div>
			<div class="col-lg-4 col-md-4 col-sm-5 col-xs-8 form-group">
				<label class="hidden-xs" for="cat_name">Наименование</label>
				<select class="form-control js-select-placeholder" name="cat_name" id="cat_name_">
					<option value="" disabled selected>Наименование</option> <!-- placeholder -->
					<option value="1">Товар 1</option>
					<option value="2">Товар 2</option>
					<option value="3">Товар 3</option>
				</select>
			</div>
			<div class="col-lg-5 col-md-5 col-sm-3 col-xs-4 form-group order-btn-block no-label">
            	<button type="button" class="btn btn-danger btn-remove-row jsRemoveCat" title="Удалить"><i class="fa fa-times" aria-hidden="true"></i></button>
            	<button type="button" class="btn btn-success btn-add-row jsAddNewCat" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
            </div>
        </div>
	</script>
	
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap-3.3.7/js/bootstrap.min.js"></script>

    <!-- Bootstrap DateTimepicker, https://eonasdan.github.io/bootstrap-datetimepicker/ -->
    <script type="text/javascript" src="js/moment-with-locales.min.js"></script>
    <script type="text/javascript" src="js/bootstrap-datetimepicker.min.js"></script>

    <!-- Select2, https://select2.org/getting-started/basic-usage -->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.4/js/select2.min.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.4/js/select2.full.min.js"></script>

    <script type="text/javascript" src="js/js-gl.js"></script>
    
    <script type="text/javascript">
        $(function() {

            $('.js-select-multiple').select2({
                width: '100%'
            });

	        $('.js-timework').datetimepicker({
	            language: 'ru',
	            format: 'LT',
	            pickDate: false
	        });
	        
	        var placeholdersOnXS = (function() {
	        	var winWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
				if (winWidth < 768) {
					$('select.js-select-placeholder').each(function(index, value) {
						selectPlaceholder('#' + value.id);
					});
				}
				console.log('placeholdersOnXS');
	        });
	        
	        $(window).on('load resize', function() {
				placeholdersOnXS();
			});
			
            $(document).on('change', '.js-action-type', function() {
                var select = $(document).find('.js-action-type'),
                    now = select.val(),
                    block = select.closest('.js-discount-form'),
                    promo = block.find('.js-promocode-block'),
                    req = block.find('.js-requirement-block');
                
                if (now === 'promocode' || now === 'both') {
                    promo.show();
                } else {
                    promo.hide();
                }
                
                if (now === 'requirement' || now === 'both') {
                    req.show();
                } else {
                    req.hide();
                }
            });

			$(document).on('change', '.js-condition-type', function (e) {
				var select = $(document).find('.js-condition-type'),
                    now = select.val(),
                    block = select.closest('.js-discount-form'),
                    time = block.find('.js-time-block'),
                    summ = block.find('.js-summ-block'),
                    order = block.find('.js-order-block');
                    
                if (now.indexOf('time') > -1) {
                    time.show();
                } else {
                    time.hide();
                }

                if (now.indexOf('summ') > -1) {
                    summ.show();
                } else {
                    summ.hide();
                }

                if (now.indexOf('order') > -1) {
                    order.show();
                } else {
                    order.hide();
                }
			});
			
            $(document).on('change', '.js-select-repeat', function() {
                var select = $(this),
                    now = select.val(),
                    block = select.closest('.js-time-row'),
                    repeat = block.find('.js-repeat-block');
                
                if (now === 'repeat') {
                    repeat.show();
                } else {
                    repeat.hide();
                }
            });
            
            var editTime = (function() {
                var me = {};
                me.blockEditTime = $('.js-time-block');
                me.init = function() {
                    me.blockEditTime.on('click', '.jsAddNewTime', me.addNewItem);
                    me.blockEditTime.on('click', '.jsRemoveTime', me.removeItem);
                }
                me.addNewItem = function() {
                    var parent = $(this).closest('.js-time-block'),
                        rowTemplate = $('#timeRowTemplate'),
                        row = parent.find('.js-time-row'),
                        addBtn = row.find('.jsAddNewTime'),
                        allDelBtn = parent.find('.jsRemoveTime');

                    if (!rowTemplate) return false;

                    rowTemplate = $(rowTemplate.html());

                    rowTemplate.appendTo(parent);
                    addBtn.hide();
                    allDelBtn.show();
                    var newRow = parent.find('.js-time-row:last-child');
                    newRow.fadeIn(500);
			        $('.js-timework').datetimepicker({
			            language: 'ru',
			            format: 'LT',
			            pickDate: false
			        });
                }
                me.removeItem = function() {
                    var parent = $(this).closest('.js-time-block'),
                    	row = $(this).closest('.js-time-row'),
                    	rowLastChild = parent.find('.js-time-row:last-child'),
                    	lastRow, addBtn;
                    
                    if (row.index() === rowLastChild.index()) {
                    	var lastRow_index = row.index() - 2; // стоит -2, а не -1, т.к. в начале есть блок с заголовком
			        	lastRow = $(this).closest('.js-time-block').find('.js-time-row:eq(' + lastRow_index + ')');
			        } else {
			        	lastRow = rowLastChild;
			        }
					addBtn = lastRow.find('.jsAddNewTime');
					
					if (rowLastChild.index() === 2) {
						var delBtn = parent.find('.jsRemoveTime');
						delBtn.hide();
					}
					
                	addBtn.show();
					row.fadeOut(500, function() {
						row.remove();
					});
					
                }
                return me;
            }());

            var editOrder = (function() {
                var me = {};
                me.blockEditOrder = $('.js-order-block');
                me.init = function() {
                    me.blockEditOrder.on('click', '.jsAddNewCat', me.addNewItem);
                    me.blockEditOrder.on('click', '.jsRemoveCat', me.removeItem);
                }
                me.addNewItem = function() {
                    var parent = $(this).closest('.js-order-block'),
                        rowTemplate = $('#orderRowTemplate'),
                        row = parent.find('.js-order-row'),
                        addBtn = row.find('.jsAddNewCat'),
                        allDelBtn = parent.find('.jsRemoveCat');

                    if (!rowTemplate) return false;

                    rowTemplate = $(rowTemplate.html());

                    rowTemplate.appendTo(parent);
                    addBtn.hide();
                    allDelBtn.show();
                    var newRow = parent.find('.js-order-row:last-child');
                    newRow.fadeIn(500);
                    
                    placeholdersOnXS();
                }
                me.removeItem = function() {
                    var parent = $(this).closest('.js-order-block'),
                    	row = $(this).closest('.js-order-row'),
                    	rowLastChild = parent.find('.js-order-row:last-child'),
                    	lastRow, addBtn;
                    
                    if (row.index() === rowLastChild.index()) {
                    	var lastRow_index = row.index() - 2; //стоит -2, а не -1, т.к. в начале есть блок с заголовком
			        	lastRow = parent.find('.js-order-row:eq(' + lastRow_index + ')');
			        } else {
			        	lastRow = rowLastChild;
			        }
					addBtn = lastRow.find('.jsAddNewCat');
					
					if (rowLastChild.index() === 2) {
						var delBtn = parent.find('.jsRemoveCat');
						delBtn.hide();
					}
					
                	addBtn.show();
					row.fadeOut(500, function() {
			            row.remove();
			        });
                }
                return me;
            }());

            // если на странице есть нужный селектор, запускать функцию
            document.querySelector('.js-time-block') && editTime.init();
            document.querySelector('.js-order-block') && editOrder.init();
            

        });
		
    </script>

</body>

</html>