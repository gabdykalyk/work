<!DOCTYPE html>
<html class="hrm-page setup-wizard-page hrm-page--initializing"
      data-bind="childrenComplete: childrenComplete" lang="ru">
<head>
    <title>Sakura</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="HandheldFriendly" content="true" />
<meta content="IE=edge" http-equiv="X-UA-Compatible" />
<link href="https://fonts.googleapis.com/css?family=Fira+Sans:100,200,300,400,500,600,700,800,900&display=swap&subset=cyrillic" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.12/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/1.10.2/css/OverlayScrollbars.min.css" integrity="sha256-zUBmWpj0DsZzFautKgMOtiOkT6ECQ+a6RitMns7+HRM=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://unpkg.com/tippy.js@5/dist/backdrop.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<link rel="stylesheet" href="assets/fonts/fontawesome/css/all.css" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

<link rel="stylesheet" href="assets/css/main.css" />

</head>

<body>
    <div class="hrm-scaffold">
        <div class="hrm-scaffold__body">
            <div class="hrm-scaffold__content setup-wizard-page__content">
                <div class="hrm-stepper setup-wizard-page__stepper"
                     data-bind="css: {'hrm-stepper--dense': viewportSize().width <= HRM_BREAKPOINTS.mobileMaxWidth}">
                    <!-- ko let: {step: 1} -->
                        <div class="hrm-stepper__step" data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                            <div class="hrm-stepper__step-content"
                                 data-bind="click: function () {if(maxAvailableStep() >= step) {activeStep(step);}}">
                                <span class="hrm-stepper__step-label">Тип предприятия</span>
                                <div class="hrm-stepper__step-index-number" data-bind="text: step"></div>
                            </div>
                        </div>
                    <!-- /ko -->

                    <!-- ko let: {step: 2} -->
                        <div class="hrm-stepper__step" data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                            <div class="hrm-stepper__step-content"
                                 data-bind="click: function () {if(maxAvailableStep() >= step) {activeStep(step);}}">
                                <span class="hrm-stepper__step-label">Категории</span>
                                <div class="hrm-stepper__step-index-number" data-bind="text: step"></div>
                            </div>
                        </div>
                    <!-- /ko -->

                    <!-- ko let: {step: 3} -->
                        <div class="hrm-stepper__step" data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                            <div class="hrm-stepper__step-content"
                                 data-bind="click: function () {if(maxAvailableStep() >= step) {activeStep(step);}}">
                                <span class="hrm-stepper__step-label">График работы</span>
                                <div class="hrm-stepper__step-index-number" data-bind="text: step"></div>
                            </div>
                        </div>
                    <!-- /ko -->

                    <!-- ko let: {step: 4} -->
                        <div class="hrm-stepper__step" data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                            <div class="hrm-stepper__step-content"
                                 data-bind="click: function () {if(maxAvailableStep() >= step) {activeStep(step);}}">
                                <span class="hrm-stepper__step-label">Оборот и нагрузка</span>
                                <div class="hrm-stepper__step-index-number" data-bind="text: step"></div>
                            </div>
                        </div>
                    <!-- /ko -->

                    <!-- ko let: {step: 5} -->
                        <div class="hrm-stepper__step" data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                            <div class="hrm-stepper__step-content"
                                 data-bind="click: function () {if(maxAvailableStep() >= step) {activeStep(step);}}">
                                <span class="hrm-stepper__step-label">Должности</span>
                                <div class="hrm-stepper__step-index-number" data-bind="text: step"></div>
                            </div>
                        </div>
                    <!-- /ko -->

                    <!-- ko let: {step: 6} -->
                        <div class="hrm-stepper__step" data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                            <div class="hrm-stepper__step-content"
                                 data-bind="click: function () {if(maxAvailableStep() >= step) {activeStep(step);}}">
                                <span class="hrm-stepper__step-label">Тип нагрузки</span>
                                <div class="hrm-stepper__step-index-number" data-bind="text: step"></div>
                            </div>
                        </div>
                    <!-- /ko -->
                </div>

                <div class="setup-wizard-page__tab-container" data-bind="using: formModel">
                    <!-- ko template: {
                        foreach: hrmTemplateIf($root.activeStep() === 1, $data),
                        afterAdd: hrmFadeAfterAddFactory(300, 400),
                        beforeRemove: hrmFadeBeforeRemoveFactory(300)
                    } -->
                        <div class="setup-wizard-page__tab-pane setup-wizard-page__company-type-tab-pane">
                            <div class="setup-wizard-page__company-type-selector">
                                <div class="setup-wizard-page__company-type-selector-option setup-wizard-page__company-type-selector-option--value_retail"
                                     data-bind="click: function () {$root.companyTypeStepSelect(0);}">
                                    <div class="setup-wizard-page__company-type-selector-option-icon"></div>

                                    <span class="setup-wizard-page__company-type-selector-option-label">
                                        Розничная торговля
                                    </span>
                                </div>

                                <div class="setup-wizard-page__company-type-selector-option setup-wizard-page__company-type-selector-option--value_foodservice"
                                     data-bind="click: function () {$root.companyTypeStepSelect(1);}">
                                    <div class="setup-wizard-page__company-type-selector-option-icon"></div>

                                    <span class="setup-wizard-page__company-type-selector-option-label">
                                        Общепит / Рестораны
                                    </span>
                                </div>
                            </div>
                        </div>
                    <!-- /ko -->
                    <!-- ko template: {
                        foreach: hrmTemplateIf($root.activeStep() === 2, $data),
                        afterAdd: hrmFadeAfterAddFactory(300, 400),
                        beforeRemove: hrmFadeBeforeRemoveFactory(300)
                    } -->
                        <div class="setup-wizard-page__tab-pane setup-wizard-page__dish-categories-tab-pane">
                            <div class="setup-wizard-page__dish-categories-selector">
                                <span class="setup-wizard-page__dish-categories-selector-title">Выберите категории блюд</span>

                                <div class="setup-wizard-page__dish-categories-selector-list">
                                    <!-- ko foreach: {
                                        data: dishCategories,
                                        beforeRemove: hrmSlideBeforeRemoveFactory(),
                                        afterAdd: hrmSlideAfterAddFactory()
                                    } -->
                                        <div class="setup-wizard-page__dish-categories-selector-item">
                                            <div class="setup-wizard-page__dish-categories-selector-item-content">
                                                <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                                                    <div class="setup-wizard-page__dish-categories-selector-item-field" data-bind="
                                                        hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label
                                                    ">
                                                        <label data-bind="hrmFormFieldLabel: label">Категория</label>

                                                        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                                                            <select data-bind="
                                                                options: $root.dishCategories,
                                                                optionsText: 'name',
                                                                optionsValue: 'id',
                                                                optionsCaption: '',
                                                                value: value,
                                                                hrmSelect, hrmSelectSearchEnabled: true,
                                                                hrmFormFieldSelectControl: control,
                                                                hrmFormFieldSelectControlErrorStateMatcher: $root.dishCategoriesStepFormControlErrorStateMatcher.bind($root)
                                                            ">
                                                                <option></option>
                                                            </select>
                                                        </div>

                                                        <div data-bind="
                                                            component: {name: 'hrm-form-field-error'},
                                                            hrmSlide,
                                                            hrmSlideValue: control() !== null ? control() !== null ? control().errorState : false : false,
                                                            hrmSlideDuration: 150
                                                        ">
                                                            <!-- ko text: $parent.value.error() --><!-- /ko -->
                                                        </div>
                                                    </div>
                                                <!-- /ko -->
                                                <!-- ko if: $parent.dishCategories().length > 1 -->
                                                    <button class="hrm-button hrm-icon-button hrm-trash-icon-button
                                                                   hrm-icon-button--theme_negative
                                                                   setup-wizard-page__dish-categories-selector-item-remove-button"
                                                            title="Удалить"
                                                            data-bind="click: function () {$root.dishCategoriesStepRemove($index());}">
                                                    </button>
                                                <!-- /ko -->
                                            </div>
                                        </div>
                                    <!-- /ko -->
                                </div>

                                <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_neutral
                                            hrm-button-with-plus-icon setup-wizard-page__dish-categories-selector-add-button"
                                     data-bind="click: function () {$root.dishCategoriesStepAdd();}">
                                    Добавить
                                </button>
                            </div>

                            <div class="setup-wizard-page__tab-pane-actions">
                                <button class="hrm-button hrm-basic-button setup-wizard-page__tab-pane-actions-button"
                                        data-bind="click: function () { $root.back(); }">
                                    Назад
                                </button>
                                <button class="hrm-button hrm-basic-button hrm-accent-button setup-wizard-page__tab-pane-actions-button"
                                        data-bind="
                                            click: function () { $root.dishCategoriesStepSubmit(); },
                                            attr: {disabled: $root.isDishCategoriesStepSubmitted() && !$root.isDishCategoriesStepValid()}
                                        "
                                >
                                    Далее
                                </button>
                            </div>
                        </div>
                    <!-- /ko -->
                    <!-- ko template: {
                        foreach: hrmTemplateIf($root.activeStep() === 3, $data),
                        afterAdd: hrmFadeAfterAddFactory(300, 400),
                        beforeRemove: hrmFadeBeforeRemoveFactory(300)
                    } -->
                        <div class="setup-wizard-page__tab-pane setup-wizard-page__schedule-tab-pane">
                            <div class="setup-wizard-page__schedule-selector">
                                <span class="setup-wizard-page__schedule-selector-title">График работы предприятия</span>

                                <div class="setup-wizard-page__schedule-selector-controls">
                                    <div class="setup-wizard-page__schedule-selector-interval-selector">
                                        <span class="setup-wizard-page__schedule-selector-interval-selector-label">
                                            Задать интервал таблицы
                                        </span>

                                        <div class="setup-wizard-page__schedule-selector-interval-selector-control">

                                            <!-- ko let: {control: ko.observable(null)} -->
                                                <div class="setup-wizard-page__schedule-selector-interval-selector-control-field
                                                            setup-wizard-page__schedule-selector-interval-selector-control-start-field"
                                                     data-bind="hrmFormField, hrmFormFieldControlRef: control">
                                                    <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                                                        <input data-bind="
                                                            textInput: intervalStart,
                                                            hrmTimeAutocompleter,
                                                            hrmMask,
                                                            hrmMaskPattern: 'datetime',
                                                            hrmMaskOptions: {
                                                                inputFormat: 'HH:MM',
                                                                placeholder: ' '
                                                            },
                                                            hrmFormFieldInputControl: control,
                                                            hrmFormFieldInputControlErrorStateMatcher: $root.scheduleStepIntervalBoundaryFormControlErrorStateMatcher.bind($root)
                                                        ">
                                                    </div>
                                                </div>
                                            <!-- /ko -->

                                            <span class="setup-wizard-page__schedule-selector-interval-selector-control-separator">—</span>

                                            <!-- ko let: {control: ko.observable(null)} -->
                                                <div class="setup-wizard-page__schedule-selector-interval-selector-control-field
                                                            setup-wizard-page__schedule-selector-interval-selector-control-end-field"
                                                     data-bind="hrmFormField, hrmFormFieldControlRef: control">
                                                    <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                                                        <input data-bind="
                                                            textInput: intervalEnd,
                                                            hrmTimeAutocompleter,
                                                            hrmMask,
                                                            hrmMaskPattern: 'datetime',
                                                            hrmMaskOptions: {
                                                                inputFormat: 'HH:MM',
                                                                placeholder: ' '
                                                            },
                                                            hrmFormFieldInputControl: control,
                                                            hrmFormFieldInputControlErrorStateMatcher: $root.scheduleStepIntervalBoundaryFormControlErrorStateMatcher.bind($root)
                                                        ">
                                                    </div>
                                                </div>
                                            <!-- /ko -->
                                        </div>
                                    </div>

                                    <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_positive
                                                   hrm-button-with-check-icon setup-wizard-page__schedule-selector-pick-all-button"
                                            data-bind="click: function() {$root.scheduleStepFill();}">
                                        Заполнить автоматически
                                    </button>
                                </div>

                                <div data-bind="component: {
                                    name: 'setup-wizard-page-schedule-selector-calendar',
                                    params: {
                                        value: schedule,
                                        intervalStart: $root.scheduleStepUsedIntervalStart,
                                        intervalEnd: $root.scheduleStepUsedIntervalEnd,
                                        exportAs: $root.scheduleStepCalendar
                                    }
                                }">
                                </div>

                                <div class="setup-wizard-page__schedule-selector-actions">
                                    <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_negative
                                                hrm-button-with-times-icon setup-wizard-page__schedule-selector-action"
                                         data-bind="click: function() {$root.scheduleStepCalendar().clear();}">
                                        Очистить
                                    </button>
                                </div>
                            </div>

                            <div class="setup-wizard-page__tab-pane-actions">
                                <button class="hrm-button hrm-basic-button setup-wizard-page__tab-pane-actions-button"
                                        data-bind="click: function () { $root.back(); }">
                                    Назад
                                </button>
                                <button class="hrm-button hrm-basic-button hrm-accent-button setup-wizard-page__tab-pane-actions-button"
                                        data-bind="
                                            click: function () { $root.scheduleStepSubmit(); },
                                            attr: {
                                                disabled: !$root.isScheduleStepValid()
                                            }
                                        "
                                >
                                    Далее
                                </button>
                            </div>
                        </div>
                    <!-- /ko -->
                    <!-- ko template: {
                        foreach: hrmTemplateIf($root.activeStep() === 4, $data),
                        afterAdd: hrmFadeAfterAddFactory(300, 400),
                        beforeRemove: hrmFadeBeforeRemoveFactory(300)
                    } -->
                        <div class="setup-wizard-page__tab-pane setup-wizard-page__turnover-tab-pane"
                             data-bind="css: {'setup-wizard-page__turnover-tab-pane--calculated': isTurnoverCalculated}">
                            <div class="setup-wizard-page__turnover-selector">
                                <span class="setup-wizard-page__turnover-selector-title">Оборот предприятия</span>

                                <span class="setup-wizard-page__turnover-selector-description"
                                      data-bind="hrmFade, hrmFadeValue: !isTurnoverCalculated() && !$root.isTurnoverStepCalculating()">
                                    Заполните поля хотя бы для одной категории
                                </span>

                                <!-- ko template: {
                                    foreach: hrmTemplateIf(!isTurnoverCalculated() && !$root.isTurnoverStepCalculating(), $data),
                                    afterAdd: hrmFadeAfterAddFactory(200, 200),
                                    beforeRemove: hrmFadeBeforeRemoveFactory(200)
                                } -->
                                    <div>
                                        <!-- ko if: $root.viewportSize().width > HRM_BREAKPOINTS.mobileMaxWidth -->
                                            <table data-bind="hrmTable, setupWizardPageTurnoverSelectorTable">
                                                <thead>
                                                    <tr>
                                                        <th class="setup-wizard-page__turnover-selector-table-units-head-cell">
                                                            Единица измерения
                                                        </th>
                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Пн</th>
                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Вт</th>
                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Ср</th>
                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Чт</th>
                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Пт</th>
                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Сб</th>
                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Вс</th>
                                                        <th class="setup-wizard-page__turnover-selector-table-week-total-head-cell">
                                                            За неделю
                                                        </th>
                                                    </tr>
                                                </thead>

                                                <tbody data-bind="foreach: {data: dishCategories, as: 'dishCategory'}">
                                                    <tr>
                                                        <td class="setup-wizard-page__turnover-selector-table-category-name-cell"
                                                            data-bind="text: $root.getDishCategory(value()).name" colspan="9">
                                                        </td>
                                                    </tr>

                                                    <tr class="setup-wizard-page__turnover-selector-table-week-row">
                                                        <!-- ko let: {editableCell: ko.observable(null)} -->
                                                            <td class="setup-wizard-page__turnover-selector-table-units-cell"
                                                                data-bind="hrmTableEditableCell: editableCell">
                                                                <select data-bind="
                                                                    value: units,
                                                                    hrmSelect,
                                                                    hrmTableEditableCellSelectControl,
                                                                    hrmTableEditableCellSelectControlOwner: editableCell
                                                                ">
                                                                    <option value="1">Штуки</option>
                                                                    <option value="2">Рубли</option>
                                                                    <option value="3">Норма времени</option>
                                                                </select>
                                                            </td>
                                                        <!-- /ko -->
                                                        <!-- ko foreach: {data: [1, 2, 3, 4, 5, 6, 7], as: 'weekday'} -->
                                                            <!-- ko if: $parent.week[weekday - 1]() !== null -->
                                                                <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                    <td class="setup-wizard-page__turnover-selector-table-weekday-cell"
                                                                        data-bind="
                                                                            hrmTableEditableCell: editableCell,
                                                                            hrmTableEditableCellError: $root.turnoverStepWeekdayTotalErrorExtractor(dishCategoryIndex(), weekday)()
                                                                        ">
                                                                        <input data-bind="
                                                                            textInput: $parent.week[weekday - 1]().weekdayTotal,
                                                                            event: {
                                                                                input: function() {
                                                                                    $root.onTurnoverStepWeekdayTotalInput($parentContext.dishCategoryIndex());
                                                                                },
                                                                                change: function() {
                                                                                    $root.onTurnoverStepWeekdayTotalChange($parentContext.dishCategoryIndex(), weekdayIndex());
                                                                                }
                                                                            },
                                                                            hrmMask, hrmMaskPattern: 'decimal',
                                                                            hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                            hrmTableEditableCellInputControl,
                                                                            hrmTableEditableCellInputControlOwner: editableCell
                                                                        " placeholder="0">
                                                                    </td>
                                                                <!-- /ko -->
                                                            <!-- /ko -->

                                                            <!-- ko if: $parent.week[weekday - 1]() === null -->
                                                                <td class="setup-wizard-page__turnover-selector-table-weekday-cell
                                                                           setup-wizard-page__turnover-selector-table-weekday-cell--disabled">
                                                                </td>
                                                            <!-- /ko -->
                                                        <!-- /ko -->

                                                        <!-- ko let: {editableCell: ko.observable(null)} -->
                                                            <td class="setup-wizard-page__turnover-selector-table-week-total-cell"
                                                                data-bind="
                                                                    hrmTableEditableCell: editableCell,
                                                                    hrmTableEditableCellError: $root.turnoverStepTableErrorExtractor(weekTotal)()
                                                                ">
                                                                <input data-bind="
                                                                    value: weekTotal,
                                                                    event: {
                                                                        change: function (_, event) {
                                                                            $root.onTurnoverStepWeekTotalChange(dishCategoryIndex());
                                                                        }
                                                                    },
                                                                    hrmMask, hrmMaskPattern: 'decimal',
                                                                    hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                    hrmTableEditableCellInputControl,
                                                                    hrmTableEditableCellInputControlOwner: editableCell
                                                                " placeholder="0">
                                                            </td>
                                                        <!-- /ko -->
                                                    </tr>
                                                </tbody>
                                            </table>
                                        <!-- /ko -->

                                        <!-- ko if: $root.viewportSize().width <= HRM_BREAKPOINTS.mobileMaxWidth -->
                                            <div data-bind="setupWizardPageTurnoverSelectorTable">
                                                <!-- ko foreach: {data: dishCategories, as: 'dishCategory'} -->
                                                    <div class="setup-wizard-page__turnover-selector-table-category-section">
                                                        <div class="setup-wizard-page__turnover-selector-table-category-section-header">
                                                            <span class="setup-wizard-page__turnover-selector-table-category-section-header-title"
                                                                  data-bind="text: $root.getDishCategory(value()).name">
                                                            </span>

                                                            <span class="hrm-spacer"></span>

                                                            <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                                                                <div class="setup-wizard-page__turnover-selector-table-category-section-header-units-field" data-bind="
                                                                    hrmFormField, hrmFormFieldControlRef: control
                                                                ">
                                                                    <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                                                                        <select data-bind="
                                                                            value: units,
                                                                            hrmSelect,
                                                                            hrmFormFieldSelectControl: control
                                                                        ">
                                                                            <option value="1">Штуки</option>
                                                                            <option value="2">Рубли</option>
                                                                            <option value="3">Норма времени</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            <!-- /ko -->
                                                        </div>

                                                        <div class="setup-wizard-page__turnover-selector-table-category-section-body">
                                                            <div class="hrm-table__fixed-section-container setup-wizard-page__turnover-selector-table-category-section-table-fixed-section-container">
                                                                <table class="hrm-table__fixed-section hrm-table__fixed-section--position_left
                                                                              setup-wizard-page__turnover-selector-table-category-section-table-fixed-section"
                                                                       data-bind="hrmTable">
                                                                    <thead>
                                                                        <tr>
                                                                            <th class="setup-wizard-page__turnover-selector-table-category-section-table-week-total-cell">
                                                                                За неделю
                                                                            </th>
                                                                        </tr>
                                                                    </thead>

                                                                    <tbody>
                                                                        <tr>
                                                                            <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                                <td class="setup-wizard-page__turnover-selector-table-category-section-table-week-total-cell"
                                                                                    data-bind="
                                                                                        hrmTableEditableCell: editableCell,
                                                                                        hrmTableEditableCellError: $root.turnoverStepTableErrorExtractor(weekTotal)()
                                                                                    ">
                                                                                    <input data-bind="
                                                                                        value: weekTotal,
                                                                                        event: {
                                                                                            change: function (_, event) {
                                                                                                $root.onTurnoverStepWeekTotalChange(dishCategoryIndex());
                                                                                            }
                                                                                        },
                                                                                        hrmMask, hrmMaskPattern: 'decimal',
                                                                                        hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                                        hrmTableEditableCellInputControl,
                                                                                        hrmTableEditableCellInputControlOwner: editableCell
                                                                                    " placeholder="0">
                                                                                </td>
                                                                            <!-- /ko -->
                                                                        </tr>
                                                                    </tbody>
                                                                </table>

                                                                <div data-bind="component: {
                                                                    name: 'hrm-scrollable-wrapper',
                                                                    params: {
                                                                        options: {left: {disabled: true}}
                                                                    }
                                                                }">
                                                                    <table class="setup-wizard-page__turnover-selector-table-category-section-table"
                                                                           data-bind="hrmTable">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Пн</th>
                                                                                <th>Вт</th>
                                                                                <th>Ср</th>
                                                                                <th>Чт</th>
                                                                                <th>Пт</th>
                                                                                <th>Сб</th>
                                                                                <th>Вс</th>
                                                                            </tr>
                                                                        </thead>

                                                                        <tbody>
                                                                            <tr>
                                                                                <!-- ko foreach: {data: [1, 2, 3, 4, 5, 6, 7], as: 'weekday'} -->
                                                                                    <!-- ko if: $parent.week[weekday - 1]() !== null -->
                                                                                        <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                                            <td class="setup-wizard-page__turnover-selector-table-category-section-table-weekday-cell"
                                                                                                data-bind="
                                                                                                    hrmTableEditableCell: editableCell,
                                                                                                    hrmTableEditableCellError: $root.turnoverStepWeekdayTotalErrorExtractor(dishCategoryIndex(), weekday)()
                                                                                                "
                                                                                            >
                                                                                                <input data-bind="
                                                                                                    textInput: $parent.week[weekday - 1]().weekdayTotal,
                                                                                                    event: {
                                                                                                        input: function() {
                                                                                                            $root.onTurnoverStepWeekdayTotalInput($parentContext.dishCategoryIndex());
                                                                                                        },
                                                                                                        change: function() {
                                                                                                            $root.onTurnoverStepWeekdayTotalChange($parentContext.dishCategoryIndex(), weekdayIndex());
                                                                                                        }
                                                                                                    },
                                                                                                    hrmMask, hrmMaskPattern: 'decimal',
                                                                                                    hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                                                    hrmTableEditableCellInputControl,
                                                                                                    hrmTableEditableCellInputControlOwner: editableCell
                                                                                                " placeholder="0">
                                                                                            </td>
                                                                                        <!-- /ko -->
                                                                                    <!-- /ko -->

                                                                                    <!-- ko if: $parent.week[weekday - 1]() === null -->
                                                                                        <td class="setup-wizard-page__turnover-selector-table-weekday-cell
                                                                                                   setup-wizard-page__turnover-selector-table-weekday-cell--disabled">
                                                                                        </td>
                                                                                    <!-- /ko -->
                                                                                <!-- /ko -->
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                <!-- /ko -->
                                            </div>
                                        <!-- /ko -->
                                    </div>
                                <!-- /ko -->

                                <!-- ko template: {
                                    foreach: hrmTemplateIf(isTurnoverCalculated() && !$root.isTurnoverStepCalculating(), $data),
                                    afterAdd: hrmFadeAfterAddFactory(200, 200),
                                    beforeRemove: hrmFadeBeforeRemoveFactory(200)
                                } -->
                                    <div>
                                        <!-- ko if: $root.viewportSize().width > HRM_BREAKPOINTS.mobileMaxWidth -->
                                            <!-- ko let: {table: ko.observable(null), stickySectionWrappers: ko.observableArray([]), categoryRowElements: ko.observableArray([])} -->
                                                <div class="setup-wizard-page__turnover-selector-table-sticky-section-container"
                                                     data-bind="
                                                        hrmTableStickySectionContainer,
                                                        hrmTableStickySectionContainerSectionWrappers: stickySectionWrappers
                                                     "
                                                >
                                                    <div class="hrm-table__sticky-section-rail">
                                                        <div class="setup-wizard-page__turnover-selector-table-sticky-header-wrapper"
                                                             data-bind="hrmTableStickySectionWrapper: stickySectionWrappers">
                                                            <!-- ko let: {activeCategoryIndex: table() !== null && table().activeCategoryIndex() !== null ? table().activeCategoryIndex() : 0} -->
                                                                <table class="hrm-table__sticky-section
                                                                              hrm-table__sticky-section--position_top
                                                                              setup-wizard-page__turnover-selector-table
                                                                              setup-wizard-page__turnover-selector-table-sticky-header"
                                                                   data-bind="hrmTable, using: $root.formModel().dishCategories()[activeCategoryIndex]">
                                                                <thead>
                                                                    <tr>
                                                                        <th class="setup-wizard-page__turnover-selector-table-units-head-cell">
                                                                            <div class="setup-wizard-page__turnover-selector-table-units-head-cell-content"
                                                                                 data-bind="
                                                                                    text: $root.getDishCategory(value()).name,
                                                                                    attr: {title: $root.getDishCategory(value()).name}
                                                                                 "
                                                                            >
                                                                            </div>
                                                                        </th>
                                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Пн</th>
                                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Вт</th>
                                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Ср</th>
                                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Чт</th>
                                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Пт</th>
                                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Сб</th>
                                                                        <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Вс</th>
                                                                        <th class="setup-wizard-page__turnover-selector-table-week-total-head-cell">
                                                                            За неделю
                                                                        </th>
                                                                    </tr>
                                                                </thead>

                                                                <tbody>
                                                                    <tr class="setup-wizard-page__turnover-selector-table-week-row">
                                                                        <!-- ko with: $root.formModel().dishCategories()[activeCategoryIndex] -->
                                                                            <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                                <td class="setup-wizard-page__turnover-selector-table-units-cell"
                                                                                    data-bind="hrmTableEditableCell: editableCell">
                                                                                    <select data-bind="
                                                                                        value: units,
                                                                                        hrmSelect,
                                                                                        hrmTableEditableCellSelectControl,
                                                                                        hrmTableEditableCellSelectControlOwner: editableCell
                                                                                    ">
                                                                                        <option value="1">Штуки</option>
                                                                                        <option value="2">Рубли</option>
                                                                                        <option value="3">Норма времени</option>
                                                                                    </select>
                                                                                </td>
                                                                            <!-- /ko -->
                                                                        <!-- /ko -->
                                                                        <!-- ko foreach: {data: [1, 2, 3, 4, 5, 6, 7], as: 'weekday'} -->
                                                                            <!-- ko if: $parent.week[weekday - 1]() !== null -->
                                                                                <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                                    <td class="setup-wizard-page__turnover-selector-table-weekday-cell"
                                                                                        data-bind="
                                                                                        hrmTableEditableCell: editableCell,
                                                                                        hrmTableEditableCellError: $root.turnoverStepWeekdayTotalErrorExtractor($parentContext.activeCategoryIndex, weekday)()
                                                                                    ">
                                                                                        <input data-bind="
                                                                                            textInput: $parent.week[weekday - 1]().weekdayTotal,
                                                                                            event: {
                                                                                                input: function() {
                                                                                                    $root.onTurnoverStepWeekdayTotalInput($parentContext.activeCategoryIndex);
                                                                                                },
                                                                                                change: function() {
                                                                                                    $root.onTurnoverStepWeekdayTotalChange($parentContext.activeCategoryIndex, weekdayIndex());
                                                                                                }
                                                                                            },
                                                                                            hrmMask, hrmMaskPattern: 'decimal',
                                                                                            hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                                            hrmTableEditableCellInputControl,
                                                                                            hrmTableEditableCellInputControlOwner: editableCell
                                                                                        " placeholder="0">
                                                                                    </td>
                                                                                <!-- /ko -->
                                                                            <!-- /ko -->

                                                                            <!-- ko if: $parent.week[weekday - 1]() === null -->
                                                                                <td class="setup-wizard-page__turnover-selector-table-weekday-cell
                                                                                           setup-wizard-page__turnover-selector-table-weekday-cell--disabled">
                                                                                </td>
                                                                            <!-- /ko -->
                                                                        <!-- /ko -->
                                                                        <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                            <td class="setup-wizard-page__turnover-selector-table-week-total-cell"
                                                                                data-bind="
                                                                                    hrmTableEditableCell: editableCell,
                                                                                    hrmTableEditableCellError: $root.turnoverStepTableErrorExtractor(weekTotal)
                                                                                ">
                                                                                <input data-bind="
                                                                                    value: weekTotal,
                                                                                    event: {
                                                                                        change: function (_, event) {
                                                                                            $root.onTurnoverStepWeekTotalChange($parentContext.activeCategoryIndex);
                                                                                        }
                                                                                    },
                                                                                    hrmMask, hrmMaskPattern: 'decimal',
                                                                                    hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                                    hrmTableEditableCellInputControl,
                                                                                    hrmTableEditableCellInputControlOwner: editableCell
                                                                                " placeholder="0">
                                                                            </td>
                                                                        <!-- /ko -->
                                                                    </tr>
                                                                </tbody>
                                                                </table>
                                                            <!-- /ko -->
                                                        </div>
                                                    </div>
                                                    <table data-bind="
                                                        hrmTable,
                                                        setupWizardPageTurnoverSelectorTable: table,
                                                        setupWizardPageTurnoverSelectorTableCategoryRowElements: categoryRowElements
                                                    ">
                                                    <thead>
                                                        <tr>
                                                            <th class="setup-wizard-page__turnover-selector-table-units-head-cell">
                                                                Единица измерения
                                                            </th>
                                                            <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Пн</th>
                                                            <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Вт</th>
                                                            <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Ср</th>
                                                            <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Чт</th>
                                                            <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Пт</th>
                                                            <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Сб</th>
                                                            <th class="setup-wizard-page__turnover-selector-table-weekday-head-cell">Вс</th>
                                                            <th class="setup-wizard-page__turnover-selector-table-week-total-head-cell">
                                                                За неделю
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody data-bind="foreach: {data: dishCategories, as: 'dishCategory'}">
                                                        <tr class="setup-wizard-page__turnover-selector-table-category-row"
                                                            data-bind="hrmElement: categoryRowElements, hrmElementIndex: dishCategoryIndex()">
                                                            <td class="setup-wizard-page__turnover-selector-table-category-name-cell"
                                                                data-bind="text: $root.getDishCategory(value()).name" colspan="9">
                                                            </td>
                                                        </tr>

                                                        <tr class="setup-wizard-page__turnover-selector-table-week-row">
                                                            <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                <td class="setup-wizard-page__turnover-selector-table-units-cell"
                                                                    data-bind="hrmTableEditableCell: editableCell">
                                                                    <select data-bind="
                                                                        value: units,
                                                                        hrmSelect,
                                                                        hrmTableEditableCellSelectControl,
                                                                        hrmTableEditableCellSelectControlOwner: editableCell
                                                                    ">
                                                                        <option value="1">Штуки</option>
                                                                        <option value="2">Рубли</option>
                                                                        <option value="3">Норма времени</option>
                                                                    </select>
                                                                </td>
                                                            <!-- /ko -->
                                                            <!-- ko foreach: {data: [1, 2, 3, 4, 5, 6, 7], as: 'weekday'} -->
                                                                <!-- ko if: $parent.week[weekday - 1]() !== null -->
                                                                    <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                        <td class="setup-wizard-page__turnover-selector-table-weekday-cell"
                                                                            data-bind="
                                                                                hrmTableEditableCell: editableCell,
                                                                                hrmTableEditableCellError: $root.turnoverStepWeekdayTotalErrorExtractor(dishCategoryIndex(), weekday)()
                                                                            ">
                                                                            <input data-bind="
                                                                                textInput: $parent.week[weekday - 1]().weekdayTotal,
                                                                                event: {
                                                                                    input: function() {
                                                                                        $root.onTurnoverStepWeekdayTotalInput($parentContext.dishCategoryIndex());
                                                                                    },
                                                                                    change: function() {
                                                                                        $root.onTurnoverStepWeekdayTotalChange($parentContext.dishCategoryIndex(), weekdayIndex());
                                                                                    }
                                                                                },
                                                                                hrmMask, hrmMaskPattern: 'decimal',
                                                                                hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                                hrmTableEditableCellInputControl,
                                                                                hrmTableEditableCellInputControlOwner: editableCell
                                                                            " placeholder="0">
                                                                        </td>
                                                                    <!-- /ko -->
                                                                <!-- /ko -->

                                                                <!-- ko if: $parent.week[weekday - 1]() === null -->
                                                                    <td class="setup-wizard-page__turnover-selector-table-weekday-cell
                                                                               setup-wizard-page__turnover-selector-table-weekday-cell--disabled">
                                                                    </td>
                                                                <!-- /ko -->
                                                            <!-- /ko -->

                                                            <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                <td class="setup-wizard-page__turnover-selector-table-week-total-cell"
                                                                    data-bind="
                                                                        hrmTableEditableCell: editableCell,
                                                                        hrmTableEditableCellError: $root.turnoverStepTableErrorExtractor(weekTotal)
                                                                    ">
                                                                    <input data-bind="
                                                                        value: weekTotal,
                                                                        event: {
                                                                            change: function (_, event) {
                                                                                $root.onTurnoverStepWeekTotalChange(dishCategoryIndex());
                                                                            }
                                                                        },
                                                                        hrmMask, hrmMaskPattern: 'decimal',
                                                                        hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                        hrmTableEditableCellInputControl,
                                                                        hrmTableEditableCellInputControlOwner: editableCell
                                                                    " placeholder="0">
                                                                </td>
                                                            <!-- /ko -->
                                                        </tr>

                                                        <!-- ko foreach: {data: $root.turnoverStepIntervalHours, as: 'hour'} -->
                                                            <tr class="setup-wizard-page__turnover-selector-table-hour-row">
                                                                <!-- ko let: {data: $root.turnoverStepGetHourLabelData(hourIndex())} -->
                                                                    <td class="setup-wizard-page__turnover-selector-table-hour-label-cell">
                                                                        <span data-bind="text: data.start.hour"></span><sup class="setup-wizard-page__turnover-selector-table-hour-label-minute" data-bind="text: data.start.minute"></sup>–<span data-bind="text: data.end.hour"></span><sup class="setup-wizard-page__turnover-selector-table-hour-label-minute" data-bind="text: data.end.minute"></sup>
                                                                    </td>
                                                                <!-- /ko -->
                                                                <!-- ko foreach: {data: [1, 2, 3, 4, 5, 6, 7], as: 'weekday'} -->
                                                                    <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                        <!-- ko if: $parents[1].week[weekday - 1]() !== null && $parents[1].week[weekday - 1]().hours()[hourIndex()] !== null -->
                                                                            <td class="setup-wizard-page__turnover-selector-table-hour-cell"
                                                                                data-bind="
                                                                                    hrmTableEditableCell: editableCell,
                                                                                    hrmTableEditableCellError: $root.turnoverStepTableErrorExtractor($parents[1].week[weekday - 1]().hours()[hourIndex()])
                                                                                ">
                                                                                <input data-bind="
                                                                                    textInput: $parents[1].week[weekday - 1]().hours()[hourIndex()],
                                                                                    event: {
                                                                                        input: function() {
                                                                                            $root.onTurnoverStepHourInput($parentContext.dishCategoryIndex(), weekdayIndex(), hourIndex());
                                                                                        }
                                                                                    },
                                                                                    hrmMask, hrmMaskPattern: 'decimal',
                                                                                    hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                                    hrmTableEditableCellInputControl,
                                                                                    hrmTableEditableCellInputControlOwner: editableCell,
                                                                                " placeholder="0">
                                                                            </td>
                                                                        <!-- /ko -->

                                                                        <!-- ko if: $parents[1].week[weekday - 1]() === null || $parents[1].week[weekday - 1]().hours()[hourIndex()] === null -->
                                                                            <td class="setup-wizard-page__turnover-selector-table-hour-cell
                                                                                       setup-wizard-page__turnover-selector-table-hour-cell--disabled">
                                                                            </td>
                                                                        <!-- /ko -->
                                                                    <!-- /ko -->
                                                                <!-- /ko -->

                                                                <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                    <td class="setup-wizard-page__turnover-selector-table-hour-total-cell"
                                                                        data-bind="
                                                                            hrmTableEditableCell: editableCell,
                                                                            hrmTableEditableCellError: $root.turnoverStepTableErrorExtractor($parent.hourTotals()[hourIndex()])
                                                                        ">
                                                                        <input data-bind="
                                                                            value: $parent.hourTotals()[hourIndex()],
                                                                            event: {
                                                                                change: function() {
                                                                                    $root.onTurnoverStepHourTotalChange($parentContext.dishCategoryIndex(), hourIndex());
                                                                                }
                                                                            },
                                                                            hrmMask, hrmMaskPattern: 'decimal',
                                                                            hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                            hrmTableEditableCellInputControl,
                                                                            hrmTableEditableCellInputControlOwner: editableCell
                                                                        " placeholder="0">
                                                                    </td>
                                                                <!-- /ko -->
                                                            </tr>
                                                        <!-- /ko -->
                                                    </tbody>
                                                    </table>
                                                </div>
                                            <!-- /ko -->
                                        <!-- /ko -->

                                        <!-- ko if: $root.viewportSize().width <= HRM_BREAKPOINTS.mobileMaxWidth -->
                                            <div data-bind="setupWizardPageTurnoverSelectorTable">
                                                <!-- ko foreach: {data: dishCategories, as: 'dishCategory'} -->
                                                    <!-- ko let: {isOpen: ko.observable(dishCategoryIndex() === 0)} -->
                                                        <div class="setup-wizard-page__turnover-selector-table-category-section">
                                                            <div class="setup-wizard-page__turnover-selector-table-category-section-header">
                                                                <button class="hrm-button hrm-circle-icon-button
                                                                               hrm-circle-icon-button--theme_neutral
                                                                               hrm-circle-arrow-down-icon-button
                                                                               setup-wizard-page__turnover-selector-table-category-section-header-toggle-button"
                                                                        data-bind="click: function() {isOpen(!isOpen());}">
                                                                </button>

                                                                <span class="setup-wizard-page__turnover-selector-table-category-section-header-title"
                                                                      data-bind="
                                                                        text: $root.getDishCategory(value()).name,
                                                                        click: function() {isOpen(!isOpen());}
                                                                      ">
                                                                </span>

                                                                <span class="hrm-spacer"></span>

                                                                <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                                                                    <div class="setup-wizard-page__turnover-selector-table-category-section-header-units-field" data-bind="
                                                                        hrmFormField, hrmFormFieldControlRef: control
                                                                    ">
                                                                        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                                                                            <select data-bind="
                                                                                value: units,
                                                                                hrmSelect, hrmSelectSearchEnabled: true,
                                                                                hrmFormFieldSelectControl: control
                                                                            ">
                                                                                <option value="1">Штуки</option>
                                                                                <option value="2">Рубли</option>
                                                                                <option value="3">Норма времени</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                <!-- /ko -->
                                                            </div>

                                                            <div class="setup-wizard-page__turnover-selector-table-category-section-body"
                                                                 data-bind="hrmSlide, hrmSlideValue: isOpen">
                                                                <div class="hrm-table__fixed-section-container setup-wizard-page__turnover-selector-table-category-section-table-fixed-section-container">
                                                                    <table class="hrm-table__fixed-section hrm-table__fixed-section--position_left
                                                                                  setup-wizard-page__turnover-selector-table-category-section-table-fixed-section"
                                                                           data-bind="hrmTable">
                                                                        <thead>
                                                                            <tr>
                                                                                <th class="setup-wizard-page__turnover-selector-table-category-section-table-hour-label-head-cell"></th>
                                                                                <th class="setup-wizard-page__turnover-selector-table-category-section-table-week-total-cell">
                                                                                    За неделю
                                                                                </th>
                                                                            </tr>
                                                                        </thead>

                                                                        <tbody>
                                                                            <tr>
                                                                                <td class="setup-wizard-page__turnover-selector-table-category-section-table-hour-label-cell"></td>

                                                                                <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                                    <td class="setup-wizard-page__turnover-selector-table-category-section-table-week-total-cell"
                                                                                        data-bind="
                                                                                            hrmTableEditableCell: editableCell,
                                                                                            hrmTableEditableCellError: $root.turnoverStepTableErrorExtractor(weekTotal)
                                                                                        ">
                                                                                        <input data-bind="
                                                                                            value: weekTotal,
                                                                                            event: {
                                                                                                change: function (_, event) {
                                                                                                    $root.onTurnoverStepWeekTotalChange(dishCategoryIndex());
                                                                                                }
                                                                                            },
                                                                                            hrmMask, hrmMaskPattern: 'decimal',
                                                                                            hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                                            hrmTableEditableCellInputControl,
                                                                                            hrmTableEditableCellInputControlOwner: editableCell
                                                                                        " placeholder="0">
                                                                                    </td>
                                                                                <!-- /ko -->
                                                                            </tr>

                                                                            <!-- ko foreach: {data: $root.turnoverStepIntervalHours, as: 'hour'} -->
                                                                                <tr class="setup-wizard-page__turnover-selector-table-category-section-table-hour-row">
                                                                                    <!-- ko let: {data: $root.turnoverStepGetHourLabelData(hourIndex())} -->
                                                                                        <td class="setup-wizard-page__turnover-selector-table-category-section-table-hour-label-cell">
                                                                                            <span data-bind="text: data.start.hour"></span><sup class="setup-wizard-page__turnover-selector-table-hour-label-minute" data-bind="text: data.start.minute"></sup>
                                                                                        </td>
                                                                                    <!-- /ko -->

                                                                                    <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                                        <td class="setup-wizard-page__turnover-selector-table-category-section-table-hour-total-cell"
                                                                                            data-bind="
                                                                                                hrmTableEditableCell: editableCell,
                                                                                                hrmTableEditableCellError: $root.turnoverStepTableErrorExtractor($parent.hourTotals()[hourIndex()])
                                                                                            ">
                                                                                            <input data-bind="
                                                                                                value: $parent.hourTotals()[hourIndex()],
                                                                                                event: {
                                                                                                    change: function() {
                                                                                                        $root.onTurnoverStepHourTotalChange($parentContext.dishCategoryIndex(), hourIndex());
                                                                                                    }
                                                                                                },
                                                                                                hrmMask, hrmMaskPattern: 'decimal',
                                                                                                hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                                                hrmTableEditableCellInputControl,
                                                                                                hrmTableEditableCellInputControlOwner: editableCell
                                                                                            " placeholder="0">
                                                                                        </td>
                                                                                    <!-- /ko -->
                                                                                </tr>
                                                                            <!-- /ko -->
                                                                        </tbody>
                                                                    </table>

                                                                    <div data-bind="component: {
                                                                        name: 'hrm-scrollable-wrapper',
                                                                        params: {
                                                                            options: {left: {disabled: true}}
                                                                        }
                                                                    }">
                                                                        <table class="setup-wizard-page__turnover-selector-table-category-section-table"
                                                                               data-bind="hrmTable">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>Пн</th>
                                                                                    <th>Вт</th>
                                                                                    <th>Ср</th>
                                                                                    <th>Чт</th>
                                                                                    <th>Пт</th>
                                                                                    <th>Сб</th>
                                                                                    <th>Вс</th>
                                                                                </tr>
                                                                            </thead>

                                                                            <tbody>
                                                                                <tr>
                                                                                    <!-- ko foreach: {data: [1, 2, 3, 4, 5, 6, 7], as: 'weekday'} -->
                                                                                        <!-- ko if: $parent.week[weekday - 1]() !== null -->
                                                                                            <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                                                <td class="setup-wizard-page__turnover-selector-table-category-section-table-weekday-cell"
                                                                                                    data-bind="
                                                                                                        hrmTableEditableCell: editableCell,
                                                                                                        hrmTableEditableCellError: $root.turnoverStepWeekdayTotalErrorExtractor(dishCategoryIndex(), weekday)()
                                                                                                    "
                                                                                                >
                                                                                                    <input data-bind="
                                                                                                        textInput: $parent.week[weekday - 1]().weekdayTotal,
                                                                                                        event: {
                                                                                                            input: function() {
                                                                                                                $root.onTurnoverStepWeekdayTotalInput($parentContext.dishCategoryIndex());
                                                                                                            },
                                                                                                            change: function() {
                                                                                                                $root.onTurnoverStepWeekdayTotalChange($parentContext.dishCategoryIndex(), weekdayIndex());
                                                                                                            }
                                                                                                        },
                                                                                                        hrmMask, hrmMaskPattern: 'decimal',
                                                                                                        hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                                                        hrmTableEditableCellInputControl,
                                                                                                        hrmTableEditableCellInputControlOwner: editableCell
                                                                                                    " placeholder="0">
                                                                                                </td>
                                                                                            <!-- /ko -->
                                                                                        <!-- /ko -->

                                                                                        <!-- ko if: $parent.week[weekday - 1]() === null -->
                                                                                            <td class="setup-wizard-page__turnover-selector-table-weekday-cell
                                                                                                       setup-wizard-page__turnover-selector-table-weekday-cell--disabled">
                                                                                            </td>
                                                                                        <!-- /ko -->
                                                                                    <!-- /ko -->
                                                                                </tr>

                                                                                <!-- ko foreach: {data: $root.turnoverStepIntervalHours, as: 'hour'} -->
                                                                                    <tr class="setup-wizard-page__turnover-selector-table-hour-row">
                                                                                        <!-- ko foreach: {data: [1, 2, 3, 4, 5, 6, 7], as: 'weekday'} -->
                                                                                            <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                                                <!-- ko if: $parents[1].week[weekday - 1]() !== null && $parents[1].week[weekday - 1]().hours()[hourIndex()] !== null -->
                                                                                                    <td class="setup-wizard-page__turnover-selector-table-hour-cell"
                                                                                                        data-bind="
                                                                                                            hrmTableEditableCell: editableCell,
                                                                                                            hrmTableEditableCellError: $root.turnoverStepTableErrorExtractor($parents[1].week[weekday - 1]().hours()[hourIndex()])
                                                                                                        ">
                                                                                                            <input data-bind="
                                                                                                                textInput: $parents[1].week[weekday - 1]().hours()[hourIndex()],
                                                                                                                event: {
                                                                                                                    input: function() {
                                                                                                                        $root.onTurnoverStepHourInput($parentContext.dishCategoryIndex(), weekdayIndex(), hourIndex());
                                                                                                                    }
                                                                                                                },
                                                                                                                hrmMask, hrmMaskPattern: 'decimal',
                                                                                                                hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false},
                                                                                                                hrmTableEditableCellInputControl,
                                                                                                                hrmTableEditableCellInputControlOwner: editableCell,
                                                                                                            " placeholder="0">
                                                                                                    </td>
                                                                                                <!-- /ko -->

                                                                                                <!-- ko if: $parents[1].week[weekday - 1]() === null || $parents[1].week[weekday - 1]().hours()[hourIndex()] === null -->
                                                                                                    <td class="setup-wizard-page__turnover-selector-table-hour-cell
                                                                                                           setup-wizard-page__turnover-selector-table-hour-cell--disabled">
                                                                                                    </td>
                                                                                                <!-- /ko -->
                                                                                            <!-- /ko -->
                                                                                        <!-- /ko -->
                                                                                    </tr>
                                                                                <!-- /ko -->
                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>

                                                                <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_negative
                                                                               hrm-button-with-times-icon setup-wizard-page__turnover-selector-table-category-section-clear-button"
                                                                        data-bind="click: function() {$root.turnoverStepClear();}">
                                                                    Очистить
                                                                </button>
                                                            </div>
                                                        </div>
                                                    <!-- /ko -->
                                                <!-- /ko -->
                                            </div>
                                        <!-- /ko -->
                                    </div>
                                <!-- /ko -->

                                <!-- ko template: {
                                    foreach: hrmTemplateIf($root.isTurnoverStepCalculating(), $data),
                                    afterAdd: hrmFadeAfterAddFactory(200, 200),
                                    beforeRemove: hrmFadeBeforeRemoveFactory(200)
                                } -->
                                    <div>
                                        <div class="setup-wizard-page__turnover-selector-calculating">
                                            <i class="fa fa-spinner fa-pulse
                                                      setup-wizard-page__turnover-selector-calculating-indicator">
                                            </i>

                                            <span class="setup-wizard-page__turnover-selector-calculating-text">
                                                Производится расчет
                                            </span>
                                        </div>
                                    </div>
                                <!-- /ko -->

                                <!-- ko template: {
                                    foreach: hrmTemplateIf(!($root.viewportSize().width <= HRM_BREAKPOINTS.mobileMaxWidth && isTurnoverCalculated()) && !$root.isTurnoverStepCalculating(), $data),
                                    afterAdd: hrmFadeAfterAddFactory(200, 200),
                                    beforeRemove: hrmFadeBeforeRemoveFactory(200)
                                } -->
                                    <div class="setup-wizard-page__turnover-selector-actions">
                                        <!-- ko template: {
                                            foreach: hrmTemplateIf(!isTurnoverCalculated(), $data),
                                            afterAdd: hrmFadeAfterAddFactory(200, 200),
                                            beforeRemove: hrmFadeBeforeRemoveFactory(200)
                                        } -->
                                            <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_positive
                                                           hrm-button-with-check-icon setup-wizard-page__turnover-selector-action"
                                                    data-bind="click: function() {$root.turnoverStepFill();}">
                                                Заполнить автоматически
                                            </button>
                                        <!-- /ko -->

                                        <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_negative
                                                        hrm-button-with-times-icon setup-wizard-page__turnover-selector-action"
                                                data-bind="click: function() {$root.turnoverStepClear();}">
                                            Очистить
                                        </button>
                                    </div>
                                <!-- /ko -->
                            </div>

                            <div class="setup-wizard-page__tab-pane-actions">
                                <button class="hrm-button hrm-basic-button setup-wizard-page__tab-pane-actions-button"
                                        data-bind="
                                            click: function () { $root.turnoverStepBack(); },
                                            attr: {disabled: $root.isTurnoverStepCalculating()}
                                        ">
                                    Назад
                                </button>
                                <button class="hrm-button hrm-basic-button hrm-accent-button setup-wizard-page__tab-pane-actions-button"
                                        data-bind="
                                            click: function () { $root.turnoverStepSubmit(); },
                                            attr: {disabled: ($root.isTurnoverStepSubmitted() && !$root.isTurnoverStepValid()) || $root.isTurnoverStepCalculating()},
                                            css: {
                                                'setup-wizard-page__turnover-tab-pane-calculate-button': !isTurnoverCalculated()
                                            },
                                            text: !isTurnoverCalculated() ? 'Рассчитать' : 'Далее'
                                        ">
                                </button>
                            </div>
                        </div>
                    <!-- /ko -->
                    <!-- ko template: {
                        foreach: hrmTemplateIf($root.activeStep() === 5, $data),
                        afterAdd: hrmFadeAfterAddFactory(300, 400),
                        beforeRemove: hrmFadeBeforeRemoveFactory(300)
                    } -->
                        <div class="setup-wizard-page__tab-pane setup-wizard-page__positions-tab-pane">
                            <div class="setup-wizard-page__positions-selector">
                                <span class="setup-wizard-page__positions-selector-title">Выберите должности</span>

                                <div class="setup-wizard-page__positions-selector-list">
                                    <!-- ko foreach: {
                                        data: positions,
                                        beforeRemove: hrmSlideBeforeRemoveFactory(),
                                        afterAdd: hrmSlideAfterAddFactory()
                                    } -->
                                        <div class="setup-wizard-page__positions-selector-item">
                                            <div class="setup-wizard-page__positions-selector-item-content">
                                                <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                                                    <div class="setup-wizard-page__positions-selector-item-field" data-bind="
                                                        hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label
                                                    ">
                                                        <label data-bind="hrmFormFieldLabel: label">Должность</label>

                                                        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                                                            <select data-bind="
                                                                options: _.uniq([...$root.builtinPositionNames, name()]),
                                                                optionsCaption: '',
                                                                value: name,
                                                                hrmSelect, hrmSelectSearchEnabled: true,
                                                                hrmSelectCustomValuesAllowed: true,
                                                                hrmFormFieldSelectControl: control,
                                                                hrmFormFieldSelectControlErrorStateMatcher: $root.positionsStepFormControlErrorStateMatcher.bind($root)
                                                            ">
                                                                <option></option>
                                                            </select>
                                                        </div>

                                                        <div data-bind="
                                                            component: {name: 'hrm-form-field-error'},
                                                            hrmSlide,
                                                            hrmSlideValue: control() !== null ? control() !== null ? control().errorState : false : false,
                                                            hrmSlideDuration: 150
                                                        ">
                                                            <!-- ko text: $parent.name.error() --><!-- /ko -->
                                                        </div>
                                                    </div>
                                                <!-- /ko -->

                                                <!-- ko if: $parent.positions().length > 1 -->
                                                    <button class="hrm-button hrm-icon-button hrm-trash-icon-button
                                                                   hrm-icon-button--theme_negative
                                                                   setup-wizard-page__positions-selector-item-remove-button"
                                                            title="Удалить"
                                                            data-bind="click: function () {$root.positionsStepRemove($index());}">
                                                    </button>
                                                <!-- /ko -->
                                            </div>
                                        </div>
                                    <!-- /ko -->
                                </div>

                                <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_neutral
                                                hrm-button-with-plus-icon setup-wizard-page__positions-selector-add-button"
                                        data-bind="click: function () {$root.positionsStepAdd();}">
                                    Добавить
                                </button>
                            </div>

                            <div class="setup-wizard-page__tab-pane-actions">
                                <button class="hrm-button hrm-basic-button setup-wizard-page__tab-pane-actions-button"
                                        data-bind="click: function () { $root.back(); }">
                                    Назад
                                </button>
                                <button class="hrm-button hrm-basic-button hrm-accent-button setup-wizard-page__tab-pane-actions-button"
                                        data-bind="
                                            click: function () { $root.positionsStepSubmit(); },
                                            attr: {disabled: $root.isPositionsStepSubmitted() && !$root.isPositionsStepValid()}
                                        "
                                >
                                    Далее
                                </button>
                            </div>
                        </div>
                    <!-- /ko -->
                    <!-- ko template: {
                        foreach: hrmTemplateIf($root.activeStep() === 6, $data),
                        afterAdd: hrmFadeAfterAddFactory(300, 400),
                        beforeRemove: hrmFadeBeforeRemoveFactory(300)
                    } -->
                        <div class="setup-wizard-page__tab-pane setup-wizard-page__workload-type-tab-pane">
                            <div class="setup-wizard-page__workload-type-selector">
                                <div class="setup-wizard-page__workload-type-selector-header">
                                    <span class="setup-wizard-page__workload-type-selector-title">Укажите тип нагрузки</span>

                                    <!-- ko if: $root.viewportSize().width <= HRM_BREAKPOINTS.mobileMaxWidth -->
                                        <button class="hrm-button hrm-circle-icon-button
                                                       hrm-circle-icon-button--theme_neutral
                                                       hrm-circle-help-icon-button
                                                       setup-wizard-page__workload-type-selector-header-help-button"
                                                data-bind="
                                                    hrmTooltip,
                                                    hrmTooltipText: 'Для каждой должности выберите тип нагрузки и укажите норматив, который должен выполняться в день. Эти данные нужны для построения оптимального прогноза по персоналу для вашего предприятия.',
                                                    hrmTooltipMode: 'large'
                                                "
                                        >
                                        </button>
                                    <!-- /ko -->
                                </div>
                                <!-- ko if: $root.viewportSize().width > HRM_BREAKPOINTS.mobileMaxWidth -->
                                    <span class="setup-wizard-page__workload-type-selector-description">
                                        Для каждой должности выберите тип нагрузки и укажите норматив, который должен выполняться в день.
                                        Эти данные нужны для построения оптимального прогноза по персоналу для вашего предприятия.
                                    </span>
                                <!-- /ko -->

                                <div class="setup-wizard-page__workload-type-selector-list">
                                    <!-- ko foreach: {
                                        data: positions,
                                        beforeRemove: hrmSlideBeforeRemoveFactory(),
                                        afterAdd: hrmSlideAfterAddFactory()
                                    } -->
                                        <!-- ko let: {isOpen: ko.observable($index() === 0)} -->
                                            <div class="setup-wizard-page__workload-type-selector-item">
                                                <div class="setup-wizard-page__workload-type-selector-item-header">
                                                    <!-- ko if: $root.viewportSize().width <= HRM_BREAKPOINTS.mobileMaxWidth -->
                                                        <button class="hrm-button hrm-circle-icon-button
                                                                       hrm-circle-icon-button--theme_neutral
                                                                       hrm-circle-arrow-down-icon-button
                                                                       setup-wizard-page__workload-type-selector-item-header-toggle-button"
                                                                data-bind="click: function() {isOpen(!isOpen());}">
                                                        </button>
                                                    <!-- /ko -->

                                                    <span class="setup-wizard-page__workload-type-selector-item-position-name"
                                                          data-bind="text: name, click: function() {isOpen(!isOpen());}">
                                                    </span>
                                                </div>

                                                <div class="setup-wizard-page__workload-type-selector-item-control-list"
                                                     data-bind="hrmSlide, hrmSlideValue: $root.viewportSize().width > HRM_BREAKPOINTS.mobileMaxWidth || isOpen()">
                                                    <div class="setup-wizard-page__workload-type-selector-item-control-list-content">
                                                        <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                                                            <div class="setup-wizard-page__workload-type-selector-item-workload-type-form-field
                                                                        setup-wizard-page__workload-type-selector-item-control-list-item"
                                                                 data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
                                                                <label data-bind="hrmFormFieldLabel: label">Тип нагрузки</label>

                                                                <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                                                                    <select data-bind="
                                                                        value: workloadType,
                                                                        hrmSelect,
                                                                        hrmFormFieldSelectControl: control,
                                                                        hrmFormFieldSelectControlErrorStateMatcher: $root.workloadTypeStepFormControlErrorStateMatcher.bind($root)
                                                                    ">
                                                                        <option></option>
                                                                        <option value="1">Объём товара по всему предприятию</option>
                                                                        <option value="2">Объём товара по категориям</option>
                                                                    </select>
                                                                </div>

                                                                <div data-bind="
                                                                    component: {name: 'hrm-form-field-error'},
                                                                    hrmSlide,
                                                                    hrmSlideValue: control() !== null ? control() !== null ? control().errorState : false : false,
                                                                    hrmSlideDuration: 150
                                                                ">
                                                                    <!-- ko text: $parent.workloadType.error() --><!-- /ko -->
                                                                </div>
                                                            </div>
                                                        <!-- /ko -->

                                                        <!-- ko template: {
                                                            foreach: hrmTemplateIf(workloadType() === '2', $data),
                                                            afterAdd: hrmFadeAfterAddFactory(200, 200),
                                                            beforeRemove: hrmFadeBeforeRemoveFactory(200)
                                                        } -->
                                                            <!-- ko let: {checkboxGroup: ko.observable(null)} -->
                                                                <div class="hrm-form-field-checkbox-group setup-wizard-page__workload-type-selector-item-control-list-item"
                                                                     data-bind="component: {name: 'hrm-checkbox-group', params: {exportAs: checkboxGroup}}">
                                                                    <div data-bind="component: {name: 'hrm-checkbox', params: {checked: $parent.dishCategoriesExclusive, owner: checkboxGroup}}"></div>
                                                                    <label data-bind="hrmCheckboxGroupLabel, hrmCheckboxGroupLabelOwner: checkboxGroup">
                                                                        Все категории, кроме указанных
                                                                    </label>
                                                                </div>
                                                            <!-- /ko -->

                                                            <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                                                                <div class="setup-wizard-page__workload-type-selector-item-dish-categories-form-field
                                                                            setup-wizard-page__workload-type-selector-item-control-list-item"
                                                                     data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
                                                                    <label data-bind="hrmFormFieldLabel: label">Категория</label>

                                                                    <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                                                                        <select data-bind="
                                                                            options: $root.dishCategories,
                                                                            optionsText: 'name',
                                                                            optionsValue: 'id',
                                                                            optionsCaption: '',
                                                                            selectedOptions: dishCategories,
                                                                            hrmSelect, hrmSelectSearchEnabled: true,
                                                                            hrmFormFieldSelectControl: control,
                                                                            hrmFormFieldSelectControlErrorStateMatcher: $root.workloadTypeStepFormControlErrorStateMatcher.bind($root)
                                                                        " multiple>
                                                                            <option></option>
                                                                        </select>
                                                                    </div>

                                                                    <div data-bind="
                                                                        component: {name: 'hrm-form-field-error'},
                                                                        hrmSlide,
                                                                        hrmSlideValue: control() !== null ? control() !== null ? control().errorState : false : false,
                                                                        hrmSlideDuration: 150
                                                                    ">
                                                                        <!-- ko text: $parent.dishCategories.error() --><!-- /ko -->
                                                                    </div>
                                                                </div>
                                                            <!-- /ko -->
                                                        <!-- /ko -->

                                                        <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                                                            <div class="setup-wizard-page__workload-type-selector-item-units-form-field
                                                                        setup-wizard-page__workload-type-selector-item-control-list-item"
                                                                 data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
                                                                <label data-bind="hrmFormFieldLabel: label">Единицы</label>

                                                                <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                                                                    <select data-bind="
                                                                        value: units,
                                                                        hrmSelect,
                                                                        hrmFormFieldSelectControl: control,
                                                                        hrmFormFieldSelectControlErrorStateMatcher: $root.workloadTypeStepFormControlErrorStateMatcher.bind($root)
                                                                    ">
                                                                        <option></option>
                                                                        <option value="1">Штуки</option>
                                                                        <option value="2">Рубли</option>
                                                                        <option value="3">Норма времени</option>
                                                                    </select>
                                                                </div>

                                                                <div data-bind="
                                                                    component: {name: 'hrm-form-field-error'},
                                                                    hrmSlide,
                                                                    hrmSlideValue: control() !== null ? control() !== null ? control().errorState : false : false,
                                                                    hrmSlideDuration: 150
                                                                ">
                                                                    <!-- ko text: $parent.units.error() --><!-- /ko -->
                                                                </div>
                                                            </div>
                                                        <!-- /ko -->

                                                        <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                                                            <div class="setup-wizard-page__workload-type-selector-item-standard-form-field
                                                                        setup-wizard-page__workload-type-selector-item-control-list-item"
                                                                 data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
                                                                <label data-bind="hrmFormFieldLabel: label">Норматив</label>

                                                                <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                                                                    <input data-bind="
                                                                        textInput: standard,
                                                                        hrmMask, hrmMaskPattern: 'decimal',
                                                                        hrmMaskOptions: {digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false, rightAlign: false},
                                                                        hrmFormFieldInputControl: control,
                                                                        hrmFormFieldInputControlErrorStateMatcher: $root.workloadTypeStepFormControlErrorStateMatcher.bind($root)
                                                                    ">
                                                                </div>

                                                                <div data-bind="
                                                                    component: {name: 'hrm-form-field-error'},
                                                                    hrmSlide,
                                                                    hrmSlideValue: control() !== null ? control() !== null ? control().errorState : false : false,
                                                                    hrmSlideDuration: 150
                                                                ">
                                                                    <!-- ko text: $parent.standard.error() --><!-- /ko -->
                                                                </div>
                                                            </div>
                                                        <!-- /ko -->
                                                    </div>
                                                </div>
                                            </div>
                                        <!-- /ko -->
                                    <!-- /ko -->
                                </div>
                            </div>

                            <div class="setup-wizard-page__tab-pane-actions">
                                <button class="hrm-button hrm-basic-button setup-wizard-page__tab-pane-actions-button"
                                        data-bind="click: function () { $root.back(); }">
                                    Назад
                                </button>
                                <button class="hrm-button hrm-basic-button hrm-accent-button
                                               setup-wizard-page__tab-pane-actions-button setup-wizard-page__workload-type-tab-pane-build-forecast-button"
                                        data-bind="
                                            click: function () { $root.workloadTypeStepSubmit(); },
                                            attr: {disabled: $root.isWorkloadTypeStepSubmitted() && !$root.isWorkloadTypeStepValid()}
                                        "
                                >
                                    Построить прогноз
                                </button>
                            </div>
                        </div>
                    <!-- /ko -->
                </div>
            </div>

            <div class="hrm-scaffold__footer" data-bind="component: {name: 'hrm-basic-footer'}"></div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-debug.js" integrity="sha256-M5ZomNNnrnEB2WjSbnty5GWGqq6UuAAVNnWECisgEis=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/knockout.validation@2.0.4/dist/knockout.validation.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.12/js/select2.full.min.js" integrity="sha256-vucLmrjdfi9YwjGY/3CQ7HnccFSS/XRS1M/3k/FDXJw=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/js/i18n/ru.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/simplebar/5.1.0/simplebar.min.js" integrity="sha256-hFddD6XMIwFba4ITQjpv5WWE557w6O0w9RRfmGjIz4k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/1.10.2/js/OverlayScrollbars.min.js" integrity="sha256-5Tj3ZUgjHEGwF7TxpOgbPpjhq+WxXvpfb+qr9OxRHtY=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/1.10.2/js/jquery.overlayScrollbars.min.js" integrity="sha256-RE+oy7ofA6XerySMpTlDcg0gFUwHN3n0qQ5fUIZVq/M=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/gh/RobinHerbots/jquery.inputmask@4.0.9/dist/jquery.inputmask.bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js" integrity="sha256-AdQN98MVZs44Eq2yTwtoKufhnU+uZ7v2kXnD5vqzZVo=" crossorigin="anonymous"></script>
<script src="https://unpkg.com/popper.js@1"></script>
<script src="https://unpkg.com/tippy.js@5"></script>
<script src="https://unpkg.com/sticky-events@3.1.1/dist/sticky-events.umd.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.min.js" integrity="sha256-VeNaFBVDhoX3H+gJ37DpT/nTuZTdjYro9yBruHjVmoQ=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script src="assets/js/main.js"></script>

    <template id="setup-wizard-page-schedule-selector-calendar-template">
    <div class="setup-wizard-page__schedule-selector-calendar-hour-header">
        <!-- ko foreach: {data: $component.hours, as: 'hour'} -->
            <!-- ko if: $index() !== 0 -->
                <div class="setup-wizard-page__schedule-selector-calendar-hour-header-divider"
                     data-bind="css: {
                        'setup-wizard-page__schedule-selector-calendar-hour-header-divider--short': $index() % 2 === 1
                     }"
                >
                </div>
            <!-- /ko -->

            <div class="setup-wizard-page__schedule-selector-calendar-hour-header-cell"
                 data-bind="
                    css: {
                        'setup-wizard-page__schedule-selector-calendar-hour-header-cell--not-integer': !$component.isIntegerHour(hourIndex())
                    }
                 "
            >
                <div class="setup-wizard-page__schedule-selector-calendar-hour-header-cell-content">
                    <!-- ko if: $component.getHourHeaderCellTextData(hourIndex()) !== null -->
                        <span class="setup-wizard-page__schedule-selector-calendar-hour-header-cell-time">
                            <!-- ko text: $component.getHourHeaderCellTextData(hourIndex()).hour -->
                            <!-- /ko --><sup class="setup-wizard-page__schedule-selector-calendar-hour-header-cell-minute"
                                  data-bind="text: $component.getHourHeaderCellTextData(hourIndex()).minute">
                            </sup>
                        </span>
                    <!-- /ko -->
                </div>
            </div>
        <!-- /ko -->
    </div>

    <!-- ko foreach: {data: [1, 2, 3, 4, 5, 6, 7], as: 'weekday'} -->
        <div class="setup-wizard-page__schedule-selector-calendar-weekday">
            <span class="setup-wizard-page__schedule-selector-calendar-weekday-label"
                  data-bind="text: $component.getWeekdayLabelText(weekday)">
            </span>

            <!-- ko foreach: {data: $component.hours, as: 'hour'} -->
                <!-- ko if: $index() !== 0 -->
                    <div class="setup-wizard-page__schedule-selector-calendar-weekday-divider"></div>
                <!-- /ko -->
                <div class="setup-wizard-page__schedule-selector-calendar-hour"
                     data-bind="
                        event: {
                            mousedown: function () {$component.hourMousedownOrTouchstart(weekday, hour);},
                            touchstart: function () {$component.hourMousedownOrTouchstart(weekday, hour);},
                            mouseover: function () {$component.hourMouseover(weekday, hour);}
                        },
                        css: {
                            'setup-wizard-page__schedule-selector-calendar-hour--not-integer': !$component.isIntegerHour(hourIndex()),
                            'setup-wizard-page__schedule-selector-calendar-hour--picked': $component.isPickedHour(weekday, hour)
                        },
                        attr: {
                            'data-setup-wizard-page-schedule-selector-calendar-hour-week': weekday,
                            'data-setup-wizard-page-schedule-selector-calendar-hour-hour': hour
                        }
                     "
                >
                </div>
            <!-- /ko -->
        </div>
    <!-- /ko -->
</template>

<script type="text/javascript">
    ko.components.register('setup-wizard-page-schedule-selector-calendar', {
        viewModel: {
            createViewModel: function (params, componentInfo) {
                const $element = $(componentInfo.element);

                $element.addClass(['setup-wizard-page__schedule-selector-calendar']);

                const ViewModel = function () {
                    this.subscriptions = [];

                    this.value = params.value;
                    this.intervalStart = params.intervalStart;
                    this.intervalEnd = params.intervalEnd;

                    this.isPicking = ko.observable(false);

                    this.touchmoveHandler = event => {
                        const touchPosition = event.originalEvent.changedTouches[0];
                        const $target = $(document.elementFromPoint(touchPosition.clientX, touchPosition.clientY));

                        if ($target.hasClass('setup-wizard-page__schedule-selector-calendar-hour')) {
                            const weekday = $target.data('setup-wizard-page-schedule-selector-calendar-hour-week');
                            const hour = $target.data('setup-wizard-page-schedule-selector-calendar-hour-hour');

                            if (this.isPicking()) {
                                if (!this.isPickedHour(weekday, hour)) {
                                    this.value[weekday - 1].push(hour);
                                    this.value[weekday - 1].sort();
                                }
                            }
                        }
                    };

                    this.windowMouseupHandler = () => this.isPicking(false);

                    this.hours = ko.pureComputed(() => {
                        const start = moment(this.intervalStart(), 'HH:mm');
                        const end = moment(this.intervalEnd(), 'HH:mm');

                        if (start.isSameOrAfter(end)) {
                            end.add(1, 'd');
                        }

                        const isEndHourInteger = end.minutes() === 0;

                        if (!isEndHourInteger) {
                            end.add(1, 'h').minutes(0);
                        }

                        const hours = [];

                        while (start.isBefore(end)) {
                            hours.push(start.hours());
                            start.add(1, 'h');
                        }

                        return hours;
                    });

                    this.isStartHourInteger = ko.pureComputed(() => {
                        return moment(this.intervalStart(), 'HH:mm').minutes() === 0;
                    });

                    this.isEndHourInteger = ko.pureComputed(() => {
                        return moment(this.intervalEnd(), 'HH:mm').minutes() === 0;
                    });

                    this.isIntegerHour = function (hourIndex) {
                        const hours = this.hours();

                        if (hourIndex === 0) {
                            return this.isStartHourInteger();
                        } else if (hourIndex === hours.length - 1) {
                            return this.isEndHourInteger();
                        } else {
                            return true;
                        }
                    };

                    this.isPickedHour = function (weekday, hour) {
                        return this.value[weekday - 1]().includes(hour);
                    };

                    this.hourMousedownOrTouchstart = function (weekday, hour) {
                        if (!this.isPickedHour(weekday, hour)) {
                            this.isPicking(true);
                            this.value[weekday - 1].push(hour);
                        } else {
                            this.value[weekday - 1].remove(hour);
                        }

                        this.value[weekday - 1].sort();
                    };

                    this.hourMouseover = function (weekday, hour) {
                        if (this.isPicking()) {
                            if (!this.isPickedHour(weekday, hour)) {
                                this.value[weekday - 1].push(hour);
                                this.value[weekday - 1].sort();
                            }
                        }
                    };

                    this.getWeekdayLabelText = function (weekday) {
                        switch (weekday) {
                            case 1: return 'Пн';
                            case 2: return 'Вт';
                            case 3: return 'Ср';
                            case 4: return 'Чт';
                            case 5: return 'Пт';
                            case 6: return 'Сб';
                            case 7: return 'Вс';
                        }
                    };

                    this.getHourHeaderCellTextData = function (hourIndex) {
                        function process (time) {
                            const parts = time.split(':');

                            return {
                                hour: parts[0],
                                minute: parts[1]
                            };
                        }

                        const hours = this.hours();

                        if (hourIndex === 0) {
                            return process(this.intervalStart());
                        } else if (hourIndex !== hours.length - 1 && hourIndex % 2 === 0) {
                            return process(moment().hour(hours[hourIndex]).minute(0).format('HH:mm'));
                        } else {
                            return null;
                        }
                    };

                    this.pickAll = function () {
                        const hours = this.hours();
                        this.value.forEach(week => week([...hours]));
                    };

                    this.clear = function () {
                        this.value.forEach(week => week([]));
                    };

                    this.descendantsComplete = () => {
                        $element.on('touchmove', this.touchmoveHandler);
                        $(window).on('mouseup touchend', this.windowMouseupHandler);
                    };

                    (() => {
                        this.subscriptions.push(
                            ko.bindingEvent.subscribe(componentInfo.element, 'descendantsComplete', this.descendantsComplete)
                        );

                        if (params !== undefined && 'exportAs' in params) {
                            if (ko.isObservableArray(params.exportAs)) {
                                params.exportAs.push(this);
                            } else {
                                params.exportAs(this);
                            }
                        }
                    })();
                };

                ViewModel.prototype.dispose = function() {
                    this.subscriptions.forEach(s => s.dispose());
                    $element.off('touchmove', this.touchmoveHandler);
                    $(window).off('mouseup touchend', this.windowMouseupHandler);

                    if (params !== undefined && 'exportAs' in params) {
                        if (ko.isObservableArray(params.exportAs)) {
                            params.exportAs.remove(this);
                        } else {
                            params.exportAs(null);
                        }
                    }
                };

                return new ViewModel();
            }
        },
        template: {element: 'setup-wizard-page-schedule-selector-calendar-template'}
    });
</script>
    <script type="text/javascript">
    // setupWizardPageTurnoverSelectorTable
    (() => {
        class ViewModel {
            constructor(element, categoryRowElements) {
                this._subscriptions = [];
                this.element = element;
                this._categoryRowElements = categoryRowElements;
                this._bodyScrollHandler = () => {
                    this._updateActiveCategoryIndex();
                };
                this.activeCategoryIndex = ko.observable(null);

                this._init();
            }

            _init() {
                const $element = $(this.element);
                $element.addClass('setup-wizard-page__turnover-selector-table');

                if (this._categoryRowElements !== null) {
                    this._subscriptions.push(this._categoryRowElements.subscribe(() => {
                        this._updateActiveCategoryIndex();
                    }));

                    $('.hrm-scaffold__body').on('scroll', this._bodyScrollHandler);

                    this._updateActiveCategoryIndex();
                }
            }

            _destroy() {
                this._subscriptions.forEach(s => s.dispose());
                $('.hrm-scaffold__body').off('scroll', this._bodyScrollHandler);
            }

            _updateActiveCategoryIndex() {
                const rowElements = this._categoryRowElements();

                if (rowElements.length === 0) {
                    this.activeCategoryIndex(null);
                    return;
                }

                for (let i = 0; i < rowElements.length; i++) {
                    if ($(rowElements[i]).offset().top - $(window).scrollTop() > 0) {
                        this.activeCategoryIndex(Math.max(i - 1, 0));
                        return;
                    }
                }

                this.activeCategoryIndex(rowElements.length - 1);
            }
        }

        ko.bindingHandlers.setupWizardPageTurnoverSelectorTable = {
            init: function (element, valueAccessor, allBindings) {
                const categoryRowElements = allBindings.get('setupWizardPageTurnoverSelectorTableCategoryRowElements') || null;
                const viewModel = new ViewModel(element, categoryRowElements);

                if (valueAccessor() !== undefined) {
                    if (ko.isObservableArray(valueAccessor())) {
                        valueAccessor().push(viewModel);
                    } else {
                        valueAccessor()(viewModel);
                    }
                }

                ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
                    if (valueAccessor() !== undefined) {
                        if (ko.isObservableArray(valueAccessor())) {
                            valueAccessor().remove(this);
                        } else {
                            valueAccessor()(null);
                        }
                    }

                    viewModel._destroy();
                });
            }
        };
    })();

    $(function () {
        const $page = $(document.documentElement);

        const ViewModel = function () {
            this.dishCategories = [
                {
                    id: '1',
                    name: 'Пицца',
                    turnoverDistribution: [
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5]
                    ]
                },
                {
                    id: '2',
                    name: 'Роллы',
                    turnoverDistribution: [
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5]
                    ]
                },
                {
                    id: '3',
                    name: 'Супы',
                    turnoverDistribution: [
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5]
                    ]
                },
                {
                    id: '4',
                    name: 'Салаты',
                    turnoverDistribution: [
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5]
                    ]
                },
                {
                    id: '5',
                    name: 'Закуски',
                    turnoverDistribution: [
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5]
                    ]
                },
                {
                    id: '6',
                    name: 'Десерты',
                    turnoverDistribution: [
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5]
                    ]
                },
                {
                    id: '7',
                    name: 'Напитки',
                    turnoverDistribution: [
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5],
                        [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5]
                    ]
                }
            ];

            this.builtinPositionNames = ['Повар-пиццмейкер', 'Повар-сушист', 'Мороженщик'];

            this.subscriptions = [];

            this.windowResizeHandler = () => {
                this.viewportSize({width: $(window).width(), height: $(window).height()});
            };
            this.viewportSize = ko.observable({width: $(window).width(), height: $(window).height()});

            this.activeStep = ko.observable(1);

            this.childrenComplete = function () {
                $page.removeClass('hrm-page--initializing');
            };

            this.getDishCategory = function (categoryId) {
                return this.dishCategories.find(c => c.id === categoryId);
            };

            this.back = function () {
                if (this.activeStep() > 0) {
                    this.activeStep(this.activeStep() - 1);
                }
            };

            this.createDishCategoryWeekdayFormModel = function () {
                return {
                    hours: ko.observable(null),
                    weekdayTotal: ko.observable('').extend({
                        required: {
                            message: 'Обязательное поле'
                        }
                    })
                }
            };

            this.createDishCategoryFormModel = function (value, list) {
                const formModel = {
                    value: ko.observable(value).extend({
                        required: {
                            message: 'Выберите категорию блюд'
                        },
                        validation: {
                            validator: v => {
                                const selfIndex = list().indexOf(formModel);
                                return list().filter((item, index) => index < selfIndex).every(item => item.value() !== v);
                            },
                            message: 'Данная категория уже выбрана'
                        }
                    }),
                    units: ko.observable('0'),
                    week: [1, 2, 3, 4, 5, 6, 7].map(() => ko.observable(null)),
                    hourTotals: ko.observable(null),
                    weekTotal: ko.observable('').extend({
                        required: {
                            message: 'Обязательное поле'
                        }
                    })
                };

                return formModel;
            };

            this.createPositionFormModel = function (name = '') {
                return {
                    name: ko.observable(name).extend({
                        required: {
                            message: 'Выберите должность'
                        }
                    }),
                    workloadType: ko.observable('').extend({
                        required: {
                            message: 'Обязательное поле'
                        }
                    }),
                    units: ko.observable('').extend({
                        required: {
                            message: 'Обязательное поле'
                        }
                    }),
                    standard: ko.observable('').extend({
                        required: {
                            message: 'Обязательное поле'
                        }
                    }),
                    dishCategories: ko.observableArray([]).extend({
                        required: {
                            message: 'Обязательное поле'
                        }
                    }),
                    dishCategoriesExclusive: ko.observable(false)
                }
            };

            this.formModel = (() => {
                const dishCategories = ko.observableArray([]);

                dishCategories.push(
                    this.createDishCategoryFormModel('', dishCategories)
                );

                return ko.validatedObservable({
                    companyType: ko.observable(null),
                    dishCategories,
                    isTurnoverCalculated: ko.observable(false),
                    intervalStart: ko.observable('08:00').extend({
                        required: true,
                        hrmDate: {
                            params: 'HH:mm',
                            message: 'Неверный формат времени'
                        }
                    }),
                    intervalEnd: ko.observable('20:00').extend({
                        required: true,
                        hrmDate: {
                            params: 'HH:mm',
                            message: 'Неверный формат времени'
                        }
                    }),
                    schedule: [
                        ko.observableArray([]),
                        ko.observableArray([]),
                        ko.observableArray([]),
                        ko.observableArray([]),
                        ko.observableArray([]),
                        ko.observableArray([]),
                        ko.observableArray([])
                    ],
                    positions: ko.observableArray([
                        this.createPositionFormModel()
                    ])
                });
            })();

            this.companyTypeStepSelect = function (type) {
                this.formModel().companyType(type);
                this.activeStep(2);
            };

            this.isDishCategoriesStepSubmitted = ko.observable(false);

            this.isDishCategoriesStepValid = ko.pureComputed(() => {
                return this.formModel().dishCategories().every(c => c.value.isValid());
            });

            this.dishCategoriesStepAdd = function () {
                this.formModel().dishCategories.push(
                    this.createDishCategoryFormModel('', this.formModel().dishCategories)
                );
            };

            this.dishCategoriesStepRemove = function (index) {
                this.formModel().dishCategories.splice(index, 1);
            };

            this.dishCategoriesStepFormControlErrorStateMatcher = function (formControl) {
                return ko.pureComputed(() => {
                    return this.isDishCategoriesStepSubmitted() && !formControl.isValid();
                });
            };

            this.dishCategoriesStepSubmit = function () {
                this.isDishCategoriesStepSubmitted(true);

                if (this.isDishCategoriesStepValid()) {
                    this.activeStep(this.activeStep() + 1);
                }
            };

            this.scheduleStepCalendar = ko.observable(null);

            this.scheduleStepLastValidIntervalStart = ko.observable(this.formModel().intervalStart());
            this.scheduleStepLastValidIntervalEnd = ko.observable(this.formModel().intervalEnd());

            this.isScheduleStepIntervalValid = ko.pureComputed(() => {
                return this.formModel().intervalStart.isValid() &&
                       this.formModel().intervalEnd.isValid();
            });

            this.isScheduleStepValid = ko.pureComputed(() => {
                return this.isScheduleStepIntervalValid() && this.formModel().schedule.some(weekday => weekday().length > 0);
            });

            this.scheduleStepUsedIntervalStart = ko.pureComputed(() => {
                if (this.isScheduleStepIntervalValid()) {
                    return this.formModel().intervalStart();
                } else {
                    return this.scheduleStepLastValidIntervalStart();
                }
            });

            this.scheduleStepUsedIntervalEnd = ko.pureComputed(() => {
                if (this.isScheduleStepIntervalValid()) {
                    return this.formModel().intervalEnd();
                } else {
                    return this.scheduleStepLastValidIntervalEnd();
                }
            });

            this.scheduleStepIntervalBoundaryFormControlErrorStateMatcher = function (formControl) {
                return ko.pureComputed(() => {
                    return !formControl.isValid();
                });
            };

            this.scheduleStepCutSchedule = function () {
                const start = moment(this.scheduleStepUsedIntervalStart(), 'HH:mm');
                const end = moment(this.scheduleStepUsedIntervalEnd(), 'HH:mm');

                const startHour = start.hour() === 0 ? (start.isBefore(end) ? 0 : 24) : start.hour();
                const endHour = end.hour() === 0 ? (start.isBefore(end) ? 24 : 0) : end.hour();

                this.formModel().schedule.forEach(week => {
                    if (start.isBefore(end)) {
                        week.remove(hour => hour < startHour || hour > endHour);
                    } else {
                        week.remove(hour => hour < endHour && hour > startHour);
                    }

                    week.sort();
                });
            };

            this.scheduleStepSubmit = function () {
                if (this.isScheduleStepValid()) {
                    this.activeStep(this.activeStep() + 1);
                }
            };

            this.scheduleStepFill = function () {
                if (!this.isScheduleStepIntervalValid()) {
                    this.formModel().intervalStart(this.scheduleStepLastValidIntervalStart());
                }

                if (!this.isScheduleStepIntervalValid()) {
                    this.formModel().intervalEnd(this.scheduleStepLastValidIntervalEnd());
                }

                this.scheduleStepCalendar().pickAll();
            };

            this.isTurnoverStepSubmitted = ko.observable(false);
            this.isTurnoverStepCalculating = ko.observable(false);

            this.turnoverStepPreCalculatedDishCategoryValues = ko.observableArray([]);

            this.turnoverStepLastWeekTotals = ko.observable(null);
            this.turnoverStepLastWeekdayTotals = ko.observable(null);
            this.turnoverStepLastHourTotals = ko.observable(null);

            this.turnoverStepUpdateLastWeekTotal = function (categoryIndex) {
                const weekTotal = this.formModel().dishCategories()[categoryIndex].weekTotal();
                this.turnoverStepLastWeekTotals()[categoryIndex](weekTotal);
            };

            this.turnoverStepUpdateLastWeekdayTotal = function (categoryIndex, weekdayIndex) {
                const weekday = this.formModel().dishCategories()[categoryIndex].week[weekdayIndex];
                const weekdayTotal = weekday !== null ? weekday().weekdayTotal() : null;
                this.turnoverStepLastWeekdayTotals()[categoryIndex][weekdayIndex](weekdayTotal);
            };

            this.turnoverStepUpdateLastHourTotal = function (categoryIndex, hourIndex) {
                const hourTotal = this.formModel().dishCategories()[categoryIndex].hourTotals()[hourIndex]();
                this.turnoverStepLastHourTotals()[categoryIndex][hourIndex](hourTotal);
            };

            this.turnoverStepIntervalHours = ko.pureComputed(() => {
                if (!this.formModel().intervalStart.isValid() || !this.formModel().intervalEnd.isValid()) {
                    return null;
                }

                const start = moment(this.formModel().intervalStart(), 'HH:mm');
                const end = moment(this.formModel().intervalEnd(), 'HH:mm');

                if (start.isSameOrAfter(end)) {
                    end.add(1, 'd');
                }

                const isEndHourInteger = end.minutes() === 0;

                if (!isEndHourInteger) {
                    end.add(1, 'h').minutes(0);
                }

                let hours = [];

                while (start.isBefore(end)) {
                    hours.push(start.hours());
                    start.add(1, 'h');
                }

                hours = hours.filter(hour => this.formModel().schedule.some(weekday => weekday().includes(hour)));

                return hours;
            });

            this.onTurnoverStepWeekTotalChange = function (categoryIndex) {
                const dishCategory = this.formModel().dishCategories()[categoryIndex];

                if (this.formModel().isTurnoverCalculated()) {
                    const previousTotal = this.turnoverStepUnmaskValue(this.turnoverStepLastWeekTotals()[categoryIndex]());
                    const total = this.turnoverStepUnmaskValue(dishCategory.weekTotal());

                    if (previousTotal !== 0) {
                        const changeFactor = total / previousTotal;
                        this.turnoverStepChangeWeekTotal(categoryIndex, total / previousTotal);
                        [1, 2, 3, 4, 5, 6, 7].forEach((weekday, weekdayIndex) => {
                            if (dishCategory.week[weekdayIndex]() !== null) {
                                this.turnoverStepChangeWeekdayTotal(categoryIndex, weekdayIndex, changeFactor);
                            }
                        });
                    } else {
                        this.turnoverStepDivideWeekTotal(categoryIndex);
                        [1, 2, 3, 4, 5, 6, 7].forEach((weekday, weekdayIndex) => {
                            if (dishCategory.week[weekdayIndex]() !== null) {
                                this.turnoverStepDistributeWeekdayTotal(categoryIndex, weekdayIndex);
                            }
                        });
                    }

                    this.turnoverStepIntervalHours().forEach((hour, hourIndex) => {
                        this.turnoverStepCalculateHourTotal(categoryIndex, hourIndex);
                        this.turnoverStepUpdateLastHourTotal(categoryIndex, hourIndex);
                    });

                    this.turnoverStepUpdateLastWeekTotal(categoryIndex);
                } else {
                    this.turnoverStepDivideWeekTotal(categoryIndex);
                    this.turnoverStepCategoriesWithFillingError.remove(categoryIndex);
                }
            };

            this.turnoverStepDivideWeekTotal = function (categoryIndex) {
                const dishCategory = this.formModel().dishCategories()[categoryIndex];

                const total = this.turnoverStepUnmaskValue(dishCategory.weekTotal());
                const enabledWeekdayCount = dishCategory.week.filter(wd => wd() !== null).length;
                const portion = Math.floor((total / enabledWeekdayCount) * 100) / 100;
                this.formModel().dishCategories()[categoryIndex].week
                    .filter(wd => wd() !== null)
                    .forEach(weekday => weekday().weekdayTotal(this.turnoverStepFormatValue(portion)));
            };

            this.turnoverStepChangeWeekTotal = function (categoryIndex, changeFactor) {
                this.formModel().dishCategories()[categoryIndex].week.forEach(weekday => {
                    if (weekday() !== null) {
                        const value = this.turnoverStepUnmaskValue(weekday().weekdayTotal()) * changeFactor;
                        weekday().weekdayTotal(this.turnoverStepFormatValue(value));
                    }
                });
            };

            this.onTurnoverStepWeekdayTotalChange = function (categoryIndex, weekdayIndex) {
                if (this.formModel().isTurnoverCalculated()) {
                    const previousTotal = this.turnoverStepUnmaskValue(this.turnoverStepLastWeekdayTotals()[categoryIndex][weekdayIndex]());

                    if (previousTotal !== 0) {
                        const total = this.turnoverStepUnmaskValue(this.formModel().dishCategories()[categoryIndex].week[weekdayIndex]().weekdayTotal());
                        this.turnoverStepChangeWeekdayTotal(categoryIndex, weekdayIndex, total / previousTotal);
                    } else {
                        this.turnoverStepDistributeWeekdayTotal(categoryIndex, weekdayIndex);
                    }

                    this.turnoverStepIntervalHours().forEach((hour, hourIndex) => {
                        this.turnoverStepCalculateHourTotal(categoryIndex, hourIndex);
                        this.turnoverStepUpdateLastHourTotal(categoryIndex, hourIndex);
                    });

                    this.turnoverStepUpdateLastWeekdayTotal(categoryIndex, weekdayIndex);
                }
            };

            this.turnoverStepChangeWeekdayTotal = function (categoryIndex, weekdayIndex, changeFactor) {
                this.formModel().dishCategories()[categoryIndex].week[weekdayIndex]().hours().forEach(hour => {
                    if (hour !== null) {
                        const value = this.turnoverStepUnmaskValue(hour()) * changeFactor;
                        hour(this.turnoverStepFormatValue(value));
                    }
                });
            };

            this.turnoverStepDistributeWeekdayTotal = function (categoryIndex, weekdayIndex) {
                const category = this.formModel().dishCategories()[categoryIndex];
                const total = this.turnoverStepUnmaskValue(category.week[weekdayIndex]().weekdayTotal());

                const weekdayDistribution = this.getDishCategory(category.value()).turnoverDistribution[weekdayIndex]
                    .filter((factor, hourIndex) => this.turnoverStepIntervalHours().includes(hourIndex))
                    .map((factor, hourIndex) => category.week[weekdayIndex]().hours()[hourIndex] !== null ? factor : 0);

                const weekdayDistributionSum = weekdayDistribution.reduce((sum, factor) => sum + factor, 0);

                this.turnoverStepIntervalHours().forEach((_, hourIndex) => {
                    const hourValue = category.week[weekdayIndex]().hours()[hourIndex];

                    if (hourValue !== null) {
                        const value = total * weekdayDistribution[hourIndex] / weekdayDistributionSum;
                        hourValue(this.turnoverStepFormatValue(value));
                    }
                });
            };

            this.onTurnoverStepWeekdayTotalInput = function (categoryIndex) {
                this.turnoverStepCalculateWeekTotal(categoryIndex);

                if (this.formModel().isTurnoverCalculated()) {
                    this.turnoverStepUpdateLastWeekTotal(categoryIndex);
                } else {
                    this.turnoverStepCategoriesWithFillingError.remove(categoryIndex);
                }
            };

            this.onTurnoverStepHourInput = function (categoryIndex, weekdayIndex, hourIndex) {
                this.turnoverStepCalculateWeekdayTotal(categoryIndex, weekdayIndex);
                this.turnoverStepCalculateWeekTotal(categoryIndex);
                this.turnoverStepCalculateHourTotal(categoryIndex, hourIndex);

                this.turnoverStepUpdateLastWeekdayTotal(categoryIndex, weekdayIndex);
                this.turnoverStepUpdateLastWeekTotal(categoryIndex);
                this.turnoverStepUpdateLastHourTotal(categoryIndex, hourIndex);
            };

            this.onTurnoverStepHourTotalChange = function (categoryIndex, hourIndex) {
                const dishCategory = this.formModel().dishCategories()[categoryIndex];
                const previousTotal = this.turnoverStepUnmaskValue(this.turnoverStepLastHourTotals()[categoryIndex][hourIndex]());

                if (previousTotal !== 0) {
                    const total = this.turnoverStepUnmaskValue(dishCategory.hourTotals()[hourIndex]());
                    this.turnoverStepChangeHourTotal(categoryIndex, hourIndex, total / previousTotal);
                } else {
                    this.turnoverStepDivideHourTotal(categoryIndex, hourIndex);
                }

                [1, 2, 3, 4, 5, 6, 7].forEach((weekday, weekdayIndex) => {
                    if (dishCategory.week[weekdayIndex]() !== null) {
                        this.turnoverStepCalculateWeekdayTotal(categoryIndex, weekdayIndex);
                    }
                });

                this.turnoverStepCalculateWeekTotal(categoryIndex);
                this.turnoverStepUpdateLastHourTotal(categoryIndex, hourIndex);
            };

            this.turnoverStepDivideHourTotal = function (categoryIndex, hourIndex) {
                const category = this.formModel().dishCategories()[categoryIndex];
                const total = this.turnoverStepUnmaskValue(category.hourTotals()[hourIndex]());
                const enabledHours = category.week.map(weekday => weekday().hours()[hourIndex]).filter(hour => hour !== null);

                if (enabledHours.length !== 0) {
                    const portion = Math.floor((total / enabledHours.length) * 100) / 100;
                    enabledHours.forEach(hour => {
                        hour(this.turnoverStepFormatValue(portion));
                    });
                }
            };

            this.turnoverStepChangeHourTotal = function (categoryIndex, hourIndex, changeFactor) {
                const dishCategory = this.formModel().dishCategories()[categoryIndex];

                [1, 2, 3, 4, 5, 6, 7].forEach((weekday, weekdayIndex) => {
                    if (dishCategory.week[weekdayIndex]() !== null) {
                        const hour = dishCategory.week[weekdayIndex]().hours()[hourIndex];
                        const value = this.turnoverStepUnmaskValue(hour()) * changeFactor;
                        hour(this.turnoverStepFormatValue(value));
                    }
                });
            };

            this.turnoverStepCalculateWeekTotal = function (categoryIndex) {
                const category = this.formModel().dishCategories()[categoryIndex];
                const total = category.week.reduce((total, wd) => {
                    if (wd() !== null) {
                        return total + this.turnoverStepUnmaskValue(wd().weekdayTotal());
                    } else {
                        return total;
                    }
                }, 0);

                category.weekTotal(this.turnoverStepFormatValue(total));
            };

            this.turnoverStepCalculateWeekdayTotal = function (categoryIndex, weekdayIndex) {
                const category = this.formModel().dishCategories()[categoryIndex];
                const weekdayTotal = category.week[weekdayIndex]().hours().reduce((total, hour) => total + (hour !== null ? this.turnoverStepUnmaskValue(hour()) : 0), 0);
                category.week[weekdayIndex]().weekdayTotal(this.turnoverStepFormatValue(weekdayTotal));
            };

            this.turnoverStepCalculateHourTotal = function (categoryIndex, hourIndex) {
                const total = this.formModel().dishCategories()[categoryIndex].week.reduce((total, weekday) => {
                    if (weekday() !== null) {
                        return total + (weekday().hours()[hourIndex] !== null ? this.turnoverStepUnmaskValue(weekday().hours()[hourIndex]()) : 0);
                    } else {
                        return total;
                    }
                }, 0);

                this.formModel().dishCategories()[categoryIndex].hourTotals()[hourIndex](this.turnoverStepFormatValue(total));
            };

            this.turnoverStepCategoriesWithFillingError = ko.observableArray([]);

            this.turnoverStepWeekdayTotalErrorExtractor = function (dishCategoryIndex, weekday) {
                return ko.pureComputed(() => {
                    const dishCategoryFirstEnabledWeekday = this.formModel().dishCategories()[dishCategoryIndex].week.findIndex(wd => wd() !== null) + 1;

                    if (this.turnoverStepCategoriesWithFillingError().includes(dishCategoryIndex) && weekday === dishCategoryFirstEnabledWeekday) {
                        return {message: 'Для автоматического заполнения данными, введите хотя бы одно значение'};
                    } else {
                        const control = this.formModel().dishCategories()[dishCategoryIndex].week[weekday - 1]().weekdayTotal;
                        return (this.isTurnoverStepSubmitted() && !control.isValid()) ? {message: control.error()} : null
                    }
                });
            };

            this.turnoverStepTableErrorExtractor = function (control) {
                return ko.pureComputed(() => {
                    return (this.isTurnoverStepSubmitted() && !control.isValid()) ? {message: control.error()} : null;
                });
            };

            this.turnoverStepFill = function () {
                const valuesByUnits = {};

                this.turnoverStepCategoriesWithFillingError([]);

                this.formModel().dishCategories().forEach(category => {
                    const values = [];

                    if (!(category.units() in valuesByUnits)) {
                        valuesByUnits[category.units()] = [];
                    }

                    category.week.forEach(weekday => {
                        if (weekday() !== null && weekday().weekdayTotal() !== '') {
                            if (!valuesByUnits[category.units()].includes(weekday().weekdayTotal())) {
                                valuesByUnits[category.units()].push(weekday().weekdayTotal());
                            }

                            if (!values.includes(weekday().weekdayTotal())) {
                                values.push(weekday().weekdayTotal());
                            }
                        }
                    });

                    if (values.length === 1) {
                        category.week.forEach(weekday => {
                            if (weekday() !== null) {
                                weekday().weekdayTotal(values[0]);
                            }
                        });
                    }
                });

                this.formModel().dishCategories().forEach((category, categoryIndex) => {
                    if (valuesByUnits[category.units()].length === 1 && !category.week.some(wd => wd() !== null && wd() === '')) {
                        category.week.forEach(weekday => {
                            if (weekday() !== null) {
                                weekday().weekdayTotal(valuesByUnits[category.units()][0]);
                            }
                        });
                    } else if (valuesByUnits[category.units()].length === 0) {
                        if (!this.turnoverStepCategoriesWithFillingError().includes(categoryIndex)) {
                            this.turnoverStepCategoriesWithFillingError.push(categoryIndex);
                        }
                    }

                    this.turnoverStepCalculateWeekTotal(categoryIndex);
                });
            };

            this.turnoverStepClear = function () {
                if (this.formModel().isTurnoverCalculated()) {
                    this.isTurnoverStepSubmitted(false);

                    this.formModel().dishCategories().forEach((category, categoryIndex) => {
                        const values = this.turnoverStepPreCalculatedDishCategoryValues()[categoryIndex];

                        category.week.forEach((weekday, weekdayIndex) => {
                            if (weekday() !== null) {
                                weekday().hours().forEach((hour, hourIndex) => {
                                    if (hour !== null) {
                                        hour(values.week[weekdayIndex].hours[hourIndex])
                                    }
                                });
                                weekday().weekdayTotal(values.week[weekdayIndex].weekdayTotal);
                            }
                        });

                        category.weekTotal(values.weekTotal);
                        category.hourTotals().forEach((hour, hourIndex) => hour(values.hourTotals[hourIndex]));
                    });
                } else {
                    this.formModel().dishCategories().forEach((category, index) => {
                        category.week.forEach(weekday => {
                            if (weekday() !== null) {
                                weekday().weekdayTotal('')
                            }
                        });
                        category.weekTotal('');
                        this.turnoverStepCategoriesWithFillingError.remove(index);
                    });
                }
            };

            this.turnoverStepBack = function () {
                if (this.formModel().isTurnoverCalculated()) {
                    this.turnoverStepReset();
                } else {
                    this.back();
                }
            };

            this.isTurnoverStepValid = ko.pureComputed(() => {
                for (let category of this.formModel().dishCategories()) {
                    if (category.weekTotal() === '') {
                        return false;
                    }

                    for (let weekday of category.week) {
                        if (weekday() !== null) {
                            if (weekday().weekdayTotal() === '') {
                                return false;
                            }

                            if (this.formModel().isTurnoverCalculated()) {
                                for (let hour of weekday().hours()) {
                                    if (hour !== null && hour() === '') {
                                        return false;
                                    }
                                }
                            }
                        }
                    }

                    if (this.formModel().isTurnoverCalculated()) {
                        for (let hourTotal of category.hourTotals()) {
                            if (hourTotal() === '') {
                                return false;
                            }
                        }
                    }
                }

                return true;
            });

            this.turnoverStepSubmit = function () {
                this.isTurnoverStepSubmitted(true);

                if (this.isTurnoverStepValid()) {
                    if (!this.formModel().isTurnoverCalculated()) {
                        this.isTurnoverStepCalculating(true);

                        setTimeout(() => {
                            const schedule = this.formModel().schedule;

                            this.formModel().dishCategories().forEach((category, categoryIndex) => {
                                category.week.forEach((weekday, weekdayIndex) => {
                                    if (weekday() !== null) {
                                        weekday().hours(this.turnoverStepIntervalHours().map(hour => {
                                            if (schedule[weekdayIndex]().includes(hour)) {
                                                return ko.observable('').extend({
                                                    required: {
                                                        message: 'Обязательное поле'
                                                    }
                                                });
                                            } else {
                                                return null;
                                            }
                                        }));

                                        this.turnoverStepDistributeWeekdayTotal(categoryIndex, weekdayIndex);
                                    }
                                });

                                category.hourTotals(this.turnoverStepIntervalHours().map(() => ko.observable('').extend({
                                    required: {
                                        message: 'Обязательное поле'
                                    }
                                })));

                                this.turnoverStepIntervalHours().forEach((hour, hourIndex) => {
                                    this.turnoverStepCalculateHourTotal(categoryIndex, hourIndex);
                                });

                                this.turnoverStepPreCalculatedDishCategoryValues.push({
                                    week: category.week.map(weekday => {
                                        if (weekday() !== null) {
                                            return {
                                                hours: weekday().hours().map(hour => hour !== null ? hour() : null),
                                                weekdayTotal: weekday().weekdayTotal()
                                            };
                                        } else {
                                            return null;
                                        }
                                    }),
                                    weekTotal: category.weekTotal(),
                                    hourTotals: category.hourTotals().map(hour => hour())
                                });
                            });

                            this.turnoverStepLastWeekTotals(this.formModel().dishCategories().map(category => ko.observable(category.weekTotal())));
                            this.turnoverStepLastWeekdayTotals(this.formModel().dishCategories().map(category => {
                                return category.week.map(weekday => {
                                    return ko.observable(weekday() !== null ? weekday().weekdayTotal() : null);
                                })
                            }));
                            this.turnoverStepLastHourTotals(this.formModel().dishCategories().map(category => {
                                return category.hourTotals().map(hourTotal => ko.observable(hourTotal()));
                            }));

                            this.isTurnoverStepSubmitted(false);
                            this.formModel().isTurnoverCalculated(true);
                            this.isTurnoverStepCalculating(false);
                        }, 400);
                    } else {
                        this.activeStep(this.activeStep() + 1);
                    }
                }

                this.turnoverStepCategoriesWithFillingError([]);
            };

            this.turnoverStepGetHourLabelData = function (hourIndex) {
                function process (time) {
                    const parts = time.split(':');

                    return {
                        hour: parts[0],
                        minute: parts[1]
                    };
                }

                const hours = this.turnoverStepIntervalHours();

                const currentParts = process(moment().hour(hours[hourIndex]).minute(0).format('HH:mm'));

                const data = {
                    start: currentParts,
                    end: {
                        ...currentParts,
                        minute: '59'
                    }
                };

                if (hourIndex === 0) {
                    const startParts = process(this.formModel().intervalStart());

                    if (startParts.minute !== '00') {
                        data.start.minute = startParts.minute;
                    }
                }

                if (hourIndex === hours.length - 1) {
                    const endParts = process(this.formModel().intervalEnd());

                    if (endParts.minute !== '00') {
                        data.end.minute = endParts.minute;
                    } else {
                        data.end = process(moment().hour(hours[hourIndex]).add(1, 'h').minute(0).format('HH:mm'));
                    }
                }

                return data;
            };

            this.turnoverStepReset = function () {
                this.isTurnoverStepSubmitted(false);
                this.formModel().isTurnoverCalculated(false);

                this.formModel().dishCategories().forEach(category => {
                    category.week.forEach((weekday, weekdayIndex) => {
                        if (this.formModel().schedule[weekdayIndex]().length !== 0) {
                            weekday(this.createDishCategoryWeekdayFormModel());
                        } else {
                            weekday(null);
                        }
                    });

                    category.hourTotals(null);
                    category.weekTotal('');
                });

                this.turnoverStepLastWeekTotals(null);
                this.turnoverStepLastWeekdayTotals(null);
                this.turnoverStepLastHourTotals(null);

                this.turnoverStepPreCalculatedDishCategoryValues([]);
            };

            this.turnoverStepFormatValue = function (value) {
                return Inputmask.format(value, {alias: 'decimal', digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false}).replace('.00', '');
            };

            this.turnoverStepUnmaskValue = function (value) {
                const result = Inputmask.unmask(value, {alias: 'decimal', digits: '0,2', groupSeparator: ' ', autoGroup: true, allowMinus: false, unmaskAsNumber: true});

                if (result === '') {
                    return 0;
                }

                return result;
            };

            this.isPositionsStepSubmitted = ko.observable(false);

            this.isPositionsStepValid = ko.pureComputed(() => {
                return this.formModel().positions().every(p => p.name() !== '' && p.name() !== undefined);
            });

            this.positionsStepAdd = function () {
                this.formModel().positions.push(this.createPositionFormModel());
            };

            this.positionsStepRemove = function (index) {
                this.formModel().positions.splice(index, 1);
            };

            this.positionsStepFormControlErrorStateMatcher = function (formControl) {
                return ko.pureComputed(() => {
                    return this.isPositionsStepSubmitted() && !formControl.isValid();
                });
            };

            this.positionsStepSubmit = function () {
                this.isPositionsStepSubmitted(true);

                if (this.isPositionsStepValid()) {
                    this.activeStep(this.activeStep() + 1);
                }
            };

            this.isWorkloadTypeStepSubmitted = ko.observable(false);

            this.isWorkloadTypeStepValid = ko.pureComputed(() => {
                return this.formModel().positions().every(position => {
                    return position.workloadType() !== '' &&
                           position.units() !== '' &&
                           position.standard() !== '' &&
                          (position.workloadType() !== '2' || position.dishCategories().length > 0);
                });
            });

            this.workloadTypeStepFormControlErrorStateMatcher = function (formControl) {
                return ko.pureComputed(() => {
                    return this.isWorkloadTypeStepSubmitted() && !formControl.isValid();
                });
            };

            this.workloadTypeStepSubmit = function () {
                this.isWorkloadTypeStepSubmitted(true);

                if (this.isWorkloadTypeStepValid()) {
                    console.log('end');
                }
            };

            this.maxAvailableStep = ko.pureComputed(() => {
                if (this.formModel().companyType() === null) {
                    return 1;
                } else if (!this.isDishCategoriesStepValid()) {
                    return 2;
                } else if (!this.isScheduleStepValid()) {
                    return 3;
                } else if (!this.isTurnoverStepValid()) {
                    return 4;
                } else if (!this.isPositionsStepValid()) {
                    return 5;
                } else {
                    return 6;
                }
            });

            (() => {
                $(window).on('resize', this.windowResizeHandler);

                this.subscriptions.push(this.scheduleStepUsedIntervalStart.subscribe(() => {
                    this.scheduleStepCutSchedule();
                }));

                this.subscriptions.push(this.scheduleStepUsedIntervalEnd.subscribe(() => {
                    this.scheduleStepCutSchedule();
                }));

                this.subscriptions.push(this.formModel().intervalStart.subscribe(value => {
                    if (this.formModel().intervalStart.isValid()) {
                        this.scheduleStepLastValidIntervalStart(value);
                    }
                }));

                this.subscriptions.push(this.formModel().intervalEnd.subscribe(value => {
                    if (this.formModel().intervalEnd.isValid()) {
                        this.scheduleStepLastValidIntervalEnd(value);
                    }
                }));

                this.subscriptions.push(this.formModel().dishCategories.subscribe(() => {
                    this.turnoverStepReset();
                }));

                this.subscriptions.push(this.formModel().intervalStart.subscribe(() => {
                    this.turnoverStepReset();
                }));

                this.subscriptions.push(this.formModel().intervalEnd.subscribe(() => {
                    this.turnoverStepReset();
                }));

                this.subscriptions.push(...this.formModel().schedule.map(weekday => weekday.subscribe(() => {
                    this.turnoverStepReset();
                })));

                /*this.companyTypeStepSelect(1);
                this.formModel().dishCategories()[0].value('1');
                this.dishCategoriesStepAdd();
                this.dishCategoriesStepAdd();
                this.formModel().dishCategories()[1].value('2');
                this.formModel().dishCategories()[2].value('3');
                this.dishCategoriesStepSubmit();
                this.formModel().schedule.forEach(weekday => weekday([8, 9, 10, 11, 12, 13, 14, 15, 16, 17]));
                this.formModel().schedule[0]([]);
                this.formModel().schedule[6]([]);
                this.scheduleStepSubmit();*/
                /*this.formModel().dishCategories().forEach((category, categoryIndex) => {
                    category.weekTotal(100);
                    this.onTurnoverStepWeekTotalChange(categoryIndex);
                });
                this.turnoverStepSubmit();*/
            })();
        };

        const viewModel = new ViewModel();

        ViewModel.prototype.dispose = function() {
            $(window).off('resize', this.windowResizeHandler);
            this.subscriptions.forEach(s => s.dispose());
        };

        ko.applyBindings(
            viewModel,
            $page.get()[0]
        );
    });
</script>

</body>
</html>
