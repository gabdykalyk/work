<!DOCTYPE html>
<html class="hrm-page templates hrm-page--initializing"
      data-bind="childrenComplete: childrenComplete"
      lang="ru">

<head>
    <title>Sakura</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="HandheldFriendly" content="true" />
<meta content="IE=edge" http-equiv="X-UA-Compatible" />
<link href="https://fonts.googleapis.com/css?family=Fira+Sans:100,200,300,400,500,600,700,800,900&display=swap&subset=cyrillic" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.12/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/1.10.2/css/OverlayScrollbars.min.css" integrity="sha256-zUBmWpj0DsZzFautKgMOtiOkT6ECQ+a6RitMns7+HRM=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://unpkg.com/tippy.js@5/dist/backdrop.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<link rel="stylesheet" href="assets/fonts/fontawesome/css/all.css" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/codemirror.min.css" integrity="sha256-vZ3SaLOjnKO/gGvcUWegySoDU6ff33CS5i9ot8J9Czk=" crossorigin="anonymous" />

<link rel="stylesheet" href="assets/css/main.css" />

</head>

<body>
    <div style="display: none">
  <svg>
    <symbol id="excel-icon">
      <path
        d="M8.47538 3.125H10.5823L8.05679 6.85381L10.9062 11H8.71957L6.98437 8.43767L5.24813 11H3.0625L5.91196 6.85381L3.38642 3.125H5.49336L6.98437 5.29456L8.47538 3.125Z"
        fill="#12C971" />
      <path d="M1 13V1H13V13H1Z" stroke="#12C971" fill="none" stroke-width="2" />
    </symbol>
    <symbol id="print-icon">
      <path d="M4 5V1H10.0625V5" stroke="#8E9CBB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        fill="none" />
      <path
        d="M3.4 11H2.2C1.88174 11 1.57652 10.8595 1.35147 10.6095C1.12643 10.3594 1 10.0203 1 9.66667V6.33333C1 5.97971 1.12643 5.64057 1.35147 5.39052C1.57652 5.14048 1.88174 5 2.2 5H11.8C12.1183 5 12.4235 5.14048 12.6485 5.39052C12.8736 5.64057 13 5.97971 13 6.33333V9.66667C13 10.0203 12.8736 10.3594 12.6485 10.6095C12.4235 10.8595 12.1183 11 11.8 11H10.6"
        stroke="#8E9CBB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
      <path d="M10 9H4V13H10V9Z" stroke="#8E9CBB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        fill="none" />
    </symbol>
    <symbol id="picture-icon">
      <path
        d="M11.6667 1H2.33333C1.59695 1 1 1.59695 1 2.33333V11.6667C1 12.403 1.59695 13 2.33333 13H11.6667C12.403 13 13 12.403 13 11.6667V2.33333C13 1.59695 12.403 1 11.6667 1Z"
        stroke="#8E9CBB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
      <path
        d="M5.5 6C6.32843 6 7 5.32843 7 4.5C7 3.67157 6.32843 3 5.5 3C4.67157 3 4 3.67157 4 4.5C4 5.32843 4.67157 6 5.5 6Z"
        fill="#8E9CBB" />
      <path d="M13 9.18182L10.1875 6L4 13" stroke="#8E9CBB" stroke-width="2" stroke-linejoin="round" fill="none" />
      <path d="M6 9.81818L4.4375 8L1 12" stroke="#8E9CBB" stroke-width="2" stroke-linejoin="round" fill="none" />
    </symbol>
    <symbol id="calculation-icon">
      <path
        d="M4 5H10M4 8H6M4 11H6M8 8H10M8 11H10M3 15H11C12.1046 15 13 14.1046 13 13V3C13 1.89543 12.1046 1 11 1H3C1.89543 1 1 1.89543 1 3V13C1 14.1046 1.89543 15 3 15Z"
        stroke="#8E9CBB" stroke-width="2" fill="none" />
    </symbol>

  </svg>
</div>
    <div class="hrm-scaffold">
        <div class="hrm-scaffold__body">
            <div class="hrm-scaffold__content templates__content">
                <div class="templates__section">
                    <div class="templates__section-title">Поле ввода</div>

                    <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                    <div class="templates__form-field"
                         data-bind="
                            hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label
                        ">
                        <label data-bind="hrmFormFieldLabel: label">Значение</label>

                        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                            <input data-bind="
                                    textInput: $root.value,
                                    hrmFormFieldInputControl: control,
                                    hrmFormFieldInputControlErrorStateMatcher: $root.formControlErrorStateMatcher
                                ">
                        </div>

                        <div data-bind="
                                component: {name: 'hrm-form-field-error'},
                                hrmSlide,
                                hrmSlideValue: control() !== null ? control().errorState : false,
                                hrmSlideDuration: 150
                            ">
                            <!-- ko text: $root.value.error() -->
                            <!-- /ko -->
                        </div>
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Поле ввода с возможностью сброса</div>

                    <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                    <div class="templates__form-field"
                         data-bind="
                            hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label
                        ">
                        <label data-bind="hrmFormFieldLabel: label">Значение</label>

                        <div
                             data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control, hrmFormFieldBasisAllowClear">
                            <input data-bind="
                                    textInput: $root.value1,
                                    hrmFormFieldInputControl: control,
                                    hrmFormFieldInputControlErrorStateMatcher: $root.formControlErrorStateMatcher
                                ">
                        </div>

                        <div data-bind="
                                component: {name: 'hrm-form-field-error'},
                                hrmSlide,
                                hrmSlideValue: control() !== null ? control().errorState : false,
                                hrmSlideDuration: 150
                            ">
                            <!-- ko text: $root.value1.error() -->
                            <!-- /ko -->
                        </div>
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Поле ввода с автоматическим изменением высоты</div>

                    <!-- ko let: {control: ko.observable(null)} -->
                    <div class="templates__form-field"
                         data-bind="
                            hrmFormField, hrmFormFieldControlRef: control
                        ">

                        <div
                             data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control, hrmFormFieldBasisAllowClear">
                            <textarea data-bind="
                                    textInput: $root.value8,
                                    hrmFormFieldInputControl: control,
                                    hrmFormFieldInputControlErrorStateMatcher: $root.formControlErrorStateMatcher, hrmAutoResize
                                "
                                      placeholder="Значение"></textarea>
                        </div>

                        <div data-bind="
                                component: {name: 'hrm-form-field-error'},
                                hrmSlide,
                                hrmSlideValue: control() !== null ? control().errorState : false,
                                hrmSlideDuration: 150
                            ">
                            <!-- ko text: $root.value8.error() -->
                            <!-- /ko -->
                        </div>
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Поле ввода + выпадающий список</div>

                    <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                    <div class="templates__form-field"
                         data-bind="
                            hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label
                        ">
                        <label data-bind="hrmFormFieldLabel: label">Значение</label>

                        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                            <select data-bind="
                                    value: value2,
                                    hrmSelect, hrmSelectSearchEnabled: true, hrmSelectAllowClear: true,
                                    hrmFormFieldSelectControl: control,
                                    hrmFormFieldSelectControlErrorStateMatcher: $root.formControlErrorStateMatcher
                                ">
                                <option></option>
                                <option value="1">Значение #1</option>
                                <option value="2">Значение #2</option>
                                <option value="3">Значение #3</option>
                                <option value="4">Значение #4</option>
                                <option value="5">Значение #5</option>
                                <option value="6">Значение #6</option>
                                <option value="7">Значение #7</option>
                                <option value="8">Значение #8</option>
                                <option value="9">Значение #9</option>
                            </select>
                        </div>

                        <div data-bind="
                                component: {name: 'hrm-form-field-error'},
                                hrmSlide,
                                hrmSlideValue: control() !== null ? control().errorState : false,
                                hrmSlideDuration: 150
                            ">
                            <!-- ko text: $root.value2.error() -->
                            <!-- /ko -->
                        </div>
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Поле ввода + выпадающий список со множественным выбором и
                        возможностью добавить значение</div>

                    <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                    <div class="templates__form-field"
                         data-bind="
                            hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label
                        ">
                        <label data-bind="hrmFormFieldLabel: label">Значение</label>

                        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                            <select data-bind="
                                    selectedOptions: value5,
                                    hrmSelect, hrmSelectCustomValuesAllowed: true,
                                    hrmFormFieldSelectControl: control,
                                    hrmFormFieldSelectControlErrorStateMatcher: $root.formControlErrorStateMatcher
                                "
                                    multiple>
                                <option></option>
                                <option value="1">Значение #1</option>
                                <option value="2">Значение #2</option>
                                <option value="3">Значение #3</option>
                                <option value="4">Значение #4</option>
                                <option value="5">Значение #5</option>
                                <option value="6">Значение #6</option>
                                <option value="7">Значение #7</option>
                                <option value="8">Значение #8</option>
                                <option value="9">Значение #9</option>
                            </select>
                        </div>

                        <div data-bind="
                                component: {name: 'hrm-form-field-error'},
                                hrmSlide,
                                hrmSlideValue: control() !== null ? control().errorState : false,
                                hrmSlideDuration: 150
                            ">
                            <!-- ko text: $root.value5.error() -->
                            <!-- /ko -->
                        </div>
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Поле ввода с маской и без подписи</div>

                    <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                    <div class="templates__form-field"
                         data-bind="
                            hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label
                        ">
                        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                            <input data-bind="
                                    textInput: value3,
                                    hrmMask,
                                    hrmMaskPattern: '99:99',
                                    hrmFormFieldInputControl: control,
                                    hrmFormFieldInputControlErrorStateMatcher: $root.formControlErrorStateMatcher
                                ">
                        </div>

                        <div data-bind="
                                component: {name: 'hrm-form-field-error'},
                                hrmSlide,
                                hrmSlideValue: control() !== null ? control().errorState : false,
                                hrmSlideDuration: 150
                            ">
                            <!-- ko text: $root.value3.error() -->
                            <!-- /ko -->
                        </div>
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Поле ввода дат</div>

                    <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                    <div class="templates__form-field"
                         data-bind="
                            hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label
                        ">
                        <label data-bind="hrmFormFieldLabel: label">Значение</label>

                        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                            <input data-bind="
                                    textInput: $root.value6,
                                    hrmDatepicker,
                                    hrmFormFieldDatepickerControl: control,
                                    hrmFormFieldDatepickerControlErrorStateMatcher: $root.formControlErrorStateMatcher
                                ">

                            <i
                               class="hrm-form-field__basis-suffix hrm-form-field-icon hrm-form-field-calendar-icon"></i>
                        </div>

                        <div data-bind="
                                component: {name: 'hrm-form-field-error'},
                                hrmSlide,
                                hrmSlideValue: control() !== null ? control().errorState : false,
                                hrmSlideDuration: 150
                            ">
                            <!-- ko text: $root.value6.error() -->
                            <!-- /ko -->
                        </div>
                    </div>
                    <!-- /ko -->

                    <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                    <div class="templates__form-field mt-4"
                         data-bind="
                            hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label
                        ">
                        <label data-bind="hrmFormFieldLabel: label">Значение</label>

                        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                            <input data-bind="
                                    textInput: $root.formattedDate,
                                    hrmDatepicker,
                                    hrmDatepickerConfig: {
                                        format: 'DD.MM.YYYY'
                                    },
                                    hrmFormFieldDatepickerControl: control,
                                    hrmFormFieldDatepickerControlErrorStateMatcher: $root.formControlErrorStateMatcher
                                ">

                            <i
                               class="hrm-form-field__basis-suffix hrm-form-field-icon hrm-form-field-calendar-icon"></i>
                        </div>

                        <div data-bind="
                                component: {name: 'hrm-form-field-error'},
                                hrmSlide,
                                hrmSlideValue: control() !== null ? control().errorState : false,
                                hrmSlideDuration: 150
                            ">
                            <!-- ko text: $root.formattedDate.error() -->
                            <!-- /ko -->
                        </div>
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Поле поиска</div>

                    <!-- ko let: {control: ko.observable(null)} -->
                    <div class="templates__form-field hrm-search-form-field position-page__equipment-tab-pane-search-form-field"
                         data-bind="hrmFormField, hrmFormFieldControlRef: control">
                        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
                            <i class="hrm-form-field__basis-prefix hrm-form-field-icon hrm-form-field-search-icon"></i>

                            <input data-bind="
                                    hrmFormFieldInputControl: control
                                "
                                   placeholder="Поиск">
                        </div>
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Поле поиска с возможность сброса</div>
                    <!-- ko let: { term: ko.observable('') } -->
                    <div class="templates__form-field"
                         data-bind="component: {name: 'hrm-search-field', params: { termModel: term, placeholder: 'Поиск' }}">
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Чекбокс</div>

                    <!-- ko let: {checkboxGroup: ko.observable(null)} -->
                    <div data-bind="component: {name: 'hrm-checkbox-group', params: {exportAs: checkboxGroup}}">
                        <div data-bind="component: {name: 'hrm-checkbox', params: {owner: checkboxGroup}}"></div>
                        <label
                               data-bind="hrmCheckboxGroupLabel, hrmCheckboxGroupLabelOwner: checkboxGroup">Чекбокс</label>
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Переключатель</div>

                    <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
                    <div class="hrm-form-field-switch-group"
                         data-bind="hrmSwitchGroup, hrmSwitchGroupControlRef: control, hrmSwitchGroupLabelRef: label">
                        <div data-bind="component: {name: 'hrm-switch', params: {exportAs: control}}"></div>
                        <label data-bind="hrmSwitchGroupLabel: label">
                            Переключатель
                        </label>
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Переключатель между вариантами</div>

                    <div class="hrm-radio-group">
                        <div class="hrm-radio-group__radio">
                            <input class="hrm-radio-group__radio-input"
                                   data-bind="checked: value7"
                                   type="radio"
                                   value="0"
                                   id="templates-first-radio"
                                   checked />
                            <label class="hrm-radio-group__radio-label"
                                   for="templates-first-radio">
                                Значение #1
                            </label>
                        </div>

                        <div class="hrm-radio-group__radio">
                            <input class="hrm-radio-group__radio-input"
                                   data-bind="checked: value7"
                                   type="radio"
                                   value="1"
                                   id="templates-second-radio"
                                   checked />
                            <label class="hrm-radio-group__radio-label"
                                   for="templates-second-radio">
                                Значение #2
                            </label>
                        </div>

                        <div class="hrm-radio-group__radio">
                            <input class="hrm-radio-group__radio-input"
                                   data-bind="checked: value7"
                                   type="radio"
                                   value="2"
                                   id="templates-third-radio" />
                            <label class="hrm-radio-group__radio-label"
                                   for="templates-third-radio">
                                Значение #3
                            </label>
                        </div>
                    </div>

                    <!-- ko let: { control: ko.observable('negative') } -->
                    <div class="hrm-radio-group">
                        <div class="hrm-radio-group__radio hrm-radio-group__radio--theme_negative">
                            <input class="hrm-radio-group__radio-input"
                                   data-bind="checked: control"
                                   type="radio"
                                   value="negative"
                                   id="templates-negative-radio"
                                   checked />
                            <label class="hrm-radio-group__radio-label"
                                   for="templates-negative-radio">
                                Штраф
                            </label>
                        </div>

                        <div class="hrm-radio-group__radio hrm-radio-group__radio--theme_positive">
                            <input class="hrm-radio-group__radio-input"
                                   data-bind="checked: control"
                                   type="radio"
                                   value="positive"
                                   id="templates-positive-radio" />
                            <label class="hrm-radio-group__radio-label"
                                   for="templates-positive-radio">
                                Премия
                            </label>
                        </div>
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Выпадающее меню</div>

                    <div class="templates__list">
                        <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_neutral
                                   hrm-button-with-plus-icon"
                                data-bind="
                                hrmDropdownMenu,
                                hrmDropdownMenuTemplate: 'templates-dropdown-menu-template'
                            ">
                            Меню
                        </button>
                        <button class="hrm-button hrm-button-with-icon-right hrm-button-with-arrow-down-icon-right hrm-button-with-icon--theme_secondary"
                                data-bind="hrmDropdownMenu, hrmDropdownMenuTemplate: 'employees-dropdown-template'">Сотрудники</button>
                    </div>

                    <script id="templates-dropdown-menu-template"
                            type="text/html">
                            <div class="hrm-dropdown-menu__item">Пункт #1</div>
                            <div class="hrm-dropdown-menu__item">Пункт #2</div>
                            <div class="hrm-dropdown-menu__item hrm-dropdown-menu__item--disabled">Неактивный пункт</div>
                            <div class="hrm-dropdown-menu__item">Пункт #4</div>
                            <div class="hrm-dropdown-menu__item">Пункт #5</div>
                            <div class="hrm-dropdown-menu__item">Пункт #6</div>
                    </script>

                    <script id="employees-dropdown-template"
                            type="text/html">
                        <div class="hrm-dropdown-menu__item">Добавить сотрудников</div>
                        <div class="hrm-dropdown-menu__item">Новый сотрудник</div>
                    </script>

                </div>


                <div class="templates__section">
                    <div class="templates__section-title">Линейка из шагов</div>

                    <!-- ko let: {activeStep: ko.observable(1)} -->
                    <div class="hrm-stepper"
                         data-bind="css: {'hrm-stepper--dense': viewportSize().width <= HRM_BREAKPOINTS.mobileMaxWidth}">
                        <!-- ko let: {step: 1} -->
                        <div class="hrm-stepper__step"
                             data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                            <div class="hrm-stepper__step-content"
                                 data-bind="click: function () {activeStep(step);}">
                                <span class="hrm-stepper__step-label">Шаг
                                    <!-- ko text: step -->
                                    <!-- /ko --></span>
                                <div class="hrm-stepper__step-index-number"
                                     data-bind="text: step"></div>
                            </div>
                        </div>
                        <!-- /ko -->

                        <!-- ko let: {step: 2} -->
                        <div class="hrm-stepper__step"
                             data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                            <div class="hrm-stepper__step-content"
                                 data-bind="click: function () {activeStep(step);}">
                                <span class="hrm-stepper__step-label">Шаг
                                    <!-- ko text: step -->
                                    <!-- /ko --></span>
                                <div class="hrm-stepper__step-index-number"
                                     data-bind="text: step"></div>
                            </div>
                        </div>
                        <!-- /ko -->

                        <!-- ko let: {step: 3} -->
                        <div class="hrm-stepper__step"
                             data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                            <div class="hrm-stepper__step-content"
                                 data-bind="click: function () {activeStep(step);}">
                                <span class="hrm-stepper__step-label">Шаг
                                    <!-- ko text: step -->
                                    <!-- /ko --></span>
                                <div class="hrm-stepper__step-index-number"
                                     data-bind="text: step"></div>
                            </div>
                        </div>
                        <!-- /ko -->

                        <!-- ko let: {step: 4} -->
                        <div class="hrm-stepper__step"
                             data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                            <div class="hrm-stepper__step-content"
                                 data-bind="click: function () {activeStep(step);}">
                                <span class="hrm-stepper__step-label">Шаг
                                    <!-- ko text: step -->
                                    <!-- /ko --></span>
                                <div class="hrm-stepper__step-index-number"
                                     data-bind="text: step"></div>
                            </div>
                        </div>
                        <!-- /ko -->

                        <!-- ko let: {step: 5} -->
                        <div class="hrm-stepper__step"
                             data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                            <div class="hrm-stepper__step-content"
                                 data-bind="click: function () {activeStep(step);}">
                                <span class="hrm-stepper__step-label">Шаг
                                    <!-- ko text: step -->
                                    <!-- /ko --></span>
                                <div class="hrm-stepper__step-index-number"
                                     data-bind="text: step"></div>
                            </div>
                        </div>
                        <!-- /ko -->

                        <!-- ko let: {step: 6} -->
                        <div class="hrm-stepper__step"
                             data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                            <div class="hrm-stepper__step-content"
                                 data-bind="click: function () {activeStep(step);}">
                                <span class="hrm-stepper__step-label">Шаг
                                    <!-- ko text: step -->
                                    <!-- /ko --></span>
                                <div class="hrm-stepper__step-index-number"
                                     data-bind="text: step"></div>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Вкладки</div>

                    <div class="templates__navigation"
                         data-bind="component: {name: 'hrm-tab-group', params: {items: navigationTabs}}">
                    </div>
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Стилизованная полоса прокрутки</div>

                    <div class="templates__scrollable-block"
                         data-bind="hrmScrollable">
                        <div class="templates__scrollable-block-content"></div>
                    </div>

                    <div class="templates__scrollable-block templates__scrollable-block--h"
                         data-bind="hrmScrollable">
                        <div class="templates__scrollable-block-content"></div>
                    </div>
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">
                        Добавление в избранное
                    </div>
                    <div class="templates__list">
                        <button class="hrm-button hrm-circle-icon-button hrm-circle-bookmark-icon-button"
                                data-bind="hrmTooltip,
                        hrmTooltipText: inBookmarks()
                            ? 'Удалить раздел из избранного'
                            : 'Добавить в избранное',
                        click: function() {
                            if (inBookmarks()) removeFromBookmarks();
                            else addToBookmarks();
                        },
                        css: {
                            'active': inBookmarks
                        }">
                        </button>
                    </div>
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Простые кнопки</div>

                    <div class="templates__list">
                        <button class="hrm-button hrm-basic-button templates__basic-button">
                            Назад
                        </button>

                        <button class="hrm-button hrm-basic-button hrm-accent-button templates__basic-button">
                            Далее
                        </button>

                        <button class="hrm-button hrm-basic-button hrm-primary-button templates__basic-button">
                            <span class="hrm-primary-button__content">Войти</span>
                            <span class="hrm-primary-button__background hrm-primary-button__hover-background"></span>
                            <span class="hrm-primary-button__background hrm-primary-button__active-background"></span>
                        </button>
                    </div>
                    <div class="templates__list mt-4">
                        <button class="hrm-button hrm-basic-button templates__basic-button" disabled>
                            Назад
                        </button>

                        <button class="hrm-button hrm-basic-button hrm-accent-button templates__basic-button" disabled>
                            Далее
                        </button>

                        <button class="hrm-button hrm-basic-button hrm-primary-button templates__basic-button" disabled>
                            <span class="hrm-primary-button__content">Войти</span>
                            <span class="hrm-primary-button__background hrm-primary-button__hover-background"></span>
                            <span class="hrm-primary-button__background hrm-primary-button__active-background"></span>
                        </button>
                    </div>
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Простые кнопки (medium)</div>

                    <div class="templates__list">
                        <button class="hrm-button hrm-basic-button hrm-button--size_medium templates__basic-button">
                            Назад
                        </button>

                        <button
                                class="hrm-button hrm-basic-button hrm-button--size_medium hrm-accent-button templates__basic-button">
                            Далее
                        </button>

                        <button
                                class="hrm-button hrm-basic-button hrm-button--size_medium hrm-primary-button templates__basic-button">
                            <span class="hrm-primary-button__content">Войти</span>
                            <span class="hrm-primary-button__background hrm-primary-button__hover-background"></span>
                            <span class="hrm-primary-button__background hrm-primary-button__active-background"></span>
                        </button>
                    </div>

                    <div class="templates__list mt-4">
                        <button class="hrm-button hrm-basic-button hrm-button--size_medium templates__basic-button" disabled>
                            Назад
                        </button>

                        <button
                                class="hrm-button hrm-basic-button hrm-button--size_medium hrm-accent-button templates__basic-button" disabled>
                            Далее
                        </button>

                        <button
                                class="hrm-button hrm-basic-button hrm-button--size_medium hrm-primary-button templates__basic-button" disabled>
                            <span class="hrm-primary-button__content">Войти</span>
                            <span class="hrm-primary-button__background hrm-primary-button__hover-background"></span>
                            <span class="hrm-primary-button__background hrm-primary-button__active-background"></span>
                        </button>
                    </div>
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Кнопки с иконками</div>

                    <div class="templates__list">
                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_neutral hrm-button-with-plus-icon templates__button-with-icon">
                            Добавить
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_positive hrm-button-with-check-icon templates__button-with-icon">
                            Заполнить автоматически
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_negative hrm-button-with-times-icon templates__button-with-icon">
                            Очистить
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_secondary hrm-button-with-arrow-left-icon templates__button-with-icon">
                            Вернуться
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_positive hrm-button-with-excel-icon templates__button-with-icon">
                            Выгрузить в excel
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_secondary  hrm-button-with-printer-icon templates__button-with-icon">
                            Распечатать
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_negative hrm-button-with-trash-icon templates__button-with-icon">
                            Удалить
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_secondary hrm-button-with-settings-icon templates__button-with-icon">
                            Настроить столбцы
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_secondary hrm-button-with-less-icon templates__button-with-icon">
                            Меньше информации
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_secondary hrm-button-with-more-icon templates__button-with-icon">
                            Больше информации
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_secondary hrm-button-with-route-icon  templates__button-with-icon">
                            Пересчитать маршруты
                        </button>
                    </div>

                    <div class="templates__list">
                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_neutral hrm-button-with-plus-icon templates__button-with-icon" disabled>
                            Добавить
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_positive hrm-button-with-check-icon templates__button-with-icon" disabled>
                            Заполнить автоматически
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_negative hrm-button-with-times-icon templates__button-with-icon" disabled>
                            Очистить
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_secondary hrm-button-with-arrow-left-icon templates__button-with-icon" disabled>
                            Вернуться
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_positive hrm-button-with-excel-icon templates__button-with-icon" disabled>
                            Выгрузить в excel
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_secondary  hrm-button-with-printer-icon templates__button-with-icon" disabled>
                            Распечатать
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_negative hrm-button-with-trash-icon templates__button-with-icon" disabled>
                            Удалить
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_secondary hrm-button-with-settings-icon templates__button-with-icon" disabled>
                            Настроить столбцы
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_secondary hrm-button-with-less-icon templates__button-with-icon" disabled>
                            Меньше информации
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_secondary hrm-button-with-more-icon templates__button-with-icon" disabled>
                            Больше информации
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_secondary hrm-button-with-route-icon  templates__button-with-icon" disabled>
                            Пересчитать маршруты
                        </button>
                    </div>


                </div>

                <div class="templates__section">
                    <div class="templates__section-title">Кнопки с иконками (адаптивные)</div>

                    <div class="templates__section-subtitle">hide_desktop</div>

                    <div class="templates__list">
                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--hide_desktop hrm-button-with-icon--theme_neutral hrm-button-with-person-icon templates__button-with-icon ">

                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--hide_desktop hrm-button-with-icon--theme_neutral hrm-button-with-badge-icon templates__button-with-icon ">

                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--hide_desktop hrm-button-with-icon--theme_neutral hrm-button-with-money-icon templates__button-with-icon ">

                        </button>
                    </div>

                    <div class="templates__section-subtitle">hide_tablet</div>

                    <div class="templates__list">
                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--hide_tablet hrm-button-with-icon--theme_neutral hrm-button-with-plus-icon templates__button-with-icon ">
                            Добавить
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--hide_tablet hrm-button-with-icon--theme_positive hrm-button-with-check-icon templates__button-with-icon">
                            Заполнить автоматически
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--hide_tablet hrm-button-with-icon--theme_negative hrm-button-with-times-icon templates__button-with-icon">
                            Очистить
                        </button>
                    </div>

                    <div class="templates__section-subtitle">hide_mobile</div>

                    <div class="templates__list">
                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--hide_mobile hrm-button-with-icon--theme_neutral hrm-button-with-plus-icon templates__button-with-icon ">
                            Добавить
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--hide_mobile hrm-button-with-icon--theme_positive hrm-button-with-check-icon templates__button-with-icon">
                            Заполнить автоматически
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--hide_mobile hrm-button-with-icon--theme_negative hrm-button-with-times-icon templates__button-with-icon">
                            Очистить
                        </button>
                    </div>

                    <div class="templates__section-subtitle">show_desktop</div>

                    <div class="templates__list">
                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--show_desktop hrm-button-with-icon--theme_neutral hrm-button-with-plus-icon templates__button-with-icon ">
                            Добавить
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--show_desktop hrm-button-with-icon--theme_positive hrm-button-with-check-icon templates__button-with-icon">
                            Заполнить автоматически
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--show_desktop hrm-button-with-icon--theme_negative hrm-button-with-times-icon templates__button-with-icon">
                            Очистить
                        </button>
                    </div>

                    <div class="templates__section-subtitle">show_tablet</div>

                    <div class="templates__list">
                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--show_tablet hrm-button-with-icon--theme_neutral hrm-button-with-plus-icon templates__button-with-icon ">
                            Добавить
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--show_tablet hrm-button-with-icon--theme_positive hrm-button-with-check-icon templates__button-with-icon">
                            Заполнить автоматически
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--show_tablet hrm-button-with-icon--theme_negative hrm-button-with-times-icon templates__button-with-icon">
                            Очистить
                        </button>
                    </div>

                    <div class="templates__section-subtitle">show_mobile</div>

                    <div class="templates__list">
                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--show_mobile hrm-button-with-icon--theme_neutral hrm-button-with-plus-icon templates__button-with-icon ">
                            Добавить
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--show_mobile hrm-button-with-icon--theme_positive hrm-button-with-check-icon templates__button-with-icon">
                            Заполнить автоматически
                        </button>

                        <button
                                class="hrm-button hrm-button-with-icon hrm-button-with-icon--show_mobile hrm-button-with-icon--theme_negative hrm-button-with-times-icon templates__button-with-icon">
                            Очистить
                        </button>
                    </div>


                </div>

                <div class="templates__section">
                    <div class="templates__section-title">Кнопки с иконками справа</div>
                    <div class="templates__list">
                        <button
                                class="hrm-button hrm-button-with-icon-right hrm-button-with-arrow-down-icon-right hrm-button-with-icon--theme_secondary">Действия</button>
                    </div>
                </div>

                <div class="templates__section">
                    <div class="templates__section-title">Круглые кнопки с иконками</div>

                    <div class="templates__list">
                        <button class="hrm-button hrm-circle-icon-button hrm-circle-logout-icon-button
                                       hrm-circle-icon-button--theme_neutral">
                        </button>

                        <button class="hrm-button hrm-circle-icon-button hrm-circle-arrow-left-icon-button
                                       hrm-circle-icon-button--theme_secondary">
                        </button>

                        <button
                                class="hrm-button hrm-circle-icon-button hrm-circle-help-icon-button hrm-circle-icon-button--theme_positive">
                        </button>

                        <button
                                class="hrm-button hrm-circle-icon-button hrm-circle-arrow-down-icon-button hrm-circle-icon-button--theme_negative">
                        </button>

                        <button
                                class="hrm-button hrm-circle-icon-button hrm-circle-plus-icon-button hrm-circle-icon-button--theme_neutral">
                        </button>

                        <button
                                class="hrm-button hrm-circle-icon-button hrm-circle-times-icon-button hrm-circle-icon-button--theme_secondary">
                        </button>
                    </div>
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Иконочные кнопки</div>

                    <div class="templates__list">
                        <button
                                class="hrm-button hrm-icon-button hrm-pencil-icon-button hrm-icon-button--theme_secondary">
                        </button>

                        <button
                                class="hrm-button hrm-icon-button hrm-trash-icon-button hrm-icon-button--theme_negative">
                        </button>

                        <button
                                class="hrm-button hrm-icon-button hrm-sheet-icon-button hrm-icon-button--theme_negative">
                        </button>

                        <button
                                class="hrm-button hrm-icon-button hrm-arrow-down-icon-button hrm-icon-button--theme_negative">
                        </button>

                        <button
                                class="hrm-button hrm-icon-button hrm-arrow-up-icon-button hrm-icon-button--theme_positive">
                        </button>

                        <button
                                class="hrm-button hrm-icon-button hrm-battery-full-icon-button hrm-icon-button--theme_secondary">
                        </button>

                        <button
                                class="hrm-button hrm-icon-button hrm-battery-empty-icon-button hrm-icon-button--theme_secondary">
                        </button>
                    </div>
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Таблица</div>

                    <table data-bind="hrmTable">
                        <thead>
                            <tr>
                                <th>Колонка #1</th>
                                <th>Колонка #2</th>
                                <th>Колонка #3</th>
                                <th>Колонка #4</th>
                                <th>Колонка #5</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>
                                <!-- ko let: {editableCell: ko.observable(null)} -->
                                <td data-bind="hrmTableEditableCell: editableCell">
                                    <input data-bind="
                                            value: 'Редактируемое значение #1',
                                            hrmTableEditableCellInputControl,
                                            hrmTableEditableCellInputControlOwner: editableCell
                                        "
                                           placeholder="Значение #1">
                                </td>
                                <!-- /ko -->
                                <td>Значение #7</td>
                                <td>Значение #8</td>
                                <td>Значение #9</td>
                                <td>Значение #10</td>
                            </tr>

                            <tr>
                                <!-- ko let: {editableCell: ko.observable(null)} -->
                                <td data-bind="
                                        hrmTableEditableCell: editableCell,
                                        hrmTableEditableCellError: editableCellControlErrorExtractor(value4)
                                    ">
                                    <input data-bind="
                                            textInput: value4,
                                            hrmTableEditableCellInputControl,
                                            hrmTableEditableCellInputControlOwner: editableCell
                                        "
                                           placeholder="Значение #11">
                                </td>
                                <!-- /ko -->
                                <td>Значение #12</td>
                                <td>Значение #13</td>
                                <td>Значение #14</td>
                                <td>Значение #15</td>
                            </tr>

                            <tr>
                                <td>Значение #16</td>
                                <td>Значение #17</td>
                                <td>Значение #18</td>
                                <td>Значение #19</td>
                                <!-- ko let: {editableCell: ko.observable(null)} -->
                                <td data-bind="hrmTableEditableCell: editableCell">
                                    <select data-bind="
                                            value: 1,
                                            hrmSelect,
                                            hrmTableEditableCellSelectControl,
                                            hrmTableEditableCellSelectControlOwner: editableCell
                                        ">
                                        <option></option>
                                        <option value="1">Вариант #1</option>
                                        <option value="2">Очень-очень длинный варинт #2</option>
                                        <option value="3">Вариант #3</option>
                                        <option value="4">Вариант #4</option>
                                        <option value="5">Вариант #5</option>
                                        <option value="6">Вариант #6</option>
                                        <option value="7">Вариант #7</option>
                                        <option value="8">Вариант #8</option>
                                        <option value="9">Вариант #9</option>
                                    </select>
                                </td>
                                <!-- /ko -->
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Таблица с фиксированным заголовком</div>

                    <!-- ko let: {stickyWrappers: ko.observableArray([])} -->
                    <div class="templates__table-sticky-section-container"
                         data-bind="
                            hrmTableStickySectionContainer,
                            hrmTableStickySectionContainerSectionWrappers: stickyWrappers
                        ">
                        <div class="hrm-table__sticky-section-rail">
                            <div data-bind="hrmTableStickySectionWrapper: stickyWrappers">
                                <table class="hrm-table__sticky-section"
                                       data-bind="hrmTable">
                                    <thead>
                                        <tr>
                                            <th>
                                                <div class="hrm-table__head-cell-content">
                                                    Колонка #1

                                                    <button
                                                            class="hrm-button hrm-circle-icon-button hrm-circle-info-icon-button
                                                                       hrm-table__head-cell-info-button hrm-circle-icon-button--theme_neutral">
                                                    </button>
                                                </div>
                                            </th>
                                            <th>Колонка #2</th>
                                            <th>Колонка #3</th>
                                            <th>Колонка #4</th>
                                            <th>Колонка #5</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                        <table data-bind="hrmTable">
                            <thead>
                                <tr>
                                    <th>
                                        <div class="hrm-table__head-cell-content">
                                            Колонка #1

                                            <button
                                                    class="hrm-button hrm-circle-icon-button hrm-circle-info-icon-button
                                                               hrm-table__head-cell-info-button hrm-circle-icon-button--theme_neutral">
                                            </button>
                                        </div>
                                    </th>
                                    <th>Колонка #2</th>
                                    <th>Колонка #3</th>
                                    <th>Колонка #4</th>
                                    <th>Колонка #5</th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr>
                                    <!-- ko let: {editableCell: ko.observable(null)} -->
                                    <td data-bind="hrmTableEditableCell: editableCell">
                                        <div class="hrm-table__cell-content hrm-table__editable-cell-content">
                                            <input data-bind="
                                                        value: 'Редактируемое значение #1',
                                                        hrmTableEditableCellInputControl,
                                                        hrmTableEditableCellInputControlOwner: editableCell
                                                    "
                                                   placeholder="Значение #1">

                                            <button class="hrm-button hrm-icon-button hrm-times-icon-button
                                                                   hrm-icon-button--theme_negative
                                                                   templates__editable-cell-remove-button"
                                                    title="Удалить"
                                                    data-bind="click: function () {$root.dishCategoriesStepRemove($index());}">
                                            </button>
                                        </div>
                                    </td>
                                    <!-- /ko -->
                                    <td>Значение #7</td>
                                    <td>Значение #8</td>
                                    <td>Значение #9</td>
                                    <td>Значение #10</td>
                                </tr>

                                <tr>
                                    <!-- ko let: {editableCell: ko.observable(null)} -->
                                    <td data-bind="
                                                hrmTableEditableCell: editableCell,
                                                hrmTableEditableCellError: editableCellControlErrorExtractor(value4)
                                            ">
                                        <input data-bind="
                                                    textInput: value4,
                                                    hrmTableEditableCellInputControl,
                                                    hrmTableEditableCellInputControlOwner: editableCell
                                                "
                                               placeholder="Значение #11">
                                    </td>
                                    <!-- /ko -->
                                    <td>Значение #12</td>
                                    <td>Значение #13</td>
                                    <td>Значение #14</td>
                                    <td>Значение #15</td>
                                </tr>

                                <tr>
                                    <td>Значение #16</td>
                                    <td>Значение #17</td>
                                    <td>Значение #18</td>
                                    <td>Значение #19</td>
                                    <!-- ko let: {editableCell: ko.observable(null)} -->
                                    <td data-bind="hrmTableEditableCell: editableCell">
                                        <select data-bind="
                                                    value: 1,
                                                    hrmSelect,
                                                    hrmTableEditableCellSelectControl,
                                                    hrmTableEditableCellSelectControlOwner: editableCell
                                                ">
                                            <option></option>
                                            <option value="1">Вариант #1</option>
                                            <option value="2">Очень-очень длинный варинт #2</option>
                                            <option value="3">Вариант #3</option>
                                            <option value="4">Вариант #4</option>
                                            <option value="5">Вариант #5</option>
                                            <option value="6">Вариант #6</option>
                                            <option value="7">Вариант #7</option>
                                            <option value="8">Вариант #8</option>
                                            <option value="9">Вариант #9</option>
                                        </select>
                                    </td>
                                    <!-- /ko -->
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- /ko -->
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Лоадер</div>
                    <div class="templates__list">
                        <div class="loader-block">
                            <i class="fa fa-spinner fa-pulse loader-block__indicator"></i>
                            <span class="loader-block__text">Производится расчет</span>
                        </div>
                    </div>
                </div>
                <div class="templates__section">
                    <div class="templates__section-title">Модальные окна</div>
                    <div class="templates__list">
                        <button class="templates__modal-btn hrm-button hrm-basic-button  hrm-accent-button"
                                data-bind="click: function() { openModal('addEmployees'); }">
                            Добавить сотрудников
                        </button>
                        <button class="templates__modal-btn hrm-button hrm-basic-button hrm-accent-button"
                                data-bind="click: function() { openModal('addEmployees', 'single-position'); }">
                            Добавить сотрудников (Для позиции)
                        </button>
                        <button class="templates__modal-btn hrm-button hrm-basic-button hrm-accent-button"
                                data-bind="click: function() { openModal('addEmployees', 'single-other'); }">
                            Добавить сотрудников (Прочие)
                        </button>
                        <button class="templates__modal-btn hrm-button hrm-basic-button  hrm-accent-button"
                                data-bind="click: function() { openModal('createEmployee'); }">
                            Новый сотрудник
                        </button>
                        <button class="templates__modal-btn hrm-button hrm-basic-button hrm-accent-button"
                                data-bind="click: function() { openModal('positions'); }">
                            Должности
                        </button>
                        <button class="templates__modal-btn hrm-button hrm-basic-button hrm-accent-button"
                                data-bind="click: function() { openModal('columns'); }">
                            Настроить столбцы
                        </button>
                        <button class="templates__modal-btn hrm-button hrm-basic-button hrm-accent-button"
                                data-bind="click: function() { openModal('accountOperations'); }">
                            Операции с ЛС
                        </button>
                        <button class="templates__modal-btn hrm-button hrm-basic-button hrm-accent-button"
                                data-bind="click: function() { openModal('stimulation'); }">
                            Штраф/премия смене
                        </button>
                        <button class="templates__modal-btn hrm-button hrm-basic-button hrm-accent-button"
                                data-bind="click: function() { openModal('employeeBonus'); }">
                            Выписать премию
                        </button>
                        <button class="templates__modal-btn hrm-button hrm-basic-button hrm-accent-button"
                                data-bind="click: function() { openModal('employeeFine'); }">
                            Выписать штраф
                        </button>
                    </div>
                </div>
            </div>

            <div class="hrm-scaffold__footer"
                 data-bind="component: {name: 'hrm-basic-footer'}"></div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-debug.js" integrity="sha256-M5ZomNNnrnEB2WjSbnty5GWGqq6UuAAVNnWECisgEis=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/knockout.validation@2.0.4/dist/knockout.validation.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.12/js/select2.full.min.js" integrity="sha256-vucLmrjdfi9YwjGY/3CQ7HnccFSS/XRS1M/3k/FDXJw=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/js/i18n/ru.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/simplebar/5.1.0/simplebar.min.js" integrity="sha256-hFddD6XMIwFba4ITQjpv5WWE557w6O0w9RRfmGjIz4k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/1.10.2/js/OverlayScrollbars.min.js" integrity="sha256-5Tj3ZUgjHEGwF7TxpOgbPpjhq+WxXvpfb+qr9OxRHtY=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/1.10.2/js/jquery.overlayScrollbars.min.js" integrity="sha256-RE+oy7ofA6XerySMpTlDcg0gFUwHN3n0qQ5fUIZVq/M=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/gh/RobinHerbots/jquery.inputmask@4.0.9/dist/jquery.inputmask.bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js" integrity="sha256-AdQN98MVZs44Eq2yTwtoKufhnU+uZ7v2kXnD5vqzZVo=" crossorigin="anonymous"></script>
<script src="https://unpkg.com/popper.js@1"></script>
<script src="https://unpkg.com/tippy.js@5"></script>
<script src="https://unpkg.com/sticky-events@3.1.1/dist/sticky-events.umd.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.min.js" integrity="sha256-VeNaFBVDhoX3H+gJ37DpT/nTuZTdjYro9yBruHjVmoQ=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/codemirror.min.js" integrity="sha256-id5Qk/MwQJxgNlDFDpVymUuReXfTUZiaQKb8arrddQM=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/mode/xml/xml.min.js" integrity="sha256-Lfk8z6WUsBN6YiCaMpH6bxBHyRqkPK4O2QbQHFNUS40=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/autoresize-textarea@1.1.3/src/autoresize-textarea.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script src="assets/js/main.js"></script>

    <script type="text/javascript">
    $(function () {
        const $page = $(document.documentElement);

        window.directories = {
            fines: [
                {
                    name: 'Группа 1',
                    items: [
                        {
                            id: '1',
                            name: 'Основание штрафа 1',
                            sum: 200
                        },
                        {
                            id: '2',
                            name: 'Основание штрафа 2',
                            sum: 300
                        }
                    ]
                },
                {
                    name: 'Группа 2',
                    items: [
                        {
                            id: '3',
                            name: 'Основание штрафа 3',
                            sum: 200
                        },
                        {
                            id: '4',
                            name: 'Основание штрафа 4',
                            sum: 300
                        }
                    ]
                },
            ],
            bonuses: [
                {
                    name: 'Группа 1',
                    items: [
                        {
                            id: '1',
                            name: 'Основание премии 1',
                            sum: 200
                        },
                        {
                            id: '2',
                            name: 'Основание премии 2',
                            sum: 300
                        }
                    ]
                },
                {
                    name: 'Группа 2',
                    items: [
                        {
                            id: '3',
                            name: 'Основание премии 3',
                            sum: 200
                        },
                        {
                            id: '4',
                            name: 'Основание премии 4',
                            sum: 300
                        }
                    ]
                },
            ],
            authors: [
                {
                    id: 1,
                    name: 'Иван Иванов'
                }, {
                    id: 2,
                    name: 'Петр Петров'
                }, {
                    id: 3,
                    name: 'Николай Николаев'
                }, {
                    id: 4,
                    name: 'Сергей Сергеев'
                }
            ],
        };

        const ViewModel = function () {
            this.windowResizeHandler = () => {
                this.viewportSize({ width: $(window).width(), height: $(window).height() });
            };
            this.viewportSize = ko.observable({ width: $(window).width(), height: $(window).height() });

            this.value = ko.observable('').extend({
                required: {
                    message: 'Обязательное поле'
                }
            });

            this.value1 = ko.observable('').extend({
                required: {
                    message: 'Обязательное поле'
                }
            });

            this.value2 = ko.observable('').extend({
                required: {
                    message: 'Обязательное поле'
                }
            });

            this.value3 = ko.observable('').extend({
                required: {
                    message: 'Обязательное поле'
                },
                hrmDate: 'HH:mm'
            });

            this.value5 = ko.observableArray([]).extend({
                required: {
                    message: 'Обязательное поле'
                }
            });

            this.value4 = ko.observable('').extend({
                required: {
                    message: 'Пример ошибки'
                }
            });

            this.value6 = ko.observable('').extend({
                required: {
                    message: 'Пример ошибки'
                },
                hrmDate: {
                    message: 'Неверный формат даты',
                    params: 'DD.MM.YYYY, dddd'
                }
            });

            this.formattedDate = ko.observable('').extend({
                required: {
                    message: 'Пример ошибки'
                },
                hrmDate: {
                    message: 'Неверный формат даты',
                    params: 'DD.MM.YYYY'
                }
            });

            this.value7 = ko.observable('0');

            this.value8 = ko.observable('').extend({
                required: {
                    message: 'Пример ошибки'
                }
            });

            this.navigationTabs = [
                new HrmTabGroupItem('Вкладка #1'),
                new HrmTabGroupItem('Вкладка #2'),
                new HrmTabGroupItem('Неактивная вкладка', true),
                new HrmTabGroupItem('Вкладка #4'),
                new HrmTabGroupItem('Вкладка #5'),
                new HrmTabGroupItem('Вкладка #6'),
                new HrmTabGroupItem('Вкладка #7'),
                new HrmTabGroupItem('Вкладка #8'),
                new HrmTabGroupItem('Вкладка #9'),
                new HrmTabGroupItem('Вкладка #10'),
                new HrmTabGroupItem('Вкладка #11'),
                new HrmTabGroupItem('Вкладка #12'),
                new HrmTabGroupItem('Вкладка #13'),
                new HrmTabGroupItem('Вкладка #14'),
                new HrmTabGroupItem('Вкладка #15'),
            ];

            this.inBookmarks = ko.observable(false);
            this.removeFromBookmarks = () => {
                this.inBookmarks(false);
            }
            this.addToBookmarks = () => {
                this.inBookmarks(true);
            }


            this.modalOpens = ko.observableArray([]);

            this.positions = ko.observableArray([
                {
                    id: 1,
                    name: 'Position 1',
                    visible: ko.observable(true),
                    levels: [1, 2, 3]
                },
                {
                    id: 2,
                    name: 'Position 2',
                    visible: ko.observable(false),
                    levels: []
                },
                {
                    id: 2,
                    name: 'Position 2',
                    visible: ko.observable(false),
                    levels: [1, 2]
                },
            ]);

            this.openModal = (modalId, mode) => {
                if (modalId === 'positions') {
                    this.modalOpens.push({
                        dialogTemplateName: 'positions-modal-template',
                        data: {
                            positions: this.positions
                        },
                        close: result => {
                            console.log(result);
                        }
                    });
                }
                if (modalId === 'createEmployee') {
                    this.modalOpens.push({
                        dialogTemplateName: 'create-employee-modal-template',
                        data: {
                            positions: this.positions()
                        },
                        close: result => {
                            console.log(result);
                        }
                    });
                }
                if (modalId === 'accountOperations') {
                    this.modalOpens.push({
                        dialogTemplateName: 'account-operations-modal-template',
                        data: {
                            employee: {
                                accountOperations: ko.observableArray([])
                            }
                        },
                        close: result => {
                            console.log(result);
                        }
                    });
                }
                if (modalId === 'employeeFine') {
                    this.modalOpens.push({
                        dialogTemplateName: 'employee-fine-modal-template',
                        data: {
                            employee: {
                                fines: ko.observableArray([])
                            },
                            fines: window.directories.fines,
                            authors: window.directories.authors,
                        },
                        close: result => {
                            console.log(result);
                        }
                    })
                }
                if (modalId === 'employeeBonus') {
                    this.modalOpens.push({
                        dialogTemplateName: 'employee-bonus-modal-template',
                        data: {
                            employee: {
                                bonuses: ko.observableArray([])
                            },
                            bonuses: window.directories.bonuses,
                            authors: window.directories.authors,
                        },
                        close: result => {
                            console.log(result);
                        }
                    })
                }
                if (modalId === 'columns') {
                    this.modalOpens.push({
                        dialogTemplateName: 'columns-modal-template',
                        data: {
                            columns: [
                                { id: 1, fullTitle: 'Столбец 1', visible: ko.observable(true) },
                                { id: 2, fullTitle: 'Столбец 2', visible: ko.observable(false) },
                                { id: 3, fullTitle: 'Столбец 3', visible: ko.observable(true) },
                                { id: 4, fullTitle: 'Столбец 4', visible: ko.observable(false) },
                                { id: 5, fullTitle: 'Столбец 5', visible: ko.observable(true) },
                                { id: 6, fullTitle: 'Столбец 6', visible: ko.observable(false) },
                                { id: 7, fullTitle: 'Столбец 7', visible: ko.observable(true) },
                                { id: 8, fullTitle: 'Столбец 8', visible: ko.observable(false) },
                                { id: 9, fullTitle: 'Столбец 9', visible: ko.observable(false) },
                                { id: 10, fullTitle: 'Столбец 10', visible: ko.observable(false) },
                                { id: 11, fullTitle: 'Столбец 11', visible: ko.observable(false) },
                                { id: 12, fullTitle: 'Столбец 12', visible: ko.observable(false) },
                            ]
                        },
                        close: result => {
                            console.log(result);
                        }
                    });
                }
                if (modalId === 'stimulation') {
                    this.modalOpens.push({
                        dialogTemplateName: 'stimulation-modal-template',
                        data: {
                            category: 'production',
                            fines: window.directories.fines,
                            bonuses: window.directories.bonuses,
                            authors: window.directories.authors
                        },
                        close: result => {
                            console.log(result)
                        }
                    })
                }

                if (modalId === 'addEmployees') {
                    if (mode === 'single-position') {
                        this.modalOpens.push({
                            dialogTemplateName: 'add-employees-modal-template',
                            data: {
                                position: {
                                    name: 'Position name',
                                    id: 'positionid',
                                    visible: ko.observable(true),
                                    employees: ko.observableArray([
                                        { id: 1, name: 'Employee 1', visible: ko.observable(true) },
                                        { id: 2, name: 'Employee 2', visible: ko.observable(false) },
                                        { id: 3, name: 'Employee 3', visible: ko.observable(false) },
                                    ]),
                                    allEmployeesLoaded: ko.observable(false)
                                },
                                mode: 'single'
                            },
                            close: result => {
                                console.log(result)
                            }
                        });
                    } else if (mode === 'single-other') {
                        this.modalOpens.push({
                            dialogTemplateName: 'add-employees-modal-template',
                            data: {
                                positions: [
                                    {
                                        name: 'Position 1',
                                        id: 'position1',
                                        visible: ko.observable(false),
                                        employees: ko.observableArray([
                                            { id: 1, name: 'Employee 1', visible: ko.observable(false) },
                                            { id: 2, name: 'Employee 2', visible: ko.observable(false) },
                                            { id: 3, name: 'Employee 3', visible: ko.observable(false) },
                                        ]),
                                        allEmployeesLoaded: ko.observable(false)
                                    },
                                    {
                                        name: 'Position 2',
                                        id: 'position2',
                                        visible: ko.observable(false),
                                        employees: ko.observableArray([
                                            { id: 1, name: 'Employee 1', visible: ko.observable(true) },
                                            { id: 2, name: 'Employee 2', visible: ko.observable(false) },
                                            { id: 3, name: 'Employee 3', visible: ko.observable(false) },
                                        ]),
                                        allEmployeesLoaded: ko.observable(false)
                                    },
                                    {
                                        name: 'Position 3',
                                        id: 'position3',
                                        visible: ko.observable(false),
                                        employees: ko.observableArray([
                                            { id: 1, name: 'Employee 1', visible: ko.observable(true) },
                                            { id: 2, name: 'Employee 2', visible: ko.observable(false) },
                                            { id: 3, name: 'Employee 3', visible: ko.observable(false) },
                                        ]),
                                        allEmployeesLoaded: ko.observable(false)
                                    }
                                ],
                                mode: 'list'
                            },
                            close: result => {
                                console.log(result)
                            }
                        });
                    } else {
                        this.modalOpens.push({
                            dialogTemplateName: 'add-employees-modal-template',
                            data: {
                                positions: [
                                    {
                                        name: 'Position 1',
                                        id: 'position1',
                                        visible: ko.observable(true),
                                        employees: ko.observableArray([
                                            { id: 1, name: 'Employee 1', visible: ko.observable(true) },
                                            { id: 2, name: 'Employee 2', visible: ko.observable(false) },
                                            { id: 3, name: 'Employee 3', visible: ko.observable(false) },
                                        ]),
                                        allEmployeesLoaded: ko.observable(false)
                                    },
                                    {
                                        name: 'Position 2',
                                        id: 'position2',
                                        visible: ko.observable(false),
                                        employees: ko.observableArray([
                                            { id: 4, name: 'Employee 1', visible: ko.observable(true) },
                                            { id: 5, name: 'Employee 2', visible: ko.observable(false) },
                                            { id: 6, name: 'Employee 3', visible: ko.observable(false) },
                                        ]),
                                        allEmployeesLoaded: ko.observable(false)
                                    },
                                    {
                                        name: 'Position 3',
                                        id: 'position3',
                                        visible: ko.observable(false),
                                        employees: ko.observableArray([
                                            { id: 7, name: 'Employee 1', visible: ko.observable(true) },
                                            { id: 8, name: 'Employee 2', visible: ko.observable(false) },
                                            { id: 9, name: 'Employee 3', visible: ko.observable(false) },
                                        ]),
                                        allEmployeesLoaded: ko.observable(false)
                                    }
                                ],
                                mode: 'tabs'
                            },
                            close: result => {
                                console.log(result)
                            }
                        });
                    }
                }
            };

            this.formControlErrorStateMatcher = function (formControl) {
                return ko.pureComputed(() => {
                    return !formControl.isValid();
                });
            };

            this.editableCellControlErrorExtractor = function (control) {
                return ko.pureComputed(() => {
                    return !control.isValid() ? { message: control.error() } : null;
                });
            };

            this.childrenComplete = function () {
                $page.removeClass('hrm-page--initializing');
            };

            $(window).on('resize', this.windowResizeHandler);
        };

        const viewModel = new ViewModel();

        ViewModel.prototype.dispose = function () {
            $(window).off('resize', this.windowResizeHandler);
        };

        ko.applyBindings(
            viewModel,
            $page.get()[0]
        );
    });
</script>

    <script type="text/html"
        id="positions-modal-template">

  <div data-bind="component: {
      name: 'positions-modal-dialog',
      params: {
        data, modalElement,
        cancel: function () { close(); },
        submit: function ($data) {close($data);}
      }}" role="document">
  </div>

</script>

<script type="text/html"
        id="columns-modal-template">

  <div data-bind="component: {
      name: 'columns-modal-dialog',
      params: {
        data, modalElement,
        cancel: function () { close(); },
        submit: function ($data) {close($data);}
      }}" role="document">
  </div>

</script>

<script type="text/html"
        id="stimulation-modal-template">

  <div data-bind="component: {
      name: 'stimulation-modal-dialog',
      params: {
        data, modalElement,
        cancel: function () { close(); },
        submit: function ($data) {close($data);}
      }}" role="document">
  </div>

</script>

<script type="text/html"
        id="create-employee-modal-template">

  <div data-bind="component: {
      name: 'create-employee-modal-dialog',
      params: {
        data, modalElement,
        cancel: function () { close(); },
        submit: function ($data) {close($data);}
      }}" role="document">
  </div>

</script>

<script type="text/html"
        id="add-employees-modal-template">

  <div data-bind="component: {
      name: 'add-employees-modal-dialog',
      params: {
        data, modalElement,
        cancel: function () { close(); },
        submit: function ($data) {close($data);}
      }}" role="document">
  </div>

</script>

<script type="text/html"
        id="account-operations-modal-template">

  <div data-bind="component: {
      name: 'account-operations-modal-dialog',
      params: {
        data, modalElement,
        cancel: function () { close(); },
        submit: function ($data) {close($data);}
      }}" role="document">
  </div>

</script>

<script type="text/html"
        id="employee-bonus-modal-template">

  <div data-bind="component: {
      name: 'employee-bonus-modal-dialog',
      params: {
        data, modalElement,
        cancel: function () { close(); },
        submit: function ($data) {close($data);}
      }}" role="document">
  </div>

</script>

<script type="text/html"
        id="employee-fine-modal-template">

  <div data-bind="component: {
      name: 'employee-fine-modal-dialog',
      params: {
        data, modalElement,
        cancel: function () { close(); },
        submit: function ($data) {close($data);}
      }}" role="document">
  </div>

</script>


<!-- ko component: {name: 'hrm-modal-container', params: {opens: modalOpens}} --><!-- /ko -->

<template id="columns-modal-dialog-template">

  <button class="hrm-button hrm-basic-modal-dialog__close-button"
          data-bind="click: function() { cancel(); }"
          aria-label="Close">
  </button>

  <div class="hrm-basic-modal-dialog__header">
    <h2 class="hrm-basic-modal-dialog__title">
      Настройка столбцов
    </h2>
  </div>

  <div class="hrm-basic-modal-dialog__body columns-settings">
    <div class="columns-settings__search"
         data-bind="component: {name: 'hrm-search-field', params: { termModel: term, placeholder: 'Поиск по наименованию' }}">
    </div>


    <div class="modal-dialog__scroll" data-bind="component: { name: 'hrm-scrollable-wrapper', params: { options: {}}}">
      <div class="modal-dialog__scroll-container columns-settings__list"
           >
        <!-- ko foreach: { data: columns, as: 'column' } -->

        <!-- ko if: column.visible() -->

        <!-- ko let: {checkboxGroup: ko.observable(null)} -->
        <div class="columns-settings__list-item">
          <div data-bind="component: {name: 'hrm-checkbox-group', params: {exportAs: checkboxGroup}}">
            <div
                 data-bind="component: {name: 'hrm-checkbox', params: {owner: checkboxGroup, checked: column.checked }}">
            </div>
            <label
                   data-bind="hrmCheckboxGroupLabel, hrmCheckboxGroupLabelOwner: checkboxGroup, text: column.name"></label>
          </div>
        </div>
        <!-- /ko -->

        <!-- /ko -->
        <!-- /ko -->
      </div>
    </div>


  </div>

  <div class="hrm-basic-modal-dialog__action-list columns-settings__action-list">
    <button class="hrm-button hrm-basic-button  hrm-button--size_large hrm-basic-modal-dialog__action-list-item"
            data-bind="click: function() {reset();}">
      Сбросить
    </button>

    <button class="hrm-button hrm-basic-button hrm-button--size_large  hrm-accent-button hrm-basic-modal-dialog__action-list-item"
            data-bind="click: function() {submit();}">
      Применить
    </button>
  </div>

</template>


<script type="text/javascript">
    $(function () {
        function ColumnModel(column) {
            const checked = ko.observable(column.visible());
            function apply() {
                column.visible(checked());
            }
            return {
                id: column.id,
                name: column.fullTitle,
                checked,
                visible: ko.observable(true),
                apply
            }
        }

        ko.components.register('columns-modal-dialog', {
            viewModel: {
                createViewModel: function (params, componentInfo) {
                    const $element = $(componentInfo.element);
                    $element.addClass([
                        'modal-dialog',
                        'modal-dialog-centered',
                        'hrm-modal-dialog',
                        'hrm-basic-modal-dialog',
                        'hrm-modal-dialog--size_large',
                        'modal-dialog--columns'
                    ]);


                    const viewModel = new (function () {
                        this.columns = params.data.columns.map(ColumnModel);

                        this.viewportSize = ko.observable({ width: $(window).width(), height: $(window).height() });

                        this.windowResizeHandler = () => {
                            this.viewportSize({ width: $(window).width(), height: $(window).height() });
                        };

                        $(window).on('resize', this.windowResizeHandler);

                        /** Поисковый запрос */
                        this.term = ko.observable('');
                        /** Скрыть/Показать позиции в списке */
                        this.term.subscribe(value => {
                            const formattedTerm = value.toLowerCase();

                            this.columns.forEach(c => {
                                let isVisible = true;
                                if (formattedTerm.length >= 1) {
                                    const formattedName = c.name.toLowerCase();
                                    isVisible = formattedName.indexOf(formattedTerm) !== -1;
                                    console.log(isVisible)
                                }
                                c.visible(isVisible);
                            })
                        });

                        /** Сбросить все чекбоксы и поисковый запрос */
                        this.reset = function () {
                            this.term('');
                            this.columns.forEach(c => {
                                c.checked(false);
                            });
                        }

                        /** Закрыть окно без изменений */
                        this.cancel = function () {
                            if ('cancel' in params) {
                                params.cancel();
                            }
                        };

                        /** Применить изменения */
                        this.apply = function () {
                            this.columns.forEach(c => {
                                c.apply()
                            });
                        }

                        this.submit = function () {
                            if ('submit' in params) {
                                this.apply();
                                params.submit(true);
                            }
                        };
                    });

                    viewModel.dispose = () => {
                        $(window).off('resize', viewModel.windowResizeHandler);
                    }

                    return viewModel;
                }
            },
            template: {
                element: document.getElementById('columns-modal-dialog-template')
            }
        });
    });
</script>

<template id="positions-modal-dialog-template">

  <button class="hrm-button hrm-basic-modal-dialog__close-button"
          data-bind="click: function() { cancel(); }"
          aria-label="Close">
  </button>

  <div class="hrm-basic-modal-dialog__header">
    <h2 class="hrm-basic-modal-dialog__title">
      Показывать в таблице должности
    </h2>
  </div>

  <div class="hrm-basic-modal-dialog__body positions-settings">
    <div class="positions-settings__search"
         data-bind="component: {name: 'hrm-search-field', params: { termModel: term, placeholder: 'Поиск по должности' }}">
    </div>

    <div class="modal-dialog__scroll">
      <div class="positions-settings__list"
           data-bind="component: { name: 'hrm-scrollable-wrapper', params: { options: {}} }">
        <!-- ko foreach: { data: positions, as: 'position' } -->

        <!-- ko let: {checkboxGroup: ko.observable(null), visible: position.visible} -->
        <div class="positions-settings__list-item"
             data-bind="if: visible">
          <div data-bind="component: {name: 'hrm-checkbox-group', params: {exportAs: checkboxGroup}}">
            <div
                 data-bind="component: {name: 'hrm-checkbox', params: {owner: checkboxGroup, checked: position.checked }}">
            </div>
            <label
                   data-bind="hrmCheckboxGroupLabel, hrmCheckboxGroupLabelOwner: checkboxGroup, text: position.name"></label>
          </div>
        </div>
        <!-- /ko -->

        <!-- /ko -->
      </div>
    </div>



  </div>

  <div class="hrm-basic-modal-dialog__action-list">
    <button class="hrm-button hrm-basic-button hrm-basic-modal-dialog__action-list-item
         position-page__speciality-modal-dialog-cancel-button"
            data-bind="click: function() {reset();}">
      Сбросить
    </button>

    <button class="hrm-button hrm-basic-button hrm-accent-button hrm-basic-modal-dialog__action-list-item
         position-page__speciality-modal-dialog-submit-button"
            data-bind="click: function() {submit();}">
      Применить
    </button>
  </div>

</template>


<script type="text/javascript">
    $(function () {
        function PositionModel(positionData) {
            const checked =  ko.observable(!!positionData.visible());
            function apply() {
                positionData.visible(checked());
            }
            return {
                name: positionData.name,
                checked,
                visible: ko.observable(true),
                apply
            }
        }

        ko.components.register('positions-modal-dialog', {
            viewModel: {
                createViewModel: function (params, componentInfo) {
                    const $element = $(componentInfo.element);
                    $element.addClass([
                        'modal-dialog',
                        'modal-dialog-centered',
                        'hrm-modal-dialog',
                        'hrm-basic-modal-dialog',
                        'hrm-modal-dialog--size_large',
                        'modal-dialog--positions-settings'
                    ]);

                    const ViewModel = function(positions) {
                        /** Positions model */
                        this.positions = positions.map(PositionModel);

                        /** Поисковый запрос */
                        this.term = ko.observable('');
                        /** Скрыть/Показать позиции в списке */
                        this.term.subscribe(value => {
                            const formattedTerm = value.toLowerCase();

                            this.positions.forEach(p => {
                                let isVisible = true;
                                if (formattedTerm.length >= 1) {
                                    const formattedName = p.name.toLowerCase();
                                    isVisible = formattedName.indexOf(formattedTerm) !== -1;
                                }
                                p.visible(isVisible);
                            })
                        });

                        /** Сбросить все чекбоксы и поисковый запрос */
                        this.reset = function () {
                            this.term('');
                            this.positions.forEach(p => {
                                p.checked(false);
                            });
                        }

                        /** Закрыть окно без изменений */
                        this.cancel = function () {
                            if ('cancel' in params) {
                                params.cancel();
                            }
                        };

                        /** Применить изменения */
                        this.apply = function() {
                            this.positions.forEach(p => {
                                p.apply();
                            });
                        }

                        this.submit = function () {
                            if ('submit' in params) {
                                this.apply();
                                params.submit(true);
                            }
                        };
                    }

                    return new ViewModel(params.data.positions());
                }
            },
            template: {
                element: document.getElementById('positions-modal-dialog-template')
            }
        });
    });
</script>

<template id="account-operation-template">
  <div class="account-operation"
       data-bind="hrmLog">
    <div class="account-operation__type">

      <div class="hrm-radio-group"
           data-bind="let: {radioGroupId: 'account-operation-' + $index()}">
        <div class="hrm-radio-group__radio hrm-radio-group__radio--theme_negative">
          <input class="hrm-radio-group__radio-input"
                 data-bind="checked: type, attr: {id: radioGroupId + '-fine'}"
                 type="radio"
                 value="fine"
                 checked />
          <label class="hrm-radio-group__radio-label"
                 data-bind="attr: {'for': radioGroupId + '-fine'}">
            Списать
          </label>
        </div>

        <div class="hrm-radio-group__radio hrm-radio-group__radio--theme_positive">
          <input class="hrm-radio-group__radio-input"
                 data-bind="checked: type, attr: {id: radioGroupId + '-bonus'}"
                 type="radio"
                 value="bonus" />
          <label class="hrm-radio-group__radio-label"
                 data-bind="attr: {'for': radioGroupId + '-bonus'}">
            Начислить
          </label>
        </div>
      </div>

    </div>

    <div class="account-operation__sum">
      <!-- ko let: {control: ko.observable(null)} -->
      <div class="account-operation__sum-value"
           data-bind="hrmFormField, hrmFormFieldControlRef: control">
        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
          <input type="text" placeholder="0"
                 data-bind="
              textInput: sum,
              hrmMask, hrmMaskPattern: 'decimal',
              hrmFormFieldInputControl: control,
              hrmFormFieldInputControlErrorStateMatcher: $parent.formControlErrorStateMatcher.bind($parent)
          ">
        </div>

        <div data-bind="
          component: {name: 'hrm-form-field-error'},
          hrmSlide,
          hrmSlideValue: control() !== null ? control().errorState : false,
          hrmSlideDuration: 150
      ">
          <!-- ko text: $parent.sum.error() -->
          <!-- /ko -->
        </div>
      </div>
      <!-- /ko -->
      <div class="account-operation__sum-sign">₽</div>
    </div>


    <!-- ko let: {control: ko.observable(null)} -->
    <div class="account-operation__comment"
         data-bind="hrmFormField, hrmFormFieldControlRef: control">

      <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control, hrmFormFieldBasisAllowClear">
        <textarea data-bind="
            attr: {placeholder: commentPlaceholder},
            textInput: comment,
            hrmFormFieldInputControl: control,
            hrmAutoResize"
                  placeholder="Комментарий"></textarea>
      </div>

    </div>
    <!-- /ko -->



    <div class="account-operation__remove">
      <!-- ko if: $parent.viewportSize().width > HRM_BREAKPOINTS.mobileMaxWidth -->
      <button class="hrm-button hrm-icon-button hrm-trash-icon-button hrm-icon-button--theme_negative"
              data-bind="click: $parent.removeOperation, hrmTooltip, hrmTooltipText: 'Удалить'"></button>
      <!-- /ko -->

      <!-- ko ifnot: $parent.viewportSize().width > HRM_BREAKPOINTS.mobileMaxWidth -->
      <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_negative hrm-button-with-trash-icon"
              data-bind="click: $parent.removeOperation, hrmTooltip, hrmTooltipText: 'Удалить'">Удалить</button>
      <!-- /ko -->


    </div>
  </div>
</template>

<template id="account-operations-modal-dialog-template">
  <button class="hrm-button hrm-basic-modal-dialog__close-button"
          data-bind="click: function() { cancel(); }"
          aria-label="Close">
  </button>

  <div class="hrm-basic-modal-dialog__header">
    <h2 class="hrm-basic-modal-dialog__title">
      Операции с личным счетом
    </h2>
  </div>

  <div class="hrm-basic-modal-dialog__body account-operations-form">

    <div class="modal-dialog__scroll">
      <div class="account-operations-form__list" data-bind="component: {
        name: 'hrm-scrollable-wrapper',
        params: { options: {} }
      }">
        <!-- ko template: {
          name: 'account-operation-template',
          foreach: operations,
          afterAdd: hrmFadeAfterAddFactory(200),
          beforeRemove: hrmFadeBeforeRemoveFactory(200)
        } -->
        <!-- /ko -->
      </div>
    </div>



    <div class="account-operations-form__actions">
      <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_neutral hrm-button-with-plus-icon"
              data-bind="click: addOperation">Добавить</button>

      <div class="account-operations-form__total color--secondary">
        Итого: <span class="account-operations-form__total-value"
              data-bind="hrmColoredSign: total">
          <!-- ko text: $component.formatSign(total) -->
          <!-- /ko -->
          <i class="far fa-ruble-sign"
             aria-hidden="true"></i>
        </span>

      </div>



    </div>



  </div>

  <div class="hrm-basic-modal-dialog__action-list">
    <button class="hrm-button hrm-basic-button hrm-basic-modal-dialog__action-list-item
         position-page__speciality-modal-dialog-cancel-button"
            data-bind="click: function() {cancel();}">
      Отменить
    </button>

    <button class="hrm-button hrm-basic-button hrm-accent-button hrm-basic-modal-dialog__action-list-item
         position-page__speciality-modal-dialog-submit-button"
            data-bind="click: function() {submit();}">
      Сохранить
    </button>
  </div>
</template>


<script>
  $(function () {
    function AccountOperation(operationData) {
      operationData = operationData || {};

      this.type = ko.observable(operationData.type || 'fine').extend({
        required: {
          message: 'Обязательное поле'
        }
      });
      this.sum = ko.observable(parseFloat(operationData.sum) || '').extend({
        required: {
          message: 'Обязательное поле'
        },
        number: {
          message: 'Некорректный формат'
        }
      });
      this.comment = ko.observable(operationData.comment || '');
      this.commentPlaceholder = ko.pureComputed(() => {
        return this.type() === 'fine' ? 'Комментарий к списанию' : 'Комментарий к начислению';
      });
      this.total = ko.pureComputed(() => {
        const sign = this.type() === 'fine' ? -1 : 1;
        return this.sum() * sign;
      });

      this.getData = () => {
        let sum = parseFloat(this.sum());
        sum = sum.toFixed(2);

        return {
          type: this.type(),
          sum: parseFloat(sum),
          comment: this.comment()
        };
      }
    }

    ko.components.register('account-operations-modal-dialog', {
      viewModel: {
        createViewModel: function (params, componentInfo) {
          const $element = $(componentInfo.element);
          $element.addClass([
            'modal-dialog',
            'modal-dialog-centered',
            'hrm-modal-dialog',
            'hrm-basic-modal-dialog',
            'modal-dialog--account-operations'
          ]);

          const ViewModel = function (operations) {
            this.viewportSize = ko.observable({ width: $(window).width(), height: $(window).height() });
            this.windowResizeHandler = () => {
              this.viewportSize({ width: $(window).width(), height: $(window).height() });
            };
            $(window).on('resize', this.windowResizeHandler);

            this.formatSign = (number) => {
              const formattedNumber = parseFloat(ko.unwrap(number));
              if (!formattedNumber) return number;
              if (formattedNumber > 0) return '+' + formattedNumber;
              return formattedNumber;
            };

            this.isSubmitted = ko.observable(false);

            this.formControlErrorStateMatcher = (formControl) => {
              return ko.pureComputed(() => {
                return this.isSubmitted() && !formControl.isValid();
              });
            };

            this.operations = ko.observableArray(operations.map(o => new AccountOperation(o)));
            if (!this.operations().length) this.operations.push(new AccountOperation());

            this.total = ko.pureComputed(() => {
              return this.operations().reduce((sum, operation) => {

                return Math.floor((sum + operation.total()) * 100) / 100;
              }, 0);
            })

            this.addOperation = () => {
              this.operations.push(new AccountOperation());
            }

            this.removeOperation = (operation) => {
              this.operations.remove(operation);
            }

            /** Закрыть окно без изменений */
            this.cancel = function () {
              if ('cancel' in params) {
                params.cancel();
              }
            };

            /** Применить изменения */
            this.apply = function () {
              employee.accountOperations(this.operations()
                .map(operation => operation.getData())
                .filter(operation => operation.sum));
            }

            this.submit = function () {
              if ('submit' in params) {
                this.apply();
                params.submit(true);
              }
            };

            this.dispose = function () {
              $(window).off('resize', this.windowResizeHandler);
            };

          }

          const employee = params.data.employee;
          return new ViewModel(employee.accountOperations());
        }
      },
      template: {
        element: 'account-operations-modal-dialog-template'
      }
    });
  })
</script>

<template id="fine-block-template">
  <div class="fine-block">
    <div class="fine-block__content">
      <!-- Base select -->
      <!-- ko let: {control: ko.observable(null), label: ko.observable(null) } -->
      <div class="fine-block__row fine-block__base"
           data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
        <label data-bind="hrmFormFieldLabel: label">
          Основание штрафа
        </label>

        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
          <select data-bind="bindInner, value: base,
            hrmSelect,
            hrmSelectSearchEnabled: true,
            hrmSelectPlaceholder: 'Не выбрано', hrmSelectAllowClear: true,
            hrmFormFieldSelectControl: control,
            hrmFormFieldSelectControlErrorStateMatcher: $component.formControlErrorStateMatcher.bind($component)">

            <option></option>

            <!-- ko foreach: {data: $component.fineBases, as: 'group'} -->
            <optgroup data-bind="attr: {label: group.name}">
              <!-- ko foreach: { data: group.items, as: 'option' } -->
              <option data-bind="value: '' + option.id, text: option.name"></option>
              <!-- /ko -->

            </optgroup>
            <!-- /ko -->
          </select>
        </div>


        <div data-bind="component: {name: 'hrm-form-field-error'},
          hrmSlide,
          hrmSlideValue: control() !== null ? control().errorState : false,
          hrmSlideDuration: 150">
          <!-- ko text: $parent.base.error() -->
          <!-- /ko -->
        </div>
      </div>
      <!-- /ko -->
      <!-- /Base select -->

      <div class="fine-block__row">
        <!-- Sum field -->
        <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
        <div class="fine-block__sum"
             data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
          <label data-bind="hrmFormFieldLabel: label">Сумма,
            <i class="far fa-ruble-sign"></i>
          </label>

          <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
            <input data-bind="
              textInput: sum,
              hrmFormFieldInputControl: control,
              hrmFormFieldInputControlErrorStateMatcher: $component.formControlErrorStateMatcher.bind($component)"
                   readonly
                   type="number">
          </div>

          <div data-bind="
              component: {name: 'hrm-form-field-error'},
              hrmSlide,
              hrmSlideValue: control() !== null ? control().errorState : false,
              hrmSlideDuration: 150
          ">
            <!-- ko text: $parent.sum.error() -->
            <!-- /ko -->
          </div>
        </div>
        <!-- /ko -->
        <!-- /Sum field -->


        <!-- Author select -->
        <!-- ko let: {control: ko.observable(null), label: ko.observable(null) } -->
        <div class="fine-block__author"
             data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
          <label data-bind="hrmFormFieldLabel: label">Автор штрафа</label>

          <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
            <select data-bind="bindInner, value: author,
              hrmSelect,
              hrmSelectSearchEnabled: true,
              hrmSelectPlaceholder: 'Не выбран', hrmSelectAllowClear: true,
              hrmFormFieldSelectControl: control,
              hrmFormFieldSelectControlErrorStateMatcher: $component.formControlErrorStateMatcher.bind($component)">
              <option></option>
              <!-- ko foreach: $component.authors -->
              <option data-bind="value: '' + id, text: name"></option>
              <!-- /ko -->
            </select>
          </div>

          <div data-bind="component: {name: 'hrm-form-field-error'},
        hrmSlide,
        hrmSlideValue: control() !== null ? control().errorState : false,
        hrmSlideDuration: 150">
            <!-- ko text: $parent.author.error() -->
            <!-- /ko -->
          </div>
        </div>
        <!-- /ko -->
        <!-- /Author select -->
      </div>

      <!-- Comment field -->
      <!-- ko let: {control: ko.observable(null)} -->
      <div class="fine-block__row fine-block__comment"
           data-bind="
     hrmFormField, hrmFormFieldControlRef: control
 ">

        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control, hrmFormFieldBasisAllowClear">
          <textarea data-bind="
             textInput: comment,
             hrmFormFieldInputControl: control,
             hrmAutoResize
         "
                    placeholder="Комментарий"></textarea>
        </div>

      </div>
      <!-- /ko -->
      <!-- /Comment field -->
    </div>

    <div class="fine-block__remove">
      <!-- ko if: $component.viewportSize().width > HRM_BREAKPOINTS.mobileMaxWidth -->
      <button class="hrm-button hrm-icon-button hrm-trash-icon-button hrm-icon-button--theme_negative"
              data-bind="click: $component.removeFine, hrmTooltip, hrmTooltipText: 'Удалить'"></button>
      <!-- /ko -->

      <!-- ko ifnot: $component.viewportSize().width > HRM_BREAKPOINTS.mobileMaxWidth -->
      <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_negative hrm-button-with-trash-icon"
              data-bind="click: $component.removeFine, hrmTooltip, hrmTooltipText: 'Удалить'">Удалить</button>
      <!-- /ko -->
    </div>
  </div>
</template>

<template id="employee-fine-modal-dialog-template">
  <button class="hrm-button hrm-basic-modal-dialog__close-button"
          data-bind="click: function() { cancel(); }"
          aria-label="Close">
  </button>

  <div class="hrm-basic-modal-dialog__header">
    <h2 class="hrm-basic-modal-dialog__title">
      Выписать штраф
    </h2>
  </div>

  <div class="hrm-basic-modal-dialog__body fine-form">
    <div class="modal-dialog__scroll">
      <div class="fine-form__scroll-list"
           data-bind="hrmScrollable">
        <!-- ko template: {
          name: 'fine-block-template',
          foreach: fines,
          afterAdd: hrmFadeAfterAddFactory(200),
          beforeRemove: hrmFadeBeforeRemoveFactory(200)
        } -->
        <!-- /ko -->


      </div>
    </div>
    <div class="fine-form__actions">
      <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_neutral hrm-button-with-plus-icon"
              data-bind="click: addFine">Добавить штраф</button>

      <div class="fine-form__total color--secondary">
        Итого: <span class="fine-form__total-value"
              data-bind="hrmColoredSign: -1 * total()">
          <!-- ko text: $component.formatSign(-1 * total()) -->
          <!-- /ko -->
          <i class="far fa-ruble-sign"
             aria-hidden="true"></i>
        </span>
      </div>

    </div>

  </div>

  <div class="hrm-basic-modal-dialog__action-list">
    <button class="hrm-button hrm-basic-button hrm-basic-modal-dialog__action-list-item
        position-page__speciality-modal-dialog-cancel-button"
            data-bind="click: function() {cancel();}">
      Отменить
    </button>

    <button class="hrm-button hrm-basic-button hrm-accent-button hrm-basic-modal-dialog__action-list-item
        position-page__speciality-modal-dialog-submit-button"
            data-bind="click: function() {submit();}">
      Сохранить
    </button>
  </div>
</template>


<script>
  $(function () {
    function Fine(defaultData, fineBases) {
      defaultData = defaultData || {};
      const base = ko.observable(defaultData.base).extend({
        required: {
          message: 'Обязательное поле'
        }
      });
      const sum = ko.observable(defaultData.sum || '').extend({
        required: {
          message: 'Обязательное поле'
        },
        number: {
          message: 'Некорректный формат'
        }
      });
      base.subscribe(baseId => {
        let baseData;
        for (let groupIndex in fineBases) {
          let group = fineBases[groupIndex];
          for (let itemIndex in group.items) {
            let item = group.items[itemIndex];
            if (item.id === baseId) {
              baseData = item;
              break;
            }
          }
          if (baseData) break;
        }

        fineBases.find(group => {
          return group.items.find(item => item.id === baseId);
        });
        if (baseData) sum(baseData.sum);
        else sum(null);
      });
      const author = ko.observable(defaultData.author).extend({
        required: {
          message: 'Обязательное поле'
        }
      });

      const validationObject = ko.validatedObservable({
        base,
        author,
        sum
      });
      return {
        base,
        author,
        sum,
        comment: ko.observable(defaultData.comment || '').extend({

        }),

        isValid: () => {
          return validationObject.isValid();
        }
      }
    }

    ko.components.register('employee-fine-modal-dialog', {
      viewModel: {
        createViewModel: function (params, componentInfo) {
          const $element = $(componentInfo.element);
          $element.addClass([
            'modal-dialog',
            'modal-dialog-centered',
            'hrm-modal-dialog',
            'hrm-basic-modal-dialog',
            'hrm-modal-dialog--size_large',
            'modal-dialog--employee-fine'
          ]);

          const employee = params.data.employee;
          const finesList = params.data.fines;
          const authorsList = params.data.authors;

          const ViewModel = function (defaultFines, finesList, authorsList) {
            this.viewportSize = ko.observable({ width: $(window).width(), height: $(window).height() });
            this.windowResizeHandler = () => {
              this.viewportSize({ width: $(window).width(), height: $(window).height() });
            };
            $(window).on('resize', this.windowResizeHandler);

            this.formatSign = (number) => {
              const formattedNumber = parseFloat(ko.unwrap(number));
              if (!formattedNumber) return number;
              if (formattedNumber > 0) return '+' + formattedNumber;
              return formattedNumber;
            };

            this.isSubmitted = ko.observable(false);

            this.formControlErrorStateMatcher = (formControl) => {
              return ko.pureComputed(() => {
                return this.isSubmitted() && !formControl.isValid();
              });
            };

            this.fineBases = finesList;
            this.authors = authorsList;

            this.fines = ko.observableArray(defaultFines.map((fineData) => {
                return Fine(fineData, this.fineBases);
            }));

            if (!this.fines().length) this.fines.push(Fine(null, this.fineBases));

            this.addFine = () => {
              this.fines.push(Fine(null, this.fineBases))
            };

            this.removeFine = (fine) => {
              this.fines.remove(fine);
            }

            this.total = ko.pureComputed(() => {
              return this.fines().reduce((sum, fine) => {
                let fineSum = parseFloat(fine.sum()) || 0;
                return sum + fineSum;
              }, 0);
            })

            /** Закрыть окно без изменений */
            this.cancel = function () {
              if ('cancel' in params) {
                params.cancel();
              }
            };

            /** Применить изменения */
            this.apply = function () {
              employee.fines(ko.toJS(this.fines));
            }

            this.submit = function () {
              this.isSubmitted(true);

              if (this.fines().some(f => !f.isValid())) return;

              if ('submit' in params) {
                this.apply();
                params.submit(true);
              }
            };

            this.dispose = function () {
              $(window).off('resize', this.windowResizeHandler);
            };
          }

          return new ViewModel(employee.fines(), finesList, authorsList);
        }
      },
      template: {
        element: 'employee-fine-modal-dialog-template'
      }
    });
  })
</script>

<template id="bonus-block-template">
  <div class="bonus-block">
    <div class="bonus-block__content">
      <!-- Base select -->
      <!-- ko let: {control: ko.observable(null), label: ko.observable(null) } -->
      <div class="bonus-block__row bonus-block__base"
           data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
        <label data-bind="hrmFormFieldLabel: label">
          Основание премии
        </label>

        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
          <select data-bind="bindInner, value: base,
            hrmSelect,
            hrmSelectSearchEnabled: true,
            hrmSelectPlaceholder: 'Не выбрано', hrmSelectAllowClear: true,
            hrmFormFieldSelectControl: control,
            hrmFormFieldSelectControlErrorStateMatcher: $component.formControlErrorStateMatcher.bind($component)">

            <option></option>

            <!-- ko foreach: {data: $component.bonusBases, as: 'group'} -->
            <optgroup data-bind="attr: {label: group.name}">
              <!-- ko foreach: { data: group.items, as: 'option' } -->
              <option data-bind="value: option.id, text: option.name"></option>
              <!-- /ko -->

            </optgroup>
            <!-- /ko -->
          </select>
        </div>

        <div data-bind="component: {name: 'hrm-form-field-error'},
     hrmSlide,
     hrmSlideValue: control() !== null ? control().errorState : false,
     hrmSlideDuration: 150">
          <!-- ko text: $parent.base.error() -->
          <!-- /ko -->
        </div>
      </div>
      <!-- /ko -->
      <!-- /Base select -->

      <div class="bonus-block__row">
        <!-- Sum field -->
        <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
        <div class="bonus-block__sum"
             data-bind="
      hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label
  ">
          <label data-bind="hrmFormFieldLabel: label">Сумма,
            <i class="far fa-ruble-sign"></i>
          </label>

          <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
            <input data-bind="
              textInput: sum,
              hrmMask, hrmMaskPattern: 'decimal',
              hrmFormFieldInputControl: control,
              hrmFormFieldInputControlErrorStateMatcher: $component.formControlErrorStateMatcher.bind($component)
          ">
          </div>

          <div data-bind="
          component: {name: 'hrm-form-field-error'},
          hrmSlide,
          hrmSlideValue: control() !== null ? control().errorState : false,
          hrmSlideDuration: 150
      ">
            <!-- ko text: $parent.sum.error() -->
            <!-- /ko -->
          </div>
        </div>
        <!-- /ko -->
        <!-- /Sum field -->


        <!-- Author select -->
        <!-- ko let: {control: ko.observable(null), label: ko.observable(null) } -->
        <div class="bonus-block__author"
             data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
          <label data-bind="hrmFormFieldLabel: label">Автор штрафа</label>

          <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
            <select data-bind="bindInner, value: author,
       hrmSelect,
       hrmSelectSearchEnabled: true,
       hrmSelectPlaceholder: 'Не выбран', hrmSelectAllowClear: true,
       hrmFormFieldSelectControl: control,
       hrmFormFieldSelectControlErrorStateMatcher: $component.formControlErrorStateMatcher.bind($component)">
              <option></option>
              <!-- ko foreach: $component.authors -->
              <option data-bind="value: id, text: name"></option>
              <!-- /ko -->
            </select>
          </div>

          <div data-bind="component: {name: 'hrm-form-field-error'},
   hrmSlide,
   hrmSlideValue: control() !== null ? control().errorState : false,
   hrmSlideDuration: 150">
            <!-- ko text: $parent.author.error() -->
            <!-- /ko -->
          </div>
        </div>
        <!-- /ko -->
        <!-- /Author select -->
      </div>

      <!-- Comment field -->
      <!-- ko let: {control: ko.observable(null)} -->
      <div class="bonus-block__row bonus-block__comment"
           data-bind="
     hrmFormField, hrmFormFieldControlRef: control
 ">

        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control, hrmFormFieldBasisAllowClear">
          <textarea data-bind="
             textInput: comment,
             hrmFormFieldInputControl: control,
             hrmAutoResize
         "
                    placeholder="Комментарий"></textarea>
        </div>

      </div>
      <!-- /ko -->
      <!-- /Comment field -->
    </div>

    <div class="bonus-block__remove">
      <!-- ko if: $component.viewportSize().width > HRM_BREAKPOINTS.mobileMaxWidth -->
      <button class="hrm-button hrm-icon-button hrm-trash-icon-button hrm-icon-button--theme_negative"
              data-bind="click: $component.removeBonus, hrmTooltip, hrmTooltipText: 'Удалить'"></button>
      <!-- /ko -->

      <!-- ko ifnot: $component.viewportSize().width > HRM_BREAKPOINTS.mobileMaxWidth -->
      <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_negative hrm-button-with-trash-icon"
              data-bind="click: $component.removeBonus, hrmTooltip, hrmTooltipText: 'Удалить'" >Удалить</button>
      <!-- /ko -->
    </div>
  </div>
</template>

<template id="employee-bonus-modal-dialog-template">
  <button class="hrm-button hrm-basic-modal-dialog__close-button"
          data-bind="click: function() { cancel(); }"
          aria-label="Close">
  </button>

  <div class="hrm-basic-modal-dialog__header">
    <h2 class="hrm-basic-modal-dialog__title">
      Выписать премию
    </h2>
  </div>

  <div class="hrm-basic-modal-dialog__body bonus-form">
    <div class="modal-dialog__scroll">
      <div class="bonus-form__scroll-list"
           data-bind="hrmScrollable">
        <!-- ko template: {
          name: 'bonus-block-template',
          foreach: bonuses,
          afterAdd: hrmFadeAfterAddFactory(200),
          beforeRemove: hrmFadeBeforeRemoveFactory(200)
        } -->
        <!-- /ko -->


      </div>
    </div>
    <div class="bonus-form__actions">
      <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_neutral hrm-button-with-plus-icon"
              data-bind="click: addBonus">Добавить премию</button>

      <div class="bonus-form__total color--secondary">
        Итого: <span class="bonus-form__total-value"
              data-bind="hrmColoredSign: total">
          <!-- ko text: $component.formatSign(total) -->
          <!-- /ko -->
          <i class="far fa-ruble-sign"
             aria-hidden="true"></i>
        </span>
      </div>

    </div>

  </div>

  <div class="hrm-basic-modal-dialog__action-list">
    <button class="hrm-button hrm-basic-button hrm-basic-modal-dialog__action-list-item
        position-page__speciality-modal-dialog-cancel-button"
            data-bind="click: function() {cancel();}">
      Отменить
    </button>

    <button class="hrm-button hrm-basic-button hrm-accent-button hrm-basic-modal-dialog__action-list-item
        position-page__speciality-modal-dialog-submit-button"
            data-bind="click: function() {submit();}">
      Сохранить
    </button>
  </div>
</template>


<script>
  $(function () {
    function Bonus(defaultData, bonusBases) {
      defaultData = defaultData || {};
      const base = ko.observable(defaultData.base).extend({
        required: {
          message: 'Обязательное поле'
        }
      });
      const sum = ko.observable(defaultData.sum || '').extend({
        required: {
          message: 'Обязательное поле'
        },
        number: {
          message: 'Некорректный формат'
        }
      });

      const author = ko.observable(defaultData.author).extend({
        required: {
          message: 'Обязательное поле'
        }
      });

      const comment = ko.observable(defaultData.comment || '').extend({

      });

      const validationObject = ko.validatedObservable({
        base,
        author,
        sum
      });

      return {
        base,
        author,
        sum,
        comment,

        isValid: () => {
          return validationObject.isValid();
        },
        getData: () => {
          return {
            base: base(),
            author: author(),
            comment: comment(),
            sum: parseFloat(sum())
          }
        }
      }
    }

    ko.components.register('employee-bonus-modal-dialog', {
      viewModel: {
        createViewModel: function (params, componentInfo) {
          const $element = $(componentInfo.element);
          $element.addClass([
            'modal-dialog',
            'modal-dialog-centered',
            'hrm-modal-dialog',
            'hrm-basic-modal-dialog',
            'hrm-modal-dialog--size_large',
            'modal-dialog--employee-bonus'
          ]);

          const employee = params.data.employee;
          const bonusesList = params.data.bonuses;
          const authorsList = params.data.authors;

          const ViewModel = function (defaultBonuses, bonusesList, authorsList) {
            this.viewportSize = ko.observable({ width: $(window).width(), height: $(window).height() });
            this.windowResizeHandler = () => {
              this.viewportSize({ width: $(window).width(), height: $(window).height() });
            };
            $(window).on('resize', this.windowResizeHandler);

            this.formatSign = (number) => {
              const formattedNumber = parseFloat(ko.unwrap(number));
              if (!formattedNumber) return number;
              if (formattedNumber > 0) return '+' + formattedNumber;
              return formattedNumber;
            };

            this.isSubmitted = ko.observable(false);

            this.formControlErrorStateMatcher = (formControl) => {
              return ko.pureComputed(() => {
                return this.isSubmitted() && !formControl.isValid();
              });
            };

            this.bonusBases = bonusesList;
            this.authors = authorsList;

            this.bonuses = ko.observableArray(defaultBonuses.map((bonusData) => {
                return Bonus(bonusData, this.bonusBases);
            }));

            if (!this.bonuses().length) this.bonuses.push(Bonus(null, this.bonusBases));

            this.addBonus = () => {
              this.bonuses.push(Bonus(null, this.bonusBases))
            };

            this.removeBonus = (bonus) => {
              this.bonuses.remove(bonus);
            }

            this.total = ko.pureComputed(() => {
              return this.bonuses().reduce((sum, bonus) => {
                let bonusSum = parseFloat(bonus.sum()) || 0;
                return sum + bonusSum;
              }, 0);
            })

            /** Закрыть окно без изменений */
            this.cancel = function () {
              if ('cancel' in params) {
                params.cancel();
              }
            };

            /** Применить изменения */
            this.apply = function () {
              employee.bonuses(this.bonuses().map(b => b.getData()));
            }

            this.submit = function () {
              this.isSubmitted(true);

              if (this.bonuses().some(b => !b.isValid())) return;

              if ('submit' in params) {
                this.apply();
                params.submit(true);
              }
            };

            this.dispose = function () {
              $(window).off('resize', this.windowResizeHandler);
            };
          }

          return new ViewModel(employee.bonuses(), bonusesList, authorsList);
        }
      },
      template: {
        element: 'employee-bonus-modal-dialog-template'
      }
    });
  })
</script>

<template id="create-employee-modal-dialog-template">

  <button class="hrm-button hrm-basic-modal-dialog__close-button"
          data-bind="click: function() { cancel(); }"
          aria-label="Close">
  </button>

  <div class="hrm-basic-modal-dialog__header">
    <h2 class="hrm-basic-modal-dialog__title">
      Создать сотрудника
    </h2>
  </div>

  <div class="hrm-basic-modal-dialog__body employee-form"
       data-bind="using: formModel">

    <div class="employee-form__row">
      <!-- Name field -->
      <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
      <div class="employee-form__name"
           data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
        <label data-bind="hrmFormFieldLabel: label">ФИО сотрудника</label>

        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control, hrmFormFieldBasisAllowClear">
          <input data-bind="
              textInput: name,
              hrmFormFieldInputControl: control,
              hrmFormFieldInputControlErrorStateMatcher: $component.formControlErrorStateMatcher.bind($component)
          ">
        </div>

        <div data-bind="
          component: {name: 'hrm-form-field-error'},
          hrmSlide,
          hrmSlideValue: control() !== null ? control().errorState : false,
          hrmSlideDuration: 150
      ">
          <!-- ko text: $parent.name.error() -->
          <!-- /ko -->
        </div>
      </div>
      <!-- /ko -->
      <!-- /Name field -->
    </div>

    <div class="employee-form__row">
      <!-- Position select -->
      <!-- ko let: {control: ko.observable(null), label: ko.observable(null) } -->
      <div class="employee-form__position"
           data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
        <label data-bind="hrmFormFieldLabel: label">
          Должность
        </label>

        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
          <select data-bind="value: position,
              options: $component.positions,
              optionsText: 'name',
              optionsValue: 'id',
              valueAllowUnset: true,
              hrmSelect,
              hrmSelectPlaceholder: 'Не выбрано',
              hrmSelectSearchEnabled: true,
              hrmSelectAllowClear: true,
              hrmFormFieldSelectControl: control,
              hrmFormFieldSelectControlErrorStateMatcher: $component.formControlErrorStateMatcher.bind($component)">
          </select>
        </div>

        <div data-bind="
          component: {name: 'hrm-form-field-error'},
          hrmSlide,
          hrmSlideValue: control() !== null ? control().errorState : false,
          hrmSlideDuration: 150
      ">
          <!-- ko text: $parent.position.error() -->
          <!-- /ko -->
        </div>
      </div>
      <!-- /ko -->
      <!-- /Position select -->


      <!-- Levels select -->
      <!-- ko let: {control: ko.observable(null), label: ko.observable(null) } -->
      <div class="employee-form__level"
           data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
        <label data-bind="hrmFormFieldLabel: label">
          Разряд
        </label>

        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
          <select data-bind="value: level,
              disable: $component.levels().length === 0,
              options: $component.levels,
              valueAllowUnset: true,
              hrmSelect,
              hrmSelectPlaceholder: 'Не выбрано', 
              hrmFormFieldSelectControl: control">
          </select>
        </div>
      </div>
      <!-- /ko -->
      <!-- /Levels select -->
    </div>


  </div>

  <div class="hrm-basic-modal-dialog__action-list">
    <button class="hrm-button hrm-basic-button hrm-basic-modal-dialog__action-list-item
         position-page__speciality-modal-dialog-cancel-button"
            data-bind="click: function() {cancel();}">
      Отменить
    </button>

    <button class="hrm-button hrm-basic-button hrm-accent-button hrm-basic-modal-dialog__action-list-item
         position-page__speciality-modal-dialog-submit-button"
            data-bind="click: function() {submit();}">
      Сохранить
    </button>
  </div>

</template>


<script type="text/javascript">
  $(function () {
    function PositionModal(position) {
      return {
        id: position.id,
        name: position.name,
        levels: position.levels
      };
    }

    ko.components.register('create-employee-modal-dialog', {
      viewModel: {
        createViewModel: function (params, componentInfo) {
          const $element = $(componentInfo.element);

          $element.addClass([
            'modal-dialog',
            'modal-dialog-centered',
            'hrm-modal-dialog',
            'hrm-basic-modal-dialog',
            'hrm-modal-dialog--size_large',
            'modal-dialog--create-employee'
          ]);

          const ViewModel = function () {
            this.isSubmitted = ko.observable(false);

            this.formControlErrorStateMatcher = (formControl) => {
              return ko.pureComputed(() => {
                return this.isSubmitted() && !formControl.isValid();
              });
            };

            console.log(params.data)

            this.positions = params.data.positions.map(PositionModal);
            this.levels = ko.observable([]);

            this.formModel = {
              position: ko.observable('').extend({
                required: {
                  message: 'Обязательное поле'
                }
              }),
              level: ko.observable(null),
              name: ko.observable('').extend({
                required: {
                  message: 'Обязательное поле'
                }
              })
            }

            this.validationObject = ko.validatedObservable({
              name: this.formModel.name,
              position: this.formModel.position,
            });

            this.formModel.position.subscribe(positionId => {
              this.formModel.level(null);
              if (!positionId) {
                this.levels([]);
                return;
              }

              const position = this.positions.find(p => p.id === positionId);
              if (!position) this.levels([]);
              else this.levels(position.levels);

              if (this.levels().length) this.formModel.level(this.levels()[0])
            })

            this.cancel = function () {
              if ('cancel' in params) {
                params.cancel();
              }
            };

            this.submit = function () {
              this.isSubmitted(true);

              if (this.validationObject.isValid()) {
                if ('submit' in params) {
                  params.submit(ko.toJS(this.formModel));
                }
              }
            };
          }

          return new ViewModel();
        }
      },
      template: {
        element: document.getElementById('create-employee-modal-dialog-template')
      }
    });
  });
</script>

<script type="text/html"
        id="add-employees-modal-employee-template">
  <!-- ko let: {checkboxGroup: ko.observable(null)} -->
<div data-bind="component: {name: 'hrm-checkbox-group', params: {exportAs: checkboxGroup}}">
  <div data-bind="component: {name: 'hrm-checkbox', params: {owner: checkboxGroup, checked: employee.checked }}">
  </div>
  <label data-bind="hrmCheckboxGroupLabel, hrmCheckboxGroupLabelOwner: checkboxGroup, text: employee.name"></label>
</div>
<!-- /ko -->
</script>

<script type="text/html"
        id="add-employees-modal-position-list-template">

        <div class="employees-form__employees-scrollable-list"
        data-bind="component: { name: 'hrm-scrollable-wrapper', params: { options: {} } }">

        <!-- ko let: {checkboxGroup: ko.observable(null)} -->
        <div class="employees-form__checkbox-group">
          <div data-bind="component: {name: 'hrm-checkbox-group', params: {exportAs: checkboxGroup}}">

              <!-- ko foreach: {data: $parent.position.employees, as: 'employee'} -->
              <!-- ko if: employee.visible -->
              <div class="employees-form__checkbox">

                    <!-- ko template: { name: 'add-employees-modal-employee-template', data: {employee: employee} } -->
                    <!-- /ko -->
              </div>
              <!-- /ko -->
              <!-- /ko -->


          </div>
        </div>
        <!-- /ko -->

        </div>
</script>

<script type="text/html"
        id="add-employees-modal-other-list-template">

  <div class="employees-form__employees-scrollable-list"
  data-bind="component: { name: 'hrm-scrollable-wrapper', params: { options: {} } }">

  <!-- ko let: {checkboxGroup: ko.observable(null)} -->
  <div class="employees-form__checkbox-group">
    <div data-bind="component: {name: 'hrm-checkbox-group', params: {exportAs: checkboxGroup}}">

      <!-- ko foreach: { data: $parent.positions, as: 'position' } -->
      <div class="employees-form__position"
            data-bind="if: position.hasVisibleEmployees">
        <div class="employees-form__position-name"
              data-bind="text: position.name"></div>

        <!-- ko foreach: {data: position.employees, as: 'employee'} -->
        <!-- ko if: employee.visible -->
        <div class="employees-form__checkbox">

              <!-- ko template: { name: 'add-employees-modal-employee-template', data: {employee: employee} } -->
              <!-- /ko -->
        </div>
        <!-- /ko -->
        <!-- /ko -->

      </div>
      <!-- /ko -->
    </div>
  </div>
  <!-- /ko -->

  </div>

</script>


<template id="add-employees-position-tab-template">
  <div class="employees-form__row">
    <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
    <div class="hrm-form-field-switch-group"
         data-bind="hrmSwitchGroup, hrmSwitchGroupControlRef: control, hrmSwitchGroupLabelRef: label">
      <div data-bind="component: {name: 'hrm-switch', params: {exportAs: control, checked: allBranches}}"></div>
      <label data-bind="hrmSwitchGroupLabel: label">
        Все филиалы
      </label>
    </div>
    <!-- /ko -->

    <div class="employees-form__search"
         data-bind="component: {name: 'hrm-search-field', params: { termModel: term, placeholder: 'Поиск по ФИО' }}">
    </div>
  </div><!-- .employees-form__row -->


  <!-- Подгрузка сотрудников -->
  <!-- ko template: {
        foreach: hrmTemplateIf(loadingBranches(), $data),
        afterAdd: hrmFadeAfterAddFactory(200, 200),
        beforeRemove: hrmFadeBeforeRemoveFactory(200)
      } -->
  <div>
    <div class="employees-form__calculating">
      <i class="fa fa-spinner fa-pulse
                            employees-form__calculating-indicator">
      </i>
    </div>
  </div>
  <!-- /ko -->

  <div class="employees-form__tab modal-dialog__scroll">
  <!-- Отображение сотрудников -->
  <!-- ko template: {
        foreach: hrmTemplateIf(!loadingBranches(), $data),
        afterAdd: hrmFadeAfterAddFactory(200, 200),
        beforeRemove: hrmFadeBeforeRemoveFactory(200)
      } -->

  <!-- Список позиций -->
  <!-- ko ifnot: isSingle -->
  <!-- ko template: { name: 'add-employees-modal-other-list-template', data: {positions: positions} } -->
  <!-- /ko -->
  <!-- /ko -->
  <!-- /Список позиций -->

  <!-- Одна позиция -->
  <!-- ko if: isSingle -->
  <!-- ko template: { name: 'add-employees-modal-position-list-template', data: {position: positions[0]} } -->
  <!-- /ko -->
  <!-- /ko -->
  <!-- /Одна позиция -->

  <!-- /ko -->
  <!-- /Отображение сотрудников -->
  </div>

</template>

<template id="add-employees-modal-dialog-template">

  <button class="hrm-button hrm-basic-modal-dialog__close-button"
          data-bind="click: function() { cancel(); }"
          aria-label="Close">
  </button>

  <div class="hrm-basic-modal-dialog__header">
    <h2 class="hrm-basic-modal-dialog__title" data-bind="text: title">
    </h2>
  </div>

  <div class="hrm-basic-modal-dialog__body employees-form">
    <!-- ko if: tabs -->
    <div class="employees-form__tabs">
      <div style="width: 100%"
           data-bind="component: {name: 'hrm-tab-group', params: {items: tabs, activeItem: activeTab }}">
      </div>
    </div>
    <!-- /ko -->


      <!-- ko if: activePosition -->
        <!-- ko component: {
          name: 'add-employees-position-tab',
          params: {
            term: term,
            mode: 'single',
            position: activePosition()
          }
        } -->
        <!-- /ko -->
      <!-- /ko -->


      <!-- ko ifnot: activePosition -->
      <!-- Вкладка Прочие -->
        <!-- ko component: {
          name: 'add-employees-position-tab',
          params: {
            term: term,
            mode: 'list',
            positions: list
          }
        } -->
        <!-- /ko -->
      <!-- /Вкладка Прочие -->
      <!-- /ko -->

  </div>

  <div class="hrm-basic-modal-dialog__action-list">
    <button class="hrm-button hrm-basic-button hrm-basic-modal-dialog__action-list-item
         position-page__speciality-modal-dialog-cancel-button"
            data-bind="click: function() {cancel();}">
      Сбросить
    </button>

    <button class="hrm-button hrm-basic-button hrm-accent-button hrm-basic-modal-dialog__action-list-item
         position-page__speciality-modal-dialog-submit-button"
            data-bind="click: function() {submit();}">
      Применить
    </button>
  </div>

</template>


<script type="text/javascript">
  $(function () {
    const modes = {
      SINGLE: 'single',
      TABS: 'tabs',
      LIST: 'list'
    };

    function EmployeeModel(employeeData) {
      return {
        id: employeeData.id,
        name: employeeData.name,
        checked: ko.observable(!!employeeData.visible()),
        visible: ko.observable(true)
      }
    }

    function PositionModel(positionData) {
      const name = positionData.name;
      const id = positionData.id;
      const employees = ko.observableArray(positionData.employees().map(EmployeeModel));
      const hasVisibleEmployees = ko.observable(true);
      const visible = positionData.visible();
      const loaded = ko.observable(positionData.allEmployeesLoaded());

      function getData() {
        return {
          id,
          employees: ko.toJS(employees),
          loaded
        }
      }

      return {
        name,
        id,
        employees,
        visible,
        hasVisibleEmployees,
        loaded,
        getData
      }
    }

    function NewEmployeeModel(employeeData) {
      return {
        id: employeeData.id,
        name: employeeData.name,
        checked: ko.observable(false),
        visible: ko.observable(true),
        loaded: true,
      }
    }

    ko.components.register('add-employees-position-tab', {
      viewModel: function (params) {
        this.term = params.term;
        this.mode = params.mode || ('position' in params ? modes.SINGLE : modes.LIST);

        this.isSingle = this.mode === modes.SINGLE;

        if (this.isSingle) {
          this.positions = [params.position];
        } else {
          this.positions = params.positions;
        }

        const isAlreadyLoaded = this.positions.every(p => p.loaded());

        this.allBranches = ko.observable(isAlreadyLoaded);
        this.loadingBranches = ko.observable(false);
        this.allBranches.subscribe(value => {
          if (value) {
            this.loadingBranches(true)
            this.loadBranches(() => {
              this.loadingBranches(false);
            });
          } else {
            this.restoreEmployeesList();
          }
        });

        this.restoreEmployeesList = () => {
          this.positions.forEach(p => {
            p.loaded(false);
            const oldEmployeesList = p.employees().filter(e => !e.loaded)
            p.employees(oldEmployeesList)
          })
        };

        this.loadBranches = (cb) => {
          if (this.isSingle) {
            const position = this.positions[0];
            position.loaded(true);
            console.log('Сделать запрос, категория', position.name);
            // Данные
            const employeesList = [
              { name: 'Рабочий #1', id: position.name + '1' },
              { name: 'Рабочий #2', id: position.name + '2' },
              { name: 'Рабочий #3', id: position.name + '3' }
            ];

            // Добавить новых работников
            employeesList.forEach(e => {
              position.employees.push(NewEmployeeModel(e))
            });
          } else {
            const positionsList = this.positions.map(p => p.name)
            // Добавить новых работников в каждую категию
            updatedEmployees = this.positions.forEach(p => {
              p.loaded(true);
              const employeesList = [
                { name: 'Рабочий #1', id: p.name + '1' },
                { name: 'Рабочий #2', id: p.name + '2' },
                { name: 'Рабочий #3', id: p.name + '3' }
              ];
              employeesList.forEach(e => {
                p.employees.push(NewEmployeeModel(e))
              });
            })
          }

          setTimeout(cb, 3000)
        }
      },
      template: {
        element: 'add-employees-position-tab-template'
      }
    })

    ko.components.register('add-employees-modal-dialog', {
      viewModel: {
        createViewModel: function (params, componentInfo) {
          const $element = $(componentInfo.element);
          $element.addClass([
            'modal-dialog',
            'modal-dialog-centered',
            'hrm-modal-dialog',
            'hrm-basic-modal-dialog',
            'hrm-modal-dialog--size_large',
            'modal-dialog--add-employees'
          ]);


          const ViewModel = function () {
            this.isSubmitted = ko.observable(false);

            this.formControlErrorStateMatcher = (formControl) => {
              return ko.pureComputed(() => {
                return this.isSubmitted() && !formControl.isValid();
              });
            };

            this.mode = params.data.mode || ('position' in params.data ? modes.SINGLE : modes.TABS);

            this.positions = this.mode === modes.SINGLE
              ? [PositionModel(params.data.position)]
              : params.data.positions.map(PositionModel);

            this.term = ko.observable('');
            const termUpdateHandler = (value) => {
              console.log('upate', value)
              const formattedValue = value.toLowerCase();
              this.positions.forEach(p => {
                let hasVisibleEmployees = 0;
                p.employees().forEach(e => {
                  let isVisible = true;
                  if (formattedValue.length >= 1) {
                    const name = e.name.toLowerCase();
                    isVisible = name.indexOf(formattedValue) !== -1;
                  }
                  e.visible(isVisible);
                  if (isVisible) hasVisibleEmployees++;
                });
                p.hasVisibleEmployees(hasVisibleEmployees);
              })
            }
            this.term.subscribe(value => {
              termUpdateHandler(value);
            });

            this.tabs = null;
            this.activePosition = null;
            this.list = null;
            this.title = 'Добавить сотрудников';

            if (this.mode === modes.SINGLE) {
              this.activePosition = ko.observable(this.positions[0]);
              this.title = this.activePosition().name;
            } else if (this.mode === modes.LIST) {
              this.list = this.positions;
              this.title = 'Прочие';
            } else {
              this.list = this.positions.filter(position => !position.visible);
              const visiblePositions = this.positions.filter(position => position.visible);
              this.tabs = (() => {
                const tabs = visiblePositions.map(position => new HrmTabGroupItem(position.name));
                if (this.list.length) tabs.push(new HrmTabGroupItem('Прочие'));
                return tabs;
              })();
              this.activeTab = ko.observable(0);
              this.activePosition = ko.pureComputed(() => {
                return visiblePositions[this.activeTab()];
              });
              this.activeTab(0);
            }

            console.log('modal', ko.toJS(this.positions))

            this.cancel = function () {
              if ('cancel' in params) {
                params.cancel();
              }
            };

            this.submit = function () {
              this.isSubmitted(true);
              if ('submit' in params) {
                params.submit(this.positions.map(p => p.getData()));
              }
            };
          }

          return new ViewModel();
        }
      },
      template: {
        element: document.getElementById('add-employees-modal-dialog-template')
      }
    });
  });
</script>

<template id="stimulation-modal-dialog-template">

  <button class="hrm-button hrm-basic-modal-dialog__close-button"
          data-bind="click: function() { cancel(); }"
          aria-label="Close">
  </button>

  <div class="hrm-basic-modal-dialog__header">
    <h2 class="hrm-basic-modal-dialog__title">
      Выписать штраф/премию смене
    </h2>
  </div>

  <div class="hrm-basic-modal-dialog__body stimulation-settings"
       data-bind="using: formModel">
    <div class="stimulation-settings__row">
      <!-- Category select -->
      <!-- ko let: {control: ko.observable(null), label: ko.observable(null) } -->
      <div class="stimulation-settings__select stimulation-settings__category"
           data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
        <label data-bind="hrmFormFieldLabel: label">
          Категория
        </label>

        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
          <select data-bind="value: category,
                   hrmSelect,
                   hrmSelectPlaceholder: 'Все', hrmSelectAllowClear: true,
                   hrmFormFieldSelectControl: control">
            <option></option>
            <option value="production">Производство</option>
            <option value="delivery">Доставка</option>
          </select>
        </div>
      </div>
      <!-- /ko -->
      <!-- /Category select -->


      <!-- Type toggler -->
      <div class="hrm-radio-group stimulation-settings__type">
        <div class="hrm-radio-group__radio hrm-radio-group__radio--theme_negative">
          <input class="hrm-radio-group__radio-input"
                 data-bind="checked: stimulationType"
                 type="radio"
                 value="fine"
                 id="fine-radio" />
          <label class="hrm-radio-group__radio-label"
                 for="fine-radio">
            Штраф
          </label>
        </div>

        <div class="hrm-radio-group__radio hrm-radio-group__radio--theme_positive">
          <input class="hrm-radio-group__radio-input"
                 data-bind="checked: stimulationType"
                 type="radio"
                 value="bonus"
                 id="bonus-radio" />
          <label class="hrm-radio-group__radio-label"
                 for="bonus-radio">
            Премия
          </label>
        </div>
      </div>
      <!-- /Type toggler -->
    </div>


    <div class="stimulation-settings__row">
      <!-- Base select -->

      <!-- ko if: stimulationType() === 'fine' -->
      <!-- ko let: {control: ko.observable(null), label: ko.observable(null) } -->
      <div class="stimulation-settings__select stimulation-settings__base"
           data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
        <label data-bind="hrmFormFieldLabel: label">
          Основание штрафа
        </label>

        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
          <select data-bind="value: base,
              hrmSelect,
              hrmSelectSearchEnabled: true,
              hrmSelectPlaceholder: 'Не выбрано', hrmSelectAllowClear: true,
              hrmFormFieldSelectControl: control,
              hrmFormFieldSelectControlErrorStateMatcher: $component.formControlErrorStateMatcher.bind($component)">

            <option></option>
            <!-- ko foreach: $component.fines -->
            <optgroup data-bind="attr: { label: name }">
              <!-- ko foreach: items -->
              <option data-bind="value: id, text: name"></option>
              <!-- /ko -->
            </optgroup>
            <!-- /ko -->
          </select>
        </div>

        <div data-bind="component: {name: 'hrm-form-field-error'},
            hrmSlide,
            hrmSlideValue: control() !== null ? control().errorState : false,
            hrmSlideDuration: 150">
          <!-- ko text: $parent.base.error() -->
          <!-- /ko -->
        </div>
      </div>
      <!-- /ko -->
      <!-- /ko -->


      <!-- ko ifnot: stimulationType() === 'fine' -->
      <!-- ko let: {control: ko.observable(null), label: ko.observable(null) } -->
      <div class="stimulation-settings__select stimulation-settings__base"
           data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
        <label data-bind="hrmFormFieldLabel: label">
          Основание премии
        </label>

        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
          <select data-bind="value: base,
              hrmSelect,
              hrmSelectSearchEnabled: true,
              hrmSelectPlaceholder: 'Не выбрано', hrmSelectAllowClear: true,
              hrmFormFieldSelectControl: control,
              hrmFormFieldSelectControlErrorStateMatcher: $component.formControlErrorStateMatcher.bind($component)">

            <option></option>
            <!-- ko foreach: $component.bonuses -->
            <optgroup data-bind="attr: { label: name }">
              <!-- ko foreach: items -->
              <option data-bind="value: id, text: name"></option>
              <!-- /ko -->
            </optgroup>
            <!-- /ko -->
          </select>
        </div>

        <div data-bind="component: {name: 'hrm-form-field-error'},
            hrmSlide,
            hrmSlideValue: control() !== null ? control().errorState : false,
            hrmSlideDuration: 150">
          <!-- ko text: $parent.base.error() -->
          <!-- /ko -->
        </div>
      </div>
      <!-- /ko -->
      <!-- /ko -->
      <!-- /Base select -->


    </div>

    <div class="stimulation-settings__row">
      <!-- Author select -->
      <!-- ko let: {control: ko.observable(null), label: ko.observable(null) } -->
      <div class="stimulation-settings__select stimulation-settings__author"
           data-bind="hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label">
        <label data-bind="hrmFormFieldLabel: label">
          <!-- ko text: stimulationType() === 'fine' ? 'Автор штрафа' : 'Автор премии' -->
          <!-- /ko -->
        </label>

        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
          <select data-bind="value: author,
            hrmSelect,
            hrmSelectSearchEnabled: true,
            hrmSelectPlaceholder: 'Не выбран', hrmSelectAllowClear: true,
            hrmFormFieldSelectControl: control,
            hrmFormFieldSelectControlErrorStateMatcher: $component.formControlErrorStateMatcher.bind($component)">
            <option></option>
            <!-- ko foreach: $component.authors -->
            <option data-bind="value: id, text: name"></option>
            <!-- /ko -->
          </select>
        </div>

        <div data-bind="component: {name: 'hrm-form-field-error'},
        hrmSlide,
        hrmSlideValue: control() !== null ? control().errorState : false,
        hrmSlideDuration: 150">
          <!-- ko text: $parent.author.error() -->
          <!-- /ko -->
        </div>
      </div>
      <!-- /ko -->
      <!-- /Author select -->

      <!-- Sum field -->
      <!-- ko let: {control: ko.observable(null), label: ko.observable(null)} -->
      <div class="stimulation-settings__sum"
           data-bind="
           hrmFormField, hrmFormFieldControlRef: control, hrmFormFieldLabelRef: label
       ">
        <label data-bind="hrmFormFieldLabel: label">Сумма, ₽</label>

        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control">
          <input data-bind="
                   attr: {readonly: stimulationType() === 'fine'},
                   textInput: sum,
                   hrmFormFieldInputControl: control,
                   hrmFormFieldInputControlErrorStateMatcher: $component.formControlErrorStateMatcher.bind($component)
               "
                 type="number">
        </div>

        <div data-bind="
               component: {name: 'hrm-form-field-error'},
               hrmSlide,
               hrmSlideValue: control() !== null ? control().errorState : false,
               hrmSlideDuration: 150
           ">
          <!-- ko text: $parent.sum.error() -->
          <!-- /ko -->
        </div>
      </div>
      <!-- /ko -->
      <!-- /Sum field -->
    </div>

    <div class="stimulation-settings__row">
      <!-- Comment field -->
      <!-- ko let: {control: ko.observable(null)} -->
      <div class="stimulation-settings__comment"
           data-bind="
           hrmFormField, hrmFormFieldControlRef: control
       ">

        <div data-bind="hrmFormFieldBasis, hrmFormFieldBasisControl: control, hrmFormFieldBasisAllowClear">
          <textarea data-bind="
                   textInput: comment,
                   hrmFormFieldInputControl: control,
                   hrmAutoResize
               "
                    placeholder="Комментарий"></textarea>
        </div>

      </div>
      <!-- /ko -->
      <!-- /Comment field -->
    </div>


  </div>

  <div class="hrm-basic-modal-dialog__action-list">
    <button class="hrm-button hrm-basic-button hrm-basic-modal-dialog__action-list-item
         position-page__speciality-modal-dialog-cancel-button"
            data-bind="click: function() {cancel();}">
      Отменить
    </button>

    <button class="hrm-button hrm-basic-button hrm-accent-button hrm-basic-modal-dialog__action-list-item
         position-page__speciality-modal-dialog-submit-button"
            data-bind="click: function() {submit();}">
      Сохранить
    </button>
  </div>

</template>


<script type="text/javascript">
  $(function () {
    ko.components.register('stimulation-modal-dialog', {
      viewModel: {
        createViewModel: function (params, componentInfo) {
          const $element = $(componentInfo.element);

          $element.addClass([
            'modal-dialog',
            'modal-dialog-centered',
            'hrm-modal-dialog',
            'hrm-basic-modal-dialog',
            'hrm-modal-dialog--size_large',
            'modal-dialog--stimulation'
          ]);

          const ViewModel = function () {
            this.isSubmitted = ko.observable(false);

            this.fines = params.data.fines;
            this.bonuses = params.data.bonuses;
            this.authors = params.data.authors;

            this.formControlErrorStateMatcher = (formControl) => {
              return ko.pureComputed(() => {
                return this.isSubmitted() && !formControl.isValid();
              });
            };

            /* fine/bonus */
            this.stimulationTypes = {
              "FINE": 'fine',
              "BONUS": 'bonus'
            }

            this.formModel = {
              category: ko.observable(params.data.category),
              stimulationType: ko.observable(this.stimulationTypes.FINE),
              base: ko.observable('').extend({
                required: {
                  message: 'Обязательное поле'
                }
              }),
              author: ko.observable('').extend({
                required: {
                  message: 'Обязательное поле'
                }
              }),
              sum: ko.observable(0).extend({
                required: {
                  message: 'Обязательное поле'
                },
                number: {
                  message: 'Некорректный формат'
                }
              }),
              comment: ko.observable('').extend({

              }),
            };

            this.reset = function () {
              this.formModel.base('');
              this.formModel.sum('');
              this.formModel.author('');
              this.formModel.comment('');
            }

            this.formModel.stimulationType.subscribe(() => {
              this.reset();
            });

            const getFineById = (fineId) => {
              for (let i in this.fines) {
                const items = this.fines[i].items;
                for (let k in items) {
                  const fine = items[k];
                  if (fine.id == fineId) return fine;
                }
              }
            };

            this.formModel.base.subscribe((value) => {
              if (this.formModel.stimulationType() !== this.stimulationTypes.FINE) return;
              if (!value) this.formModel.sum(0);
              const fine = getFineById(value);
              this.formModel.sum(fine ? fine.sum : 0);
            });

            this.validationObject = ko.validatedObservable({
              base: this.formModel.base,
              author: this.formModel.author,
              sum: this.formModel.sum,
            });

            this.cancel = function () {
              if ('cancel' in params) {
                params.cancel();
              }
            };

            this.submit = function () {
              this.isSubmitted(true);

              if (this.validationObject.isValid()) {
                if ('submit' in params) {

                  params.submit({
                    category: this.formModel.category(),
                    stimulationType: this.formModel.stimulationType(),
                    base: this.formModel.base(),
                    author: this.formModel.author(),
                    comment: this.formModel.comment(),
                    sum: parseFloat(this.formModel.sum()),
                  });
                }
              }

            };
          }

          return new ViewModel();
        }
      },
      template: {
        element: document.getElementById('stimulation-modal-dialog-template')
      }
    });
  });
</script>


</body>

</html>
