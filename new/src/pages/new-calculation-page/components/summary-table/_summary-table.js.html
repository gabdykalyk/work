@@include('./_summary-position-row.html')
@@include('./_summary-drivers-row.html')
@@include('./_summary-total-row.html')
@@include('./_summary-table.html')

<script type="text/javascript">
  $(function () {
    function Column(id, title, fullTitle, colspan) {
      return {
        id,
        title,
        fullTitle,
        colspan
      }
    }

    ko.components.register('calculation-page-summary-table', {
      viewModel: {
        /**
        * @param {ObservableArray} params.positions
        */
        createViewModel: function (params, componentInfo) {
          const model = params.model;
          const positions = model.positions;

          const visiblePositions = ko.pureComputed(() => {
            return positions().filter(p => p.visible());
          });

          const driversData = model.driversData();

          const total = {
            workload: ko.observable(0),
            workloadUnits: ko.observable(''),
            fotCategory: ko.observable(100),
            fotRevenue: ko.observable(100),
            performanceStandart: ko.observable(-100),
            lateness: {
              light: ko.observable(0),
              medium: ko.observable(0),
              hard: ko.observable(0),
              total: ko.observable(0),
            },
            employees: ko.observable(0)
          };

          const columns = [
            Column('job', 'Должность', 'Должность'),
            Column('workload-type', 'Тип нагрузки', 'Тип нагрузки'),
            Column('workload', 'Нагрузка', 'Нагрузка', 2),
            Column('additional-workload', 'Доп. нагрузка', 'Дополнительная нагрузка'),
            Column('count', 'Сотр.', 'Сотрудники'),
            Column('fot-category', 'ФОТ, % в категории', 'ФОТ, % в категории'),
            Column('fot-revenue', 'ФОТ, % от выручки', 'ФОТ, % от выручки'),
            Column('performance-standart', 'Норм. выр-ки, %', 'Норма выработки, %'),
            Column('lateness', 'Опоздания', 'Опоздания'),
          ];

          return {
            positions,
            total,
            columns,
            driversData
          };
        }
      },
      template: {
        element: document.getElementById('calculation-page-summary-table-template')
      }
    });
  })
</script>
