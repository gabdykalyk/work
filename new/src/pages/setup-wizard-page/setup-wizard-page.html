<!DOCTYPE html>
<html class="hrm-page setup-wizard-page hrm-page--initializing"
      data-bind="childrenComplete: childrenComplete" lang="ru">
<head>
    @@include('../../base/_page-head-content.html')
</head>

<body>
    <div class="hrm-scaffold">
        <div class="hrm-scaffold__content setup-wizard-page__content">
            <div class="hrm-stepper setup-wizard-page__stepper"
                 data-bind="css: {'hrm-stepper--dense': viewportSize().width <= HRM_BREAKPOINTS.mobileMaxWidth}">
                <!-- ko let: {step: 1} -->
                    <div class="hrm-stepper__step" data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                        <div class="hrm-stepper__step-content"
                             data-bind="click: function () {if(maxAvailableStep() >= step) {activeStep(step);}}">
                            <span class="hrm-stepper__step-label">Тип предприятия</span>
                            <div class="hrm-stepper__step-index-number" data-bind="text: step"></div>
                        </div>
                    </div>
                <!-- /ko -->

                <!-- ko let: {step: 2} -->
                    <div class="hrm-stepper__step" data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                        <div class="hrm-stepper__step-content"
                             data-bind="click: function () {if(maxAvailableStep() >= step) {activeStep(step);}}">
                            <span class="hrm-stepper__step-label">Категории</span>
                            <div class="hrm-stepper__step-index-number" data-bind="text: step"></div>
                        </div>
                    </div>
                <!-- /ko -->

                <!-- ko let: {step: 3} -->
                    <div class="hrm-stepper__step" data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                        <div class="hrm-stepper__step-content"
                             data-bind="click: function () {if(maxAvailableStep() >= step) {activeStep(step);}}">
                            <span class="hrm-stepper__step-label">График работы</span>
                            <div class="hrm-stepper__step-index-number" data-bind="text: step"></div>
                        </div>
                    </div>
                <!-- /ko -->

                <!-- ko let: {step: 4} -->
                    <div class="hrm-stepper__step" data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                        <div class="hrm-stepper__step-content"
                             data-bind="click: function () {if(maxAvailableStep() >= step) {activeStep(step);}}">
                            <span class="hrm-stepper__step-label">Оборот и нагрузка</span>
                            <div class="hrm-stepper__step-index-number" data-bind="text: step"></div>
                        </div>
                    </div>
                <!-- /ko -->

                <!-- ko let: {step: 5} -->
                    <div class="hrm-stepper__step" data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                        <div class="hrm-stepper__step-content"
                             data-bind="click: function () {if(maxAvailableStep() >= step) {activeStep(step);}}">
                            <span class="hrm-stepper__step-label">Должности</span>
                            <div class="hrm-stepper__step-index-number" data-bind="text: step"></div>
                        </div>
                    </div>
                <!-- /ko -->

                <!-- ko let: {step: 6} -->
                    <div class="hrm-stepper__step" data-bind="css: {'hrm-stepper__step--active': activeStep() === step}">
                        <div class="hrm-stepper__step-content"
                             data-bind="click: function () {if(maxAvailableStep() >= step) {activeStep(step);}}">
                            <span class="hrm-stepper__step-label">Тип нагрузки</span>
                            <div class="hrm-stepper__step-index-number" data-bind="text: step"></div>
                        </div>
                    </div>
                <!-- /ko -->
            </div>

            <div class="setup-wizard-page__tab-container">
                <div class="setup-wizard-page__tab-pane setup-wizard-page__company-type-tab-pane"
                     data-bind="
                        hrmFade,
                        hrmFadeValue: activeStep() === 1,
                        hrmFadeDuration: 100,
                        hrmFadeInDelay: 100
                     "
                >
                    <div class="setup-wizard-page__company-type-selector">
                        <div class="setup-wizard-page__company-type-selector-option setup-wizard-page__company-type-selector-option--value_retail"
                             data-bind="click: function () {selectCompanyType(0);}">
                            <div class="setup-wizard-page__company-type-selector-option-icon"></div>

                            <span class="setup-wizard-page__company-type-selector-option-label">
                                Розничная торговля
                            </span>
                        </div>

                        <div class="setup-wizard-page__company-type-selector-option setup-wizard-page__company-type-selector-option--value_foodservice"
                             data-bind="click: function () {selectCompanyType(1);}">
                            <div class="setup-wizard-page__company-type-selector-option-icon"></div>

                            <span class="setup-wizard-page__company-type-selector-option-label">
                                Общепит / Рестораны
                            </span>
                        </div>
                    </div>
                </div>
                <div class="setup-wizard-page__tab-pane setup-wizard-page__dish-category-tab-pane"
                     data-bind="
                        hrmFade,
                        hrmFadeValue: activeStep() === 2,
                        hrmFadeDuration: 100,
                        hrmFadeInDelay: 100
                     "
                >
                    <div class="setup-wizard-page__dish-category-selector" data-bind="using: dishCategoriesStepFormModel">
                        <span class="setup-wizard-page__dish-category-selector-title">Выберите категории блюд</span>

                        <div class="setup-wizard-page__dish-category-selector-list">
                            <!-- ko foreach: {
                                data: categories,
                                beforeRemove: hrmSlideBeforeRemoveFactory(),
                                afterAdd: hrmSlideAfterAddFactory()
                            } -->
                                <div class="setup-wizard-page__dish-category-selector-item">
                                    <div class="setup-wizard-page__dish-category-selector-item-content">
                                        <!-- ko let: {formField: ko.observable(null)} -->
                                            <div class="setup-wizard-page__dish-category-selector-item-field" data-bind="
                                                component: {
                                                    name: 'hrm-form-field',
                                                    params: {
                                                        hasError: $root.dishCategoriesStepFormControlErrorStateMatcher(value),
                                                        exportAs: formField
                                                    }
                                                }
                                            ">
                                                <hrm-slot name="label">
                                                    <label data-bind="hrmFormFieldLabel, hrmFormFieldLabelOwner: formField">
                                                        Категория
                                                    </label>
                                                </hrm-slot>

                                                <select data-bind="
                                                    value: $parent.value,
                                                    hrmSelect,
                                                    hrmFormFieldSelectControl,
                                                    hrmFormFieldSelectControlOwner: formField
                                                ">
                                                    <option></option>
                                                    <option value="1">Пицца</option>
                                                    <option value="2">Роллы</option>
                                                    <option value="3">Супы</option>
                                                    <option value="4">Салаты</option>
                                                    <option value="5">Закуски</option>
                                                    <option value="6">Десерты</option>
                                                    <option value="7">Напитки</option>
                                                </select>

                                                <hrm-slot name="error">
                                                    <div data-bind="
                                                        component: {name: 'hrm-form-field-error'},
                                                        hrmSlide,
                                                        hrmSlideValue: $root.dishCategoriesStepFormControlErrorStateMatcher($parent.value),
                                                        hrmSlideDuration: 150
                                                    ">
                                                        <!-- ko text: $parents[1].value.error() --><!-- /ko -->
                                                    </div>
                                                </hrm-slot>
                                            </div>

                                            <!-- ko if: $parent.categories().length > 1 -->
                                                <button class="hrm-button setup-wizard-page__dish-category-selector-item-remove-button"
                                                        title="Удалить"
                                                        data-bind="click: function () {$root.dishCategoriesStepRemove($index());}">
                                                </button>
                                            <!-- /ko -->
                                        <!-- /ko -->
                                    </div>
                                </div>
                            <!-- /ko -->
                        </div>

                        <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_neutral
                                    hrm-button-with-plus-icon setup-wizard-page__dish-category-selector-add-button"
                             data-bind="click: function () {$root.dishCategoriesStepAdd();}">
                            Добавить
                        </button>
                    </div>

                    <div class="setup-wizard-page__tab-pane-actions">
                        <button class="hrm-button setup-wizard-page__tab-pane-actions-button
                                       setup-wizard-page__tab-pane-actions-back-button"
                                data-bind="click: back">
                            Назад
                        </button>
                        <button class="hrm-button setup-wizard-page__tab-pane-actions-button
                                       setup-wizard-page__tab-pane-actions-forward-button"
                                data-bind="
                                    click: submitDishCategoriesStep,
                                    attr: {disabled: $root.isDishCategoriesStepSubmitted() && !$root.dishCategoriesStepFormModel.isValid()}
                                "
                        >
                            Далее
                        </button>
                    </div>
                </div>
                <div class="setup-wizard-page__tab-pane setup-wizard-page__schedule-tab-pane"
                     data-bind="
                        hrmFade,
                        hrmFadeValue: activeStep() === 3,
                        hrmFadeDuration: 100,
                        hrmFadeInDelay: 100
                     "
                >
                    <!-- ko let: {calendar: ko.observable(null)} -->
                        <div class="setup-wizard-page__schedule-selector" data-bind="using: scheduleStepFormModel">
                            <span class="setup-wizard-page__schedule-selector-title">График работы предприятия</span>

                            <div class="setup-wizard-page__schedule-selector-controls">
                                <div class="setup-wizard-page__schedule-selector-interval-selector">
                                    <span class="setup-wizard-page__schedule-selector-interval-selector-label">
                                        Задать интервал таблицы
                                    </span>

                                    <div class="setup-wizard-page__schedule-selector-interval-selector-control">
                                        <!-- ko let: {formField: ko.observable(null)} -->
                                            <div class="setup-wizard-page__schedule-selector-interval-selector-control-field
                                                        setup-wizard-page__schedule-selector-interval-selector-control-start-field"
                                                 data-bind="component: {
                                                    name: 'hrm-form-field',
                                                    params: {
                                                        noLabel: true,
                                                        exportAs: formField,
                                                        hasError: $root.scheduleStepIntervalBoundaryFormControlErrorStateMatcher(intervalStart)
                                                    }
                                                 }"
                                            >
                                                <input data-bind="
                                                    value: $parent.intervalStart,
                                                    hrmTimeAutocompleter,
                                                    hrmMask,
                                                    hrmMaskPattern: 'datetime',
                                                    hrmMaskOptions: {
                                                        inputFormat: 'HH:MM',
                                                        placeholder: ' '
                                                    },
                                                    hrmFormFieldInputControl,
                                                    hrmFormFieldInputControlOwner: formField
                                                " placeholder="00:00">
                                            </div>
                                        <!-- /ko -->

                                        <span class="setup-wizard-page__schedule-selector-interval-selector-control-separator">—</span>

                                        <!-- ko let: {formField: ko.observable(null)} -->
                                            <div class="setup-wizard-page__schedule-selector-interval-selector-control-field
                                                            setup-wizard-page__schedule-selector-interval-selector-control-end-field"
                                                 data-bind="component: {
                                                    name: 'hrm-form-field',
                                                    params: {
                                                        noLabel: true,
                                                        exportAs: formField,
                                                        hasError: $root.scheduleStepIntervalBoundaryFormControlErrorStateMatcher(intervalEnd)
                                                    }
                                                 }"
                                            >
                                                <input data-bind="
                                                    value: $parent.intervalEnd,
                                                    hrmTimeAutocompleter,
                                                    hrmMask,
                                                    hrmMaskPattern: 'datetime',
                                                    hrmMaskOptions: {
                                                        inputFormat: 'HH:MM',
                                                        placeholder: ' '
                                                    },
                                                    hrmFormFieldInputControl,
                                                    hrmFormFieldInputControlOwner: formField
                                                " placeholder="00:00">
                                            </div>
                                        <!-- /ko -->
                                    </div>
                                </div>

                                <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_positive
                                               hrm-button-with-check-icon setup-wizard-page__schedule-selector-pick-all-button"
                                        data-bind="click: function() {calendar().pickAll();}">
                                    Заполнить автоматически
                                </button>
                            </div>

                            <div data-bind="component: {
                                name: 'setup-wizard-page-schedule-selector-calendar',
                                params: {
                                    value: schedule,
                                    intervalStart: $root.scheduleStepUsedIntervalStart,
                                    intervalEnd: $root.scheduleStepUsedIntervalEnd,
                                    exportAs: calendar
                                }
                            }">
                            </div>

                            <div class="setup-wizard-page__schedule-selector-actions">
                                <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_negative
                                            hrm-button-with-times-icon setup-wizard-page__schedule-selector-action"
                                     data-bind="click: function() {calendar().clear();}">
                                    Очистить
                                </button>
                            </div>
                        </div>
                    <!-- /ko -->

                    <div class="setup-wizard-page__tab-pane-actions">
                        <button class="hrm-button setup-wizard-page__tab-pane-actions-button
                                       setup-wizard-page__tab-pane-actions-back-button"
                                data-bind="click: back">
                            Назад
                        </button>
                        <button class="hrm-button setup-wizard-page__tab-pane-actions-button
                                       setup-wizard-page__tab-pane-actions-forward-button"
                                data-bind="
                                    click: submitScheduleStep,
                                    attr: {
                                        disabled: !$root.scheduleStepFormModel.isValid()
                                    }
                                "
                        >
                            Далее
                        </button>
                    </div>
                </div>
                <div class="setup-wizard-page__tab-pane setup-wizard-page__turnover-tab-pane"
                     data-bind="
                        hrmFade,
                        hrmFadeValue: activeStep() === 4,
                        hrmFadeDuration: 100,
                        hrmFadeInDelay: 100
                     "
                >
                    <div class="setup-wizard-page__turnover-selector" data-bind="using: turnoverStepFormModel">
                        <span class="setup-wizard-page__turnover-selector-title">Оборот предприятия</span>

                        <span class="setup-wizard-page__turnover-selector-description">
                            Заполните поля хотя бы для одной категории
                        </span>

                        <!-- ko if: $root.viewportSize().width > HRM_BREAKPOINTS.mobileMaxWidth -->
                            <table class="setup-wizard-page__turnover-selector-table" data-bind="hrmTable">
                            <thead>
                                <tr>
                                    <th>Единица измерения</th>
                                    <th>Пн</th>
                                    <th>Вт</th>
                                    <th>Ср</th>
                                    <th>Чт</th>
                                    <th>Пт</th>
                                    <th>Сб</th>
                                    <th>Вс</th>
                                    <th>За неделю</th>
                                </tr>
                            </thead>

                            <tbody data-bind="foreach: categories">
                                <tr>
                                    <td class="setup-wizard-page__turnover-selector-table-category-name-cell"
                                        data-bind="text: name" colspan="9">
                                    </td>
                                </tr>

                                <tr class="setup-wizard-page__turnover-selector-table-data-row">
                                    <!-- ko let: {editableCell: ko.observable(null)} -->
                                        <td class="setup-wizard-page__turnover-selector-table-units-cell"
                                            data-bind="
                                                hrmTableEditableCell: editableCell
                                            "
                                        >
                                            <select data-bind="
                                                value: units,
                                                hrmSelect,
                                                hrmTableEditableCellSelectControl,
                                                hrmTableEditableCellSelectControlOwner: editableCell
                                            ">
                                                <option value="1">Штуки</option>
                                                <option value="2">Рубли</option>
                                                <option value="3">Норма времени</option>
                                            </select>
                                        </td>
                                    <!-- /ko -->
                                    <!-- ko foreach: {data: [1, 2, 3, 4, 5, 6, 7], as: 'weekday'} -->
                                        <!-- ko let: {editableCell: ko.observable(null)} -->
                                            <td class="setup-wizard-page__turnover-selector-table-weekday-cell"
                                                data-bind="
                                                    hrmTableEditableCell: editableCell,
                                                    hrmTableEditableCellError: weekday === 1 ? $root.turnoverStepTableCategoryErrorExtractor($index()) : null
                                                ">
                                                <input data-bind="
                                                    textInput: $parent.week[weekday - 1],
                                                    event: {
                                                        input: function() {
                                                            $root.onTurnoverStepCategoryWeekdayChange($parentContext.$index());
                                                        }
                                                    },
                                                    hrmMask, hrmMaskPattern: 'decimal',
                                                    hrmTableEditableCellInputControl,
                                                    hrmTableEditableCellInputControlOwner: editableCell
                                                " placeholder="0">
                                            </td>
                                        <!-- /ko -->
                                    <!-- /ko -->

                                    <!-- ko let: {editableCell: ko.observable(null)} -->
                                        <td class="setup-wizard-page__turnover-selector-table-week-total-cell"
                                            data-bind="hrmTableEditableCell: editableCell">
                                            <input data-bind="
                                                value: $root.getTurnoverStepWeekTotal($index()),
                                                event: {
                                                    change: function (_, event) {
                                                        $root.turnoverStepDistributeWeekTotal($index(), event.target.value);
                                                    }
                                                },
                                                hrmMask, hrmMaskPattern: 'decimal',
                                                hrmTableEditableCellInputControl,
                                                hrmTableEditableCellInputControlOwner: editableCell
                                            " placeholder="0">
                                        </td>
                                    <!-- /ko -->
                                </tr>
                            </tbody>
                        </table>
                        <!-- /ko -->

                        <!-- ko if: $root.viewportSize().width <= HRM_BREAKPOINTS.mobileMaxWidth -->
                            <div class="setup-wizard-page__turnover-selector-table">
                                <!-- ko foreach: categories -->
                                    <div class="setup-wizard-page__turnover-selector-table-category-section">
                                        <div class="setup-wizard-page__turnover-selector-table-category-section-header">
                                            <span class="setup-wizard-page__turnover-selector-table-category-section-header-title"
                                                  data-bind="text: name">
                                            </span>

                                            <!-- ko let: {formField: ko.observable(null)} -->
                                                <div class="setup-wizard-page__turnover-selector-table-category-section-header-units-field" data-bind="
                                                    component: {
                                                        name: 'hrm-form-field',
                                                        params: {
                                                            noLabel: true,
                                                            exportAs: formField
                                                        }
                                                    }
                                                 ">
                                                    <select data-bind="
                                                        value: $parent.units,
                                                        hrmSelect,
                                                        hrmFormFieldSelectControl,
                                                        hrmFormFieldSelectControlOwner: formField
                                                    ">
                                                        <option value="1">Штуки</option>
                                                        <option value="2">Рубли</option>
                                                        <option value="3">Норма времени</option>
                                                    </select>
                                                </div>
                                            <!-- /ko -->
                                        </div>

                                        <div class="hrm-table__fixed-section-container setup-wizard-page__turnover-selector-table-category-section-table-fixed-section-container">
                                            <table class="hrm-table__fixed-section hrm-table__fixed-section--position_left
                                                          setup-wizard-page__turnover-selector-table-category-section-table-fixed-section"
                                                   data-bind="hrmTable">
                                                <thead>
                                                    <tr>
                                                        <th class="setup-wizard-page__turnover-selector-table-category-section-table-week-total-cell">
                                                            За неделю
                                                        </th>
                                                    </tr>
                                                </thead>

                                                <tbody>
                                                    <tr>
                                                        <!-- ko let: {editableCell: ko.observable(null)} -->
                                                            <td class="setup-wizard-page__turnover-selector-table-category-section-table-week-total-cell"
                                                                data-bind="hrmTableEditableCell: editableCell">
                                                                <input data-bind="
                                                                    value: $root.getTurnoverStepWeekTotal($index()),,
                                                                    event: {
                                                                        change: function (_, event) {
                                                                            $root.turnoverStepDistributeWeekTotal($index(), event.target.value);
                                                                        }
                                                                    },
                                                                    hrmMask, hrmMaskPattern: 'decimal',
                                                                    hrmTableEditableCellInputControl,
                                                                    hrmTableEditableCellInputControlOwner: editableCell
                                                                " placeholder="0">
                                                            </td>
                                                        <!-- /ko -->
                                                    </tr>
                                                </tbody>
                                            </table>

                                            <div class="hrm-table__scrollable-wrapper">
                                                <table class="setup-wizard-page__turnover-selector-table-category-section-table"
                                                   data-bind="hrmTable">
                                                <thead>
                                                    <tr>
                                                        <th>Пн</th>
                                                        <th>Вт</th>
                                                        <th>Ср</th>
                                                        <th>Чт</th>
                                                        <th>Пт</th>
                                                        <th>Сб</th>
                                                        <th>Вс</th>
                                                    </tr>
                                                </thead>

                                                <tbody>
                                                    <tr>
                                                        <!-- ko foreach: {data: [1, 2, 3, 4, 5, 6, 7], as: 'weekday'} -->
                                                            <!-- ko let: {editableCell: ko.observable(null)} -->
                                                                <td class="setup-wizard-page__turnover-selector-table-category-section-table-weekday-cell"
                                                                    data-bind="
                                                                        hrmTableEditableCell: editableCell,
                                                                        hrmTableEditableCellError: weekday === 1 ? $root.turnoverStepTableCategoryErrorExtractor($index()) : null
                                                                    "
                                                                >
                                                                    <input data-bind="
                                                                        textInput: $parent.week[weekday - 1],
                                                                        event: {
                                                                            input: function() {
                                                                                $root.onTurnoverStepCategoryWeekdayChange($parentContext.$index());
                                                                            }
                                                                        },
                                                                        hrmMask, hrmMaskPattern: 'decimal',
                                                                        hrmTableEditableCellInputControl,
                                                                        hrmTableEditableCellInputControlOwner: editableCell
                                                                    " placeholder="0">
                                                                </td>
                                                            <!-- /ko -->
                                                        <!-- /ko -->
                                                    </tr>
                                                </tbody>
                                            </table>
                                            </div>
                                        </div>
                                    </div>
                                <!-- /ko -->
                            </div>
                        <!-- /ko -->

                        <div class="setup-wizard-page__turnover-selector-actions">
                            <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_positive
                                            hrm-button-with-check-icon setup-wizard-page__turnover-selector-action"
                                    data-bind="click: function() {$root.fillTurnoverStep();}">
                                Заполнить автоматически
                            </button>

                            <button class="hrm-button hrm-button-with-icon hrm-button-with-icon--theme_negative
                                            hrm-button-with-times-icon setup-wizard-page__turnover-selector-action"
                                    data-bind="click: function() {$root.clearTurnoverStep();}">
                                Очистить
                            </button>
                        </div>
                    </div>

                    <div class="setup-wizard-page__tab-pane-actions">
                        <button class="hrm-button setup-wizard-page__tab-pane-actions-button
                                       setup-wizard-page__tab-pane-actions-back-button"
                                data-bind="click: back">
                            Назад
                        </button>
                        <button class="hrm-button setup-wizard-page__tab-pane-actions-button
                                       setup-wizard-page__tab-pane-actions-forward-button">
                            Рассчитать
                        </button>
                    </div>
                </div>
                <div class="setup-wizard-page__tab-pane" data-bind="hrmFade, hrmFadeValue: activeStep() === 5, hrmFadeDuration: 100, hrmFadeInDelay: 100"></div>
                <div class="setup-wizard-page__tab-pane" data-bind="hrmFade, hrmFadeValue: activeStep() === 6, hrmFadeDuration: 100, hrmFadeInDelay: 100"></div>
            </div>
        </div>

        <div class="hrm-scaffold__footer" data-bind="component: {name: 'hrm-footer'}"></div>
    </div>
    @@include('../../base/_page-scripts.html')
    @@include('./components/schedule-selector-calendar/_schedule-selector-calendar.js.html')
    @@include('./_setup-wizard-page.js.html')
</body>
</html>