<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Создать тип документа</title>
    
    @@include('include/_css.html')

    @@include('include/_ie8.html')
</head>

<body>
    @@include('include/top-nav.html')

    <div class="container-fluid content">
        <h1>
            Создать тип документа
        </h1>
        <hr class="hr-margin hr-xs-100 hidden-xs">
        
        <form class="doctype-form" action="" method="post">
        	<div class="row">
                <div class="col-xs-12 form-group">
					<label for="name">Название</label>
					<input type="text" class="form-control" value="" name="name" id="name">
				</div>
                <div class="col-sm-6 col-xs-12 form-group">
					<label for="post">Должности</label>
					<select class="form-control js-select-multiple js-select-post" name="post[]" id="post" multiple="multiple" tabindex="-1" aria-hidden="true">
						<option></option>
						<option value="1">Администратор филиал</option>
						<option value="2">Директор IT</option>
						<option value="3">Водитель</option>
					</select>
				</div>
                <div class="col-sm-6 col-xs-12 form-group">
					<label for="nationality">Гражданство</label>
					<select class="form-control js-select-multiple js-select-nationality" name="nationality[]" id="nationality" multiple="multiple" tabindex="-1" aria-hidden="true">
						<option value="1">Россия</option>
						<option value="2">Украина</option>
						<option value="3">Белоруссия</option>
					</select>
				</div>
                <div class="col-xs-12 form-group form-group-chbxs">
					<div class="checkbox">
                        <label>
                            <input type="checkbox" id="required-doc"> Обязательный документ
                        </label>
                    </div>
				</div>
			</div>

	        <div class="table-doctype-block">
	            <div class="table-responsive">
                    <table class="table table-hover table-doctype">
                        <thead>
                            <tr>
                                <th class="cell-head">
                                    <div class="cell-head_name">Ответственный</div>
                                </th>
                                <th class="cell-head">
                                    <div class="cell-head_name">Филиал</div>
                                </th>
                                <th class="cell-head">
                                    <div class="cell-head_name">Типы нотификаций</div>
                                </th>
                                <th class="cell-head-btns">
                                    <button type="button" class="btn btn-xs btn-default btn-add-row jsAddNewItem" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td data-label="Ответственный" class="cell-info">
			                        <select class="form-control" name="responsible_1">
			                            <option value="admin_butovo">admin_butovo</option>
			                            <option value="admin_yuzhnaya">admin_yuzhnaya</option>
			                        </select>
                                </td>
                                <td data-label="Филиал" class="cell-info">
	                                <select class="form-control js-select-branch" name="branch[]" multiple="" tabindex="-1" aria-hidden="true">
				                        <option value="1">Щербинка</option>
				                        <option value="2">Бутово</option>
				                        <option value="3">Ясенево</option>
				                        <option value="4">Коммунарка</option>
				                        <option value="5">Подольск</option>
				                        <option value="6">Московский</option>
				                    </select>
                                </td>
                                <td data-label="Типы нотификаций" class="cell-info">
                                	<div class="form-group form-group-chbxs">
										<div class="checkbox">
					                        <label>
					                            <input type="checkbox"> Email
					                        </label>
					                    </div>
										<div class="checkbox">
					                        <label>
					                            <input type="checkbox"> SMS
					                        </label>
					                    </div>
				                	</div>
                                </td>
                                <td class="cell-btn">
                                	<button type="button" class="btn btn-xs btn-danger btn-remove-row jsRemoveItem" title="Удалить"><i class="fa fa-minus" aria-hidden="true"></i></button>
                                    <button type="button" class="btn btn-xs btn-default btn-add-row jsAddNewItem" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
	            </div>
	        </div>
			<div class="form-group form-btns">
				<a href="#" class="btn btn-default" type="button">Вернуться</a>
				<a href="#" class="btn btn-primary" type="button">Сохранить</a>
			</div>
        </form>
    </div>
    <script id="rowTemplate" type="text/template">
        <tr class="added-row" style="display:none;">
            <td data-label="Ответственный" class="cell-info">
                <select class="form-control" name="responsible">
                    <option value="admin_butovo">admin_butovo</option>
                    <option value="admin_yuzhnaya">admin_yuzhnaya</option>
                </select>
            </td>
            <td data-label="Филиал" class="cell-info">
                <select class="form-control js-select-branch" name="branch[]" multiple="" tabindex="-1" aria-hidden="true">
                    <option value="1">Щербинка</option>
                    <option value="2">Бутово</option>
                    <option value="3">Ясенево</option>
                    <option value="4">Коммунарка</option>
                    <option value="5">Подольск</option>
                    <option value="6">Московский</option>
                </select>
            </td>
            <td data-label="Типы нотификаций" class="cell-info">
            	<div class="form-group form-group-chbxs">
					<div class="checkbox">
                        <label>
                            <input type="checkbox"> Email
                        </label>
                    </div>
					<div class="checkbox">
                        <label>
                            <input type="checkbox"> SMS
                        </label>
                    </div>
            	</div>
            </td>
            <td class="cell-btn">
            	<button type="button" class="btn btn-xs btn-danger btn-remove-row jsRemoveItem" title="Удалить"><i class="fa fa-minus" aria-hidden="true"></i></button>
                <button type="button" class="btn btn-xs btn-default btn-add-row jsAddNewItem" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
            </td>
        </tr>
	</script>

    @@include('include/_js.html')

    <script type="text/javascript">
        $(function() {
            initNavbar();

            $('.js-select-multiple').select2({
                width: '100%'
            });

            $('.js-select-post').select2({
                width: '100%',
                placeholder: 'Выберите должности',
            });

            $('.js-select-nationality').select2({
                width: '100%',
                placeholder: 'Выберите гражданство',
            });
            
            $('.js-select-branch').select2({
                width: '100%',
                placeholder: 'Выберите филиал',
            });

            // изменение высоты ячеек в таблице для моб. версии (w < 768px)
            $(window).on('load resize', function() {
                var winWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
                if (winWidth < 768) {
                    changeHeightCellMobile($('.table-fired'));
                } else {
                    var reserHeight = $('.js-cell-mobile');
                    $(reserHeight).removeAttr('style');
                }

            });
            $('.table-fired-block').on('click', '.toogleLoader', function() {
                var winWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
                if (winWidth < 768) {
                    $('.table-fired tfoot').toggle();
                }
            });

            var editDocs = (function() {
                var me = {};
                me.formEditDocs = $('.doctype-form');
                me.init = function() {
                    // для добавления нового item на страницу
                    me.formEditDocs.on('click', '.jsAddNewItem', me.addNewItem);
                    // для удаления item
                    me.formEditDocs.on('click', '.jsRemoveItem', me.removeItem);
                }
                me.addNewItem = function() {
                    var table = $(this).closest('table'),
                        itemTemplate = table.data('itemTemplate') || 'rowTemplate',
                        rowTemplate = $('#' + itemTemplate),
                        tbody = table.find('> tbody'),
                        tr = tbody.find('tr'),
                        addBtn = tr.find('.jsAddNewItem');

                    if (!rowTemplate) return false;

                    rowTemplate = $(rowTemplate.html());

                    rowTemplate.appendTo(tbody);
                    addBtn.hide();
                    var newTr = tbody.find('tr:last-child');
                    newTr.fadeIn(500);
                    $('.js-select-branch').select2({
		                width: '100%',
		                placeholder: 'Выберите филиал',
		            });
                }
                me.removeItem = function() {
                    var tr = $(this).closest('tr'),
                    	trLastChild = $(this).closest('table').find('> tbody > tr:last-child'),
                    	lastTr, addBtn;
                    if (tr.index() == trLastChild.index()) {
                    	var lastTr_index = tr.index() - 1;
			        	lastTr = $(this).closest('table').find('> tbody > tr:eq(' + lastTr_index + ')');
			        } else {
			        	lastTr = trLastChild;
			        }
					addBtn = lastTr.find('.jsAddNewItem');
					
                	addBtn.show();
					tr.fadeOut(500, function() {
			            tr.remove();
			        });
                }
                return me;
            }());

            // если на странице есть нужный селектор, запускать фукнцию editBonuses.init
            document.querySelector('.doctype-form') && editDocs.init();


        });
    </script>

</body>

</html>