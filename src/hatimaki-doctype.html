<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Сотрудники</title>

    @@include('include/_css.html')

    @@include('include/_ie8.html')
</head>
<body>
    <div class="hat-scaffold">
        <div class="hat-scaffold__navbar">
            @@include('include/hat-navbar.html')
        </div>

        <div class="hat-scaffold__body">
            <div class="hat-scaffold__content-wrapper">
                <div class="clearfix head-with-btn">
                    <h1>Создать документ</h1>
                </div>

                <hr>

				<form class="doctype-form" action="" method="post">
					<div class="row">
						<div class="col-md-6 col-sm-12 form-group">
							<label for="name">Название</label>
							<input type="text" class="form-control" value="" name="name" id="name">
						</div>

						<div class="clearfix"></div>

						<div class="col-md-6 col-sm-6 form-group">
							<label for="post">Тип документа</label>
							<select class="form-control js-select-multiple js-select-type" name="" id="" tabindex="-1" aria-hidden="true">
								<option></option>
								<option value="1">Специальные</option>
								<option value="2">Обязательные для всех</option>
							</select>
						</div>

						<div class="col-md-6 col-sm-6 form-group">
							<label for="post">Правовой статус</label>
							<select class="form-control js-select-multiple js-select-status" name="statuses[]" id="" multiple="multiple" tabindex="-1" aria-hidden="true">
								<option></option>
								<option value="1">Резидент РФ</option>
								<option value="2">Беженцы</option>
								<option value="3">Граждане ЕС</option>
							</select>
						</div>

						<div class="col-xs-12 js-conditions-block">
							<h4>Условия применения</h4>

							<div class="js-conditions-row conditions-row">
								<div class="form-group nationality-form-group">
									<label for="nationality">Гражданство</label>

									<div class="nationality-form-control">
										<div class="btn-group" role="group">
											<a href="#" type="button" class="btn btn-default active">Только для</a>
											<a href="#" type="button" class="btn btn-default">Для всех, кроме</a>
										</div>

										<select class="form-control js-select-multiple js-select-nationality" name="nationality[]" id="nationality" multiple="multiple" tabindex="-1" aria-hidden="true">
											<option value="1">Россия</option>
											<option value="2">Украина</option>
											<option value="3">Белоруссия</option>
										</select>
									</div>
								</div>

								<div class="form-group position-form-group">
									<label for="post">Должности</label>
									<select class="form-control js-select-multiple js-select-post" name="post[]" id="post" multiple="multiple" tabindex="-1" aria-hidden="true">
										<option></option>
										<option value="1">Администратор филиал</option>
										<option value="2">Директор IT</option>
										<option value="3">Водитель</option>
									</select>
								</div>

								<div class="form-group conditions-btn-block no-label">
									<button type="button" class="btn btn-danger btn-remove-row jsRemove" title="Удалить" style="display: none;"><i class="fa fa-times" aria-hidden="true"></i></button>
									<button type="button" class="btn btn-success btn-add-row jsAddNew" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
								</div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-xs-12 form-group doctype-form__checkboxes">
							<div class="checkbox-nice">
								<label>
									<input type="checkbox" name="">
									<span class="fa fa-check"></span>
									Документ имеет срок годности
								</label>
							</div>

							<div class="checkbox-nice">
								<label>
									<input type="checkbox" name="">
									<span class="fa fa-check"></span>
									Обязательный документ
								</label>
							</div>
						</div>
					</div>

					<div class="table-section" >
						<div class="table-doctype-block">
							<div class="table-responsive">
								<table class="table table-hover table-doctype">
									<thead>
										<tr>
											<th class="cell-head">
												<div class="cell-head_name">Ответственный</div>
											</th>
											<th class="cell-head">
												<div class="cell-head_name">Филиал</div>
											</th>
											<th class="cell-head">
												<div class="cell-head_name">Типы нотификаций</div>
											</th>
											<th class="cell-head-btns">
												<button type="button" class="btn btn-xs btn-default btn-add-row jsAddNewItem" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
											</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td data-label="Ответственный" class="cell-info">
												<select class="form-control" name="responsible_1">
													<option value="admin_butovo">admin_butovo</option>
													<option value="admin_yuzhnaya">admin_yuzhnaya</option>
												</select>
											</td>
											<td data-label="Филиал" class="cell-info">
												<select class="form-control js-select-branch" name="branch[]" multiple="" tabindex="-1" aria-hidden="true">
													<option value="1">Щербинка</option>
													<option value="2">Бутово</option>
													<option value="3">Ясенево</option>
													<option value="4">Коммунарка</option>
													<option value="5">Подольск</option>
													<option value="6">Московский</option>
												</select>
											</td>
											<td data-label="Типы нотификаций" class="cell-info">
												<div class="form-group form-group-chbxs">
													<div class="checkbox-nice">
														<label>
															<input type="checkbox" name="">
															<span class="fa fa-check"></span>
															Email
														</label>
													</div>

													<div class="checkbox-nice">
														<label>
															<input type="checkbox" name="">
															<span class="fa fa-check"></span>
															SMS
														</label>
													</div>
												</div>
											</td>
											<td class="cell-btn">
												<button type="button" class="btn btn-xs btn-danger btn-remove-row jsRemoveItem" title="Удалить"><i class="fa fa-minus" aria-hidden="true"></i></button>
												<button type="button" class="btn btn-xs btn-default btn-add-row jsAddNewItem" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>

						<div class="form-group form-btns">
							<a href="#" class="btn btn-default" type="button">Вернуться</a>
							<a href="#" class="btn btn-primary" type="button">Сохранить</a>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
    <script id="rowTemplate" type="text/template">
        <tr class="added-row" style="display:none;">
            <td data-label="Ответственный" class="cell-info">
                <select class="form-control" name="responsible">
                    <option value="admin_butovo">admin_butovo</option>
                    <option value="admin_yuzhnaya">admin_yuzhnaya</option>
                </select>
            </td>
            <td data-label="Филиал" class="cell-info">
                <select class="form-control js-select-branch" name="branch[]" multiple="" tabindex="-1" aria-hidden="true">
                    <option value="1">Щербинка</option>
                    <option value="2">Бутово</option>
                    <option value="3">Ясенево</option>
                    <option value="4">Коммунарка</option>
                    <option value="5">Подольск</option>
                    <option value="6">Московский</option>
                </select>
            </td>
            <td data-label="Типы нотификаций" class="cell-info">
            	<div class="form-group form-group-chbxs">
					<div class="checkbox-nice">
						<label>
							<input type="checkbox" name="">
							<span class="fa fa-check"></span>
							Email
						</label>
					</div>

					<div class="checkbox-nice">
						<label>
							<input type="checkbox" name="">
							<span class="fa fa-check"></span>
							SMS
						</label>
					</div>
            	</div>
            </td>
            <td class="cell-btn">
            	<button type="button" class="btn btn-xs btn-danger btn-remove-row jsRemoveItem" title="Удалить"><i class="fa fa-minus" aria-hidden="true"></i></button>
                <button type="button" class="btn btn-xs btn-default btn-add-row jsAddNewItem" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
            </td>
        </tr>
	</script>

	<script id="conditionsRowTemplate" type="text/template">
		<div class="js-conditions-row conditions-row">
			<div class="form-group nationality-form-group">
				<label for="nationality">Гражданство</label>

				<div class="nationality-form-control">
					<div class="btn-group" role="group">
						<a href="#" type="button" class="btn btn-default active">Только для</a>
						<a href="#" type="button" class="btn btn-default">Для всех, кроме</a>
					</div>

					<select class="form-control js-select-multiple js-select-nationality" name="nationality[]" id="nationality" multiple="multiple" tabindex="-1" aria-hidden="true">
						<option value="1">Россия</option>
						<option value="2">Украина</option>
						<option value="3">Белоруссия</option>
					</select>
				</div>
			</div>

			<div class="form-group position-form-group">
				<label for="post">Должности</label>
				<select class="form-control js-select-multiple js-select-post" name="post[]" id="post" multiple="multiple" tabindex="-1" aria-hidden="true">
					<option></option>
					<option value="1">Администратор филиал</option>
					<option value="2">Директор IT</option>
					<option value="3">Водитель</option>
				</select>
			</div>

			<div class="form-group conditions-btn-block no-label">
				<button type="button" class="btn btn-danger btn-remove-row jsRemove" title="Удалить" style="display: none;"><i class="fa fa-times" aria-hidden="true"></i></button>
				<button type="button" class="btn btn-success btn-add-row jsAddNew" title="Добавить"><i class="fa fa-plus" aria-hidden="true"></i></button>
			</div>
		</div>
	</script>

    @@include('include/_js.html')

    <script type="text/javascript">
        $(function() {
            initNavbar();

            $('.js-select-multiple').select2({
                width: '100%'
            });

            $('.js-select-type').select2({
                width: '100%',
                placeholder: 'Выберите тип документа',
				allowClear: true
            });

            $('.js-select-status').select2({
                width: '100%',
                placeholder: 'Выберите правовой статус'
            });

            $('.js-select-branch').select2({
                width: '100%',
                placeholder: 'Выберите филиал',
            });

			$('.js-select-post').select2({
				width: '100%',
				placeholder: 'Выберите должности',
			});

			$('.js-select-nationality').select2({
				width: '100%',
				placeholder: 'Выберите гражданство',
			});

			var editConditions = (function() {
				let me = {};

				me.blockEdit = $('.js-conditions-block');

				me.init = function() {
					me.blockEdit.on('click', '.jsAddNew', me.addNewItem);
					me.blockEdit.on('click', '.jsRemove', me.removeItem);
				};

				me.addNewItem = function() {
					let parent = $(this).closest('.js-conditions-block'),
							rowTemplate = $('#conditionsRowTemplate'),
							row = parent.find('.js-conditions-row'),
							addBtn = row.find('.jsAddNew'),
							allDelBtn, newRow;

					if (!rowTemplate) return false;
					rowTemplate = $(rowTemplate.html());
					rowTemplate.appendTo(parent);
					addBtn.hide();

					allDelBtn = parent.find('.jsRemove');
					allDelBtn.show();
					newRow = parent.find('.js-conditions-row:last-child');
					newRow.hide().fadeIn(500);

					newRow.find('.js-select-post').select2({
						width: '100%',
						placeholder: 'Выберите должности',
					});

					newRow.find('.js-select-nationality').select2({
						width: '100%',
						placeholder: 'Выберите гражданство',
					});
				};

				me.removeItem = function() {
					let parent = $(this).closest('.js-conditions-block'),
							row = $(this).closest('.js-conditions-row'),
							rowLastChild = parent.find('.js-conditions-row:last-child'),
							lastRow, addBtn, delBtn;

					if (row.index() === rowLastChild.index()) {
						lastRow_index = row.index() - 2; // стоит -2, а не -1, т.к. в начале есть блок с заголовком
						lastRow = $(this).closest('.js-conditions-block').find('.js-conditions-row:eq(' + lastRow_index + ')');
					} else {
						lastRow = rowLastChild;
					}

					addBtn = lastRow.find('.jsAddNew');
					addBtn.show();

					row.fadeOut(500, function() {
						row.remove();
					});

					if (rowLastChild.index() === 2) {
						delBtn = parent.find('.jsRemove');
						delBtn.hide();
					}
				};

				return me;
			}());

			document.querySelector('.js-conditions-block') && editConditions.init();

            // изменение высоты ячеек в таблице для моб. версии (w < 768px)
            $(window).on('load resize', function() {
                var winWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
                if (winWidth < 768) {
                    changeHeightCellMobile($('.table-fired'));
                } else {
                    var reserHeight = $('.js-cell-mobile');
                    $(reserHeight).removeAttr('style');
                }

            });
            $('.table-fired-block').on('click', '.toogleLoader', function() {
                var winWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
                if (winWidth < 768) {
                    $('.table-fired tfoot').toggle();
                }
            });

            var editDocs = (function() {
                var me = {};
                me.formEditDocs = $('.doctype-form');
                me.init = function() {
                    // для добавления нового item на страницу
                    me.formEditDocs.on('click', '.jsAddNewItem', me.addNewItem);
                    // для удаления item
                    me.formEditDocs.on('click', '.jsRemoveItem', me.removeItem);
                }
                me.addNewItem = function() {
                    var table = $(this).closest('table'),
                        itemTemplate = table.data('itemTemplate') || 'rowTemplate',
                        rowTemplate = $('#' + itemTemplate),
                        tbody = table.find('> tbody'),
                        tr = tbody.find('tr'),
                        addBtn = tr.find('.jsAddNewItem');

                    if (!rowTemplate) return false;

                    rowTemplate = $(rowTemplate.html());

                    rowTemplate.appendTo(tbody);
                    addBtn.hide();
                    var newTr = tbody.find('tr:last-child');
                    newTr.fadeIn(500);
                    $('.js-select-branch').select2({
		                width: '100%',
		                placeholder: 'Выберите филиал',
		            });
                }
                me.removeItem = function() {
                    var tr = $(this).closest('tr'),
                    	trLastChild = $(this).closest('table').find('> tbody > tr:last-child'),
                    	lastTr, addBtn;
                    if (tr.index() == trLastChild.index()) {
                    	var lastTr_index = tr.index() - 1;
			        	lastTr = $(this).closest('table').find('> tbody > tr:eq(' + lastTr_index + ')');
			        } else {
			        	lastTr = trLastChild;
			        }
					addBtn = lastTr.find('.jsAddNewItem');

                	addBtn.show();
					tr.fadeOut(500, function() {
			            tr.remove();
			        });
                }
                return me;
            }());

            // если на странице есть нужный селектор, запускать фукнцию editBonuses.init
            document.querySelector('.doctype-form') && editDocs.init();


        });
    </script>

</body>

</html>
