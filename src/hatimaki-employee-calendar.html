<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Календарь событий сотрудника</title>

    @@include('include/_css.html')

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" integrity="sha256-siyOpF/pBWUPgIcQi17TLBkjvNgNQArcmwJB8YvkAgg=" crossorigin="anonymous" />

    @@include('include/_ie8.html')
</head>

<body>
    <div class="hat-scaffold">
        <div class="hat-scaffold__navbar">
            @@include('include/hat-navbar.html')
        </div>

        <div class="hat-scaffold__body">
            <div class="hat-scaffold__body-content">
                <div class="employee-calendar__content" data-bind="childrenComplete: onInit.bind($data)">
                    <div class="employee-calendar__header">
                        <div class="employee-calendar__range-paginator">
                            <button class="btn btn-default employee-calendar__range-paginator-button employee-calendar__range-paginator-backward-button"
                                data-bind="click: backward">
                                <i class="far fa-chevron-left"></i>
                            </button>

                            <span class="employee-calendar__range-paginator-value" data-bind="html: getRangeLabel()"></span>

                            <button class="btn btn-default employee-calendar__range-paginator-button employee-calendar__range-paginator-forward-button"
                                data-bind="click: forward">
                                <i class="far fa-chevron-right"></i>
                            </button>
                        </div>

                        <button class="btn btn-default icon-btn employee-calendar__calendar-button"
                            title="Показать каледарь">
                            <i class="far fa-calendar-alt"></i>
                        </button>

                        <button class="btn btn-default employee-calendar__select-today-button">Сегодня</button>

                        <!-- ko if: viewportSize().width >= 1271 -->
                            <a class="btn btn-default btn-with-icon employee-calendar__print-button" href="#">
                                <i class="far fa-print"></i>
                                Распечатать события
                            </a>
                        <!-- /ko -->

                        <!-- ko if: viewportSize().width < 1271 -->
                            <button class="btn btn-default icon-btn employee-calendar__print-button"
                                title="Распечатать события">
                                <i class="far fa-print"></i>
                            </button>
                        <!-- /ko -->

                        <div class="spacer"></div>

                        <div class="employee-calendar__range-size-selector">
                            <div class="employee-calendar__range-size-selector-value"
                                data-bind="click: function() { rangeSize(0); }, css: { 'employee-calendar__range-size-selector-value--active': rangeSize() === 0 }">
                                День
                            </div>
                            <div class="employee-calendar__range-size-selector-value"
                                data-bind="click: function() { rangeSize(1); }, css: { 'employee-calendar__range-size-selector-value--active': rangeSize() === 1 }">
                                Неделя
                            </div>
                            <div class="employee-calendar__range-size-selector-value"
                                data-bind="click: function() { rangeSize(2); }, css: { 'employee-calendar__range-size-selector-value--active': rangeSize() === 2 }">
                                Месяц
                            </div>
                            <div class="employee-calendar__range-size-selector-value"
                                data-bind="click: function() { rangeSize(3); }, css: { 'employee-calendar__range-size-selector-value--active': rangeSize() === 3 }">
                                Год
                            </div>
                        </div>

                        <button class="btn btn-default icon-btn employee-calendar__settings-button"
                            title="Настройка событий">
                            <i class="far fa-cog"></i>
                        </button>
                    </div>

                    <div class="employee-calendar__filters" data-bind="css: { 'employee-calendar__filters--collapsed': !isFiltersExpanded() }">
                        <div class="employee-calendar__filter-wrapper employee-calendar__search-filter-wrapper" data-bind="fade: isFiltersExpanded() || viewportSize().width >= 992">
                            <div class="form-group search-global search-global--empty employee-calendar__filter">
                                <input class="form-control" placeholder="Поиск по комментарию">

                                <button type="button" class="btn btn-default search-global__search-clear-button"
                                        title="Очистить">
                                    <i class="far fa-times"></i>
                                </button>
                            </div>
                        </div>

                        <div class="employee-calendar__filter-wrapper employee-calendar__positions-filter-wrapper" data-bind="fade: isFiltersExpanded() || viewportSize().width >= 992">
                            <div class="form-group employee-calendar__filter">
                                <select class="form-control" name="positions[]" id="positions" multiple data-bind="select2" data-placeholder="Должности">
                                    <option value="1">Должность #1</option>
                                    <option value="2">Должность #2</option>
                                    <option value="3">Должность #3</option>
                                    <option value="4">Должность #4</option>
                                </select>
                            </div>
                        </div>

                        <div class="employee-calendar__filter-wrapper employee-calendar__venues-filter-wrapper" data-bind="fade: isFiltersExpanded() || viewportSize().width >= 992">
                            <div class="form-group employee-calendar__filter">
                                <select class="form-control" name="venues[]" id="venues" multiple data-bind="select2" data-placeholder="Места проведения">
                                    <option value="1">Место проведения #1</option>
                                    <option value="2">Место проведения #2</option>
                                    <option value="3">Место проведения #3</option>
                                    <option value="4">Место проведения #4</option>
                                </select>
                            </div>
                        </div>

                        <div class="employee-calendar__filter-wrapper employee-calendar__manager-filter-wrapper"
                             data-bind="fade: isFiltersExpanded() || viewportSize().width >= 992">
                            <div class="employee-calendar__filter employee-calendar__employee-filter">
                                <div class="employee-calendar__employee-filter-item" data-toggle="tooltip" data-placement="bottom" title="События без ответственного"
                                    style="z-index: 6">
                                    <i class="far fa-question"></i>
                                </div>
                                <div class="employee-calendar__employee-filter-item" data-toggle="tooltip" data-placement="bottom" title="Смирнов Дмитрий Вaсильевич"
                                    style="z-index: 5">
                                    <img src="images/candidate-avatar.png">
                                </div>
                                <div class="employee-calendar__employee-filter-item" data-toggle="tooltip" data-placement="bottom" title="Смирнов Дмитрий Вaсильевич"
                                    style="z-index: 4">
                                    <i class="far fa-user"></i>
                                </div>
                                <div class="employee-calendar__employee-filter-item" data-toggle="tooltip" data-placement="bottom" title="Смирнов Дмитрий Вaсильевич"
                                    style="z-index: 3">
                                    <img src="images/candidate-avatar.png">
                                </div>
                                <div class="employee-calendar__employee-filter-item" data-toggle="tooltip" data-placement="bottom" title="Смирнов Дмитрий Вaсильевич"
                                    style="z-index: 2">
                                    <img src="images/candidate-avatar.png">
                                </div>
                                <div class="employee-calendar__employee-filter-item" data-toggle="tooltip" data-placement="bottom" title="Смирнов Дмитрий Вaсильевич"
                                    style="z-index: 1">
                                    <img src="images/candidate-avatar.png">
                                </div>
                            </div>
                        </div>

                        <!-- ko if: viewportSize().width < 992 -->
                            <div class="employee-calendar__filters-actions-wrapper">
                                <div class="employee-calendar__filters-actions">
                                    <button class="btn btn-link employee-calendar__filters-expand-button" type="button"
                                        data-bind="click: function() { isFiltersExpanded(!isFiltersExpanded()); }">
                                        <!-- ko if: isFiltersExpanded() -->
                                            Свернуть фильтры <i class="fas fa-chevron-up" aria-hidden="true"></i>
                                        <!-- /ko -->

                                        <!-- ko if: !isFiltersExpanded() -->
                                            Показать фильтры <i class="fas fa-chevron-down" aria-hidden="true"></i>
                                        <!-- /ko -->
                                    </button>
                                </div>
                            </div>
                        <!-- /ko -->
                    </div>

                    <div class="employee-calendar__body" data-bind="class: bodyClass">
                        <!-- ko if: rangeSize() === 3 -->
                            <div class="employee-calendar__body-year-content">
                                <!-- ko foreach: { data: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], as: 'month' } -->
                                        <div class="employee-calendar__body-year-content-month">
                                            <span class="employee-calendar__body-year-content-month-name" data-bind="text: $root.getMonthName(month)"></span>
                                            <table class="employee-calendar__body-year-content-month-days-table">
                                                <thead>
                                                    <tr>
                                                        <th>пн</th>
                                                        <th>вт</th>
                                                        <th>ср</th>
                                                        <th>чт</th>
                                                        <th>пт</th>
                                                        <th>сб</th>
                                                        <th>вс</th>
                                                    </tr>
                                                </thead>

                                                <tbody>
                                                    <!-- ko foreach: { data: [0, 1, 2, 3, 4, 5], as: 'weekOffset' } -->
                                                        <tr>
                                                            <!-- ko foreach: { data: [1, 2, 3, 4, 5, 6, 7], as: 'weekDay' } -->
                                                                <!-- ko let: { date: $root.getDateByMonthWeekOffsetWeekDay(month, weekOffset, weekDay) }  -->
                                                                    <td class="employee-calendar__body-year-content-month-days-table-day"
                                                                        data-bind="
                                                                            css: {
                                                                                'employee-calendar__body-year-content-month-days-table-day--current': $root.isCurrentDay(date) && $root.getMonth(date) === month,
                                                                                'employee-calendar__body-year-content-month-days-table-day--another-month': $root.getMonth(date) !== month
                                                                            },
                                                                            click: function () { $root.openDay(date); }
                                                                        ">
                                                                        <!-- ko text: $root.getDateOfMonth(date) --><!-- /ko -->

                                                                        <!-- ko if: $root.getEventsPerDayByDate(date).length > 0 && $root.getMonth(date) === month -->
                                                                            <div class="employee-calendar__body-year-content-month-days-table-day-event-indicator">
                                                                            </div>
                                                                        <!-- /ko -->
                                                                    </td>
                                                                <!-- /ko -->
                                                            <!-- /ko -->
                                                        </tr>
                                                    <!-- /ko -->
                                                </tbody>
                                            </table>
                                        </div>
                                <!-- /ko -->
                            </div>
                        <!-- /ko -->

                        <!-- ko if: rangeSize() === 2 -->
                            <!-- ko template: { name: 'body-sidebar' } --><!-- /ko -->

                            <div class="employee-calendar__body-month-content employee-calendar__body-with-sidebar-content" data-bind="scrollbar">
                                <table class="employee-calendar__body-month-content-table">
                                    <thead>
                                        <tr>
                                            <th>пн</th>
                                            <th>вт</th>
                                            <th>ср</th>
                                            <th>чт</th>
                                            <th>пт</th>
                                            <th>сб</th>
                                            <th>вс</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <!-- ko foreach: { data: [0, 1, 2, 3, 4, 5], as: 'weekOffset' } -->
                                            <tr>
                                                <!-- ko foreach: { data: [1, 2, 3, 4, 5, 6, 7], as: 'weekDay' } -->
                                                    <!-- ko let: { date: $root.getDateByWeekOffsetWeekDay(weekOffset, weekDay) }  -->
                                                        <!-- ko let: { events: $root.getEventsPerDayByDate(date) }  -->
                                                            <td class="employee-calendar__body-month-content-table-cell" data-bind="
                                                                css: {
                                                                    'employee-calendar__body-month-content-table-cell--current': $root.isCurrentDay(date) && !$root.isAnotherMonth(date),
                                                                    'employee-calendar__body-month-content-table-cell--another-month': $root.isAnotherMonth(date),
                                                                    'employee-calendar__body-month-content-table-cell--weekend': [6, 7].includes(weekDay),
                                                                },
                                                                click: function () { $root.selectDay(date); }
                                                            ">
                                                                <div class="employee-calendar__body-month-content-table-cell-header">
                                                                    <!-- ko if: events.length > 4 -->
                                                                        <a class="btn btn-link employee-calendar__body-month-content-table-cell-more-button">
                                                                            Ещё <!-- ko text: events.length - 4 --><!-- /ko -->
                                                                        </a>
                                                                    <!-- /ko -->

                                                                    <div class="spacer"></div>

                                                                    <div class="employee-calendar__body-month-content-table-cell-date" data-bind="text: $root.getDateOfMonth(date)">
                                                                    </div>
                                                                </div>

                                                                <div class="employee-calendar__body-month-content-table-cell-events">
                                                                    <!-- ko foreach: events.slice(0, 4) -->
                                                                        <div class="employee-calendar__body-month-content-table-cell-event"
                                                                            data-bind="
                                                                                class: $root.getBodyMonthContentTableCellEventClass(type),
                                                                                css: { 'employee-calendar__body-month-content-table-cell-event--passed': $root.isEventPassed($data) },
                                                                                click: function (_, event) { $root.selectEvent(id); event.stopPropagation(); }
                                                                            "
                                                                        >
                                                                            <!-- ko text: $root.getTimeByTimestamp(timestamp) --><!-- /ko --> <!-- ko text: branch --><!-- /ko -->
                                                                        </div>
                                                                    <!-- /ko -->
                                                                </div>
                                                            </td>
                                                        <!-- /ko -->
                                                    <!-- /ko -->
                                                <!-- /ko -->
                                            </tr>
                                        <!-- /ko -->
                                    </tbody>
                                </table>
                            </div>
                        <!-- /ko -->

                        <!-- ko if: rangeSize() === 1 -->
                            <!-- ko template: { name: 'body-sidebar' } --><!-- /ko -->

                            <div class="employee-calendar__body-week-content employee-calendar__body-with-sidebar-content" data-bind="scrollbar">
                                <div class="employee-calendar__body-week-content-hour-scale">
                                    <div class="employee-calendar__body-week-content-hour-scale-header"></div>

                                    <!-- ko foreach: { data: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23], as: 'hour' } -->
                                        <div class="employee-calendar__body-week-content-hour-scale-point" data-bind="text: $root.getTimeByHour(hour)"></div>
                                    <!-- /ko -->
                                </div>

                                <div class="employee-calendar__body-week-content-table-wrapper">
                                    <!-- ko if: isCurrentWeek(rangeDate()) -->
                                        <div class="employee-calendar__body-time-indicator"
                                            data-bind="style: {
                                                top: 25 + (44 * currentHour) + (44 / 60 * currentMinute) + 'px',
                                                left: 'calc((100% / 7) * ' + (currentWeekDay - 1) + ')'
                                            }"
                                        >
                                        </div>
                                    <!-- /ko -->
                                    <table class="employee-calendar__body-week-content-table">
                                        <thead>
                                            <tr>
                                                <!-- ko foreach: { data: [1, 2, 3, 4, 5, 6, 7], as: 'weekDay' } -->
                                                    <!-- ko let: { date: $root.getDateByWeekDay(weekDay) }  -->
                                                        <th class="employee-calendar__body-week-content-table-head-cell" data-bind="
                                                            html: $root.getWeekDayHeader(date),
                                                            click: function () { $root.openDay(date); },
                                                            css: {
                                                                'employee-calendar__body-week-content-table-head-cell--weekend': [6, 7].includes($data),
                                                                'employee-calendar__body-week-content-table-head-cell--current': $root.isCurrentDay(date)
                                                            }
                                                        ">
                                                        </th>
                                                    <!-- /ko -->
                                                <!-- /ko -->
                                            </tr>
                                        </thead>

                                        <tbody>
                                            <!-- ko foreach: { data: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23], as: 'hour' } -->
                                                <tr>
                                                    <!-- ko foreach: { data: [1, 2, 3, 4, 5, 6, 7], as: 'weekDay' } -->
                                                        <!-- ko let: { date: $root.getDateByWeekDayHour(weekDay, hour) }  -->
                                                            <!-- ko let: { events: $root.getEventsPerHourByDate(date) }  -->
                                                                <!-- ko let: { eventGroups: $root.groupEventsByMinute(events) }  -->
                                                                    <!-- ko let: { displayedEventCount: eventGroups.length === 1 ? Math.min(eventGroups[0].length, 4) : Math.min(eventGroups.length, 3) }  -->
                                                                        <td class="employee-calendar__body-week-content-table-cell" data-bind="
                                                                            css: {'employee-calendar__body-week-content-table-cell--weekend': [6, 7].includes(weekDay)}
                                                                        ">
                                                                            <div class="employee-calendar__body-week-content-table-cell-events">
                                                                                <div class="employee-calendar__body-week-content-table-cell-event-list">
                                                                                    <!-- ko foreach: { data: eventGroups.slice(0, 3), as: 'eventGroup' } -->
                                                                                        <div class="employee-calendar__body-week-content-table-cell-event-group"
                                                                                            data-bind="style: {
                                                                                                'margin-left': eventGroupIndex() * 22,
                                                                                            }">
                                                                                            <!-- ko foreach: { data: eventGroup.slice(0, eventGroups.length === 1 ? 4 : 1), as: 'event' } -->
                                                                                                <div class="employee-calendar__body-week-content-table-cell-event"
                                                                                                     data-bind="
                                                                                                        class: $root.getBodyWeekTableCellEventClass(type),
                                                                                                        css: { 'employee-calendar__body-week-content-table-cell-event--passed': $root.isEventPassed(event) },
                                                                                                        click: function (_, event) { $root.selectEvent(id); event.stopPropagation(); }
                                                                                                    "
                                                                                                >
                                                                                                    <!-- ko text: $root.getTimeByTimestamp(timestamp) --><!-- /ko --> <!-- ko text: branch --><!-- /ko -->
                                                                                                </div>
                                                                                            <!-- /ko -->
                                                                                        </div>
                                                                                    <!-- /ko -->
                                                                                </div>

                                                                                <div class="spacer"></div>

                                                                                <!-- ko if: events.length !== displayedEventCount -->
                                                                                    <div class="employee-calendar__body-week-content-table-cell-events-more-button"
                                                                                        data-bind="click: function () { $root.selectDay(date); } ">
                                                                                        +<!-- ko text: events.length - displayedEventCount --><!-- /ko -->
                                                                                    </div>
                                                                                <!-- /ko -->
                                                                            </div>
                                                                        </td>
                                                                    <!-- /ko -->
                                                                <!-- /ko -->
                                                            <!-- /ko -->
                                                        <!-- /ko -->
                                                    <!-- /ko -->
                                                </tr>
                                            <!-- /ko -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        <!-- /ko -->

                        <!-- ko if: rangeSize() === 0 -->
                            <!-- ko template: { name: 'body-sidebar' } --><!-- /ko -->

                            <div class="employee-calendar__body-day-content employee-calendar__body-with-sidebar-content" data-bind="scrollbar">
                                <div class="employee-calendar__body-day-content-hour-scale">
                                    <!-- ko foreach: { data: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23], as: 'hour' } -->
                                        <div class="employee-calendar__body-day-content-hour-scale-point" data-bind="text: $root.getTimeByHour(hour)"></div>
                                    <!-- /ko -->
                                </div>

                                <div class="employee-calendar__body-day-content-list-wrapper">
                                    <!-- ko if: isCurrentDay(rangeDate()) -->
                                        <div class="employee-calendar__body-time-indicator"
                                             data-bind="style: { top: (44 * currentHour) + (44 / 60 * currentMinute) + 'px' }">
                                        </div>
                                    <!-- /ko -->

                                    <div class="employee-calendar__body-day-content-list">
                                        <!-- ko foreach: { data: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23], as: 'hour' } -->
                                            <div class="employee-calendar__body-day-content-list-item">
                                                <!-- ko let: { date: $root.getDateByHour(hour) }  -->
                                                    <!-- ko let: { events: $root.getEventsPerHourByDate(date) }  -->
                                                        <!-- ko let: { eventGroups: $root.groupEventsByMinute(events) }  -->
                                                            <!-- ko foreach: { data: eventGroups, as: 'eventGroup' } -->
                                                                <div class="employee-calendar__body-day-content-list-item-event-group"
                                                                     data-bind="style: {
                                                                        'top': 'calc((44px / 60) * ' + $root.getMinute($root.getDateByTimestamp(eventGroup[0].timestamp)) + ')',
                                                                        'margin-left': eventGroupIndex() * 182,
                                                                        'width': 'calc(100% - ' + eventGroupIndex() * 182 + 'px)'
                                                                     }"
                                                                >
                                                                    <!-- ko foreach: { data: eventGroup, as: 'event' } -->
                                                                        <div class="employee-calendar__body-day-content-list-item-event"
                                                                             data-bind="
                                                                                class: $root.getBodyDayListItemEventClass(type),
                                                                                css: { 'employee-calendar__body-day-content-list-item-event--passed': $root.isEventPassed(event) },
                                                                                click: function (_, event) { $root.selectEvent(id); event.stopPropagation(); }
                                                                            "
                                                                        >
                                                                            <!-- ko text: $root.getTimeByTimestamp(timestamp) --><!-- /ko --> <!-- ko text: branch --><!-- /ko -->
                                                                            <span data-bind="text: $root.getTypeName(type)"></span>
                                                                            <span>
                                                                                <i class="far fa-address-card"></i>
                                                                                <!-- ko text: candidate.position.name --><!-- /ko -->
                                                                            </span>
                                                                            <span>
                                                                                <i class="far fa-user-plus"></i>
                                                                                <!-- ko text: candidate.name --><!-- /ko -->
                                                                            </span>
                                                                            <span>
                                                                                <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                                    <path d="M11.3438 8.23438L8.95312 7.22656C8.83594 7.17969 8.64844 7.13281 8.53125 7.13281C8.25 7.13281 7.875 7.32031 7.71094 7.53125L6.9375 8.46875C5.90625 7.90625 4.59375 6.59375 4.03125 5.5625L4.96875 4.78906C5.17969 4.625 5.36719 4.25 5.36719 3.96875C5.36719 3.85156 5.32031 3.66406 5.27344 3.54688L4.26562 1.15625C4.10156 0.804688 3.65625 0.5 3.28125 0.5C3.21094 0.5 3.09375 0.523438 3.02344 0.546875L0.820312 1.03906C0.351562 1.15625 0 1.625 0 2.09375C0 7.85938 4.66406 12.5234 10.4062 12.5C10.875 12.5 11.3438 12.1484 11.4609 11.6797L11.9531 9.47656C11.9766 9.40625 12 9.28906 12 9.24219C12 8.84375 11.6953 8.39844 11.3438 8.23438ZM10.3594 11.3984C5.27344 11.375 1.14844 7.22656 1.125 2.14062L3.23438 1.64844L4.21875 3.94531L2.625 5.25781C3.72656 7.57812 4.92188 8.77344 7.24219 9.875L8.55469 8.28125L10.8516 9.26562L10.3594 11.3984Z" fill="#888888"/>
                                                                                </svg>
                                                                                <!-- ko text: candidate.phone --><!-- /ko -->
                                                                            </span>
                                                                            <span>
                                                                                <i class="far fa-user-tie"></i>
                                                                                <!-- ko text: manager.name --><!-- /ko -->
                                                                            </span>
                                                                        </div>
                                                                    <!-- /ko -->
                                                                </div>
                                                            <!-- /ko -->
                                                        <!-- /ko -->
                                                    <!-- /ko -->
                                                <!-- /ko -->
                                            </div>
                                        <!-- /ko -->
                                    </div>
                                </div>
                            </div>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/html" id="body-sidebar">
        <div class="employee-calendar__body-sidebar"
             data-bind="
                css: { 'employee-calendar__body-sidebar--closed': !isBodySidebarOpen() }
            "
        >
            <div class="employee-calendar__body-sidebar-header">
                <span class="employee-calendar__body-sidebar-title" data-bind="text: sidebarTitle"></span>

                <div class="spacer"></div>

                <button class="btn btn-default employee-calendar__body-sidebar-toggle-button"
                        data-bind="click: function () { isBodySidebarOpen(!isBodySidebarOpen()); }">
                    <!-- ko if: viewportSize().width >= 992 -->
                        <!-- ko if: isBodySidebarOpen() -->
                            <i class="far fa-chevron-left"></i>
                        <!-- /ko -->

                        <!-- ko if: !isBodySidebarOpen() -->
                            <i class="far fa-chevron-right"></i>
                        <!-- /ko -->
                    <!-- /ko -->

                    <!-- ko if: viewportSize().width < 992 -->
                    <i class="far fa-times"></i>
                    <!-- /ko -->
                </button>
            </div>

            <!-- ko let: { selectedEvents: getEventsPerDayByDate(selectedDay()) } -->
                <div class="employee-calendar__body-sidebar-content" data-bind="scrollbar, bodySidebarContent, bodySidebarContentTargetEventIndex: selectedEvents.findIndex(e => e.id === $root.blinkingEventId())">
                    <!-- ko foreach: selectedEvents -->
                        <div class="employee-calendar__body-sidebar-event"
                            data-bind="css: { 'employee-calendar__body-sidebar-event--blinking': $root.blinkingEventId() === id  }">
                            <div class="employee-calendar__body-sidebar-event-header">
                                <span class="employee-calendar__body-sidebar-event-time" data-bind="text: $root.getTimeByTimestamp(timestamp)"></span>
                                <span class="employee-calendar__body-sidebar-event-type"
                                    data-bind="text: $root.getTypeName(type), class: $root.getBodySidebarEventTypeClass(type)">
                                </span>
                                <span class="spacer"></span>
                                <span class="employee-calendar__body-sidebar-event-branch" data-bind="text: branch"></span>
                            </div>

                            <div class="employee-calendar__body-sidebar-event-candidate">
                                <a class="employee-calendar__body-sidebar-event-candidate-name" data-bind="text: candidate.name" href="#"></a><br>
                                <span class="employee-calendar__body-sidebar-event-candidate-phone" data-bind="text: candidate.phone"></span><br>
                                <span class="employee-calendar__body-sidebar-event-candidate-position" data-bind="text: candidate.position.name"></span>
                            </div>
                            <div class="employee-calendar__body-sidebar-event-manager">
                                <div class="employee-calendar__body-sidebar-event-manager-avatar">
                                    <!-- ko if: manager.photoUrl !== null -->
                                        <img class="employee-calendar__body-sidebar-event-manager-avatar-image" data-bind="attr: { src: manager.photoUrl }">
                                    <!-- /ko -->

                                    <!-- ko if: manager.photoUrl === null -->
                                        <div class="employee-calendar__body-sidebar-event-manager-avatar-placeholder">
                                            <i class="far fa-user"></i>
                                        </div>
                                    <!-- /ko -->
                                </div>

                                <a class="employee-calendar__body-sidebar-event-manager-name" data-bind="text: manager.name" href="#"></a>
                            </div>

                            <!-- ko if: comment !== null -->
                                <div class="employee-calendar__body-sidebar-event-comment">
                                    <i class="fas fa-comment-alt employee-calendar__body-sidebar-event-comment-icon"></i>
                                    <!-- ko text: comment --><!-- /ko -->
                                </div>
                            <!-- /ko -->
                        </div>
                     <!-- /ko -->
                </div>
            <!-- /ko -->
        </div>
    </script>

    @@include('include/_js.html')

    <!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js"></script>-->
    <script type="text/javascript" src="https://knockoutjs.com/downloads/knockout-3.5.0.debug.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.min.js" integrity="sha256-VeNaFBVDhoX3H+gJ37DpT/nTuZTdjYro9yBruHjVmoQ=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js" integrity="sha256-bqVeqGdJ7h/lYPq6xrPv/YGzMEb6dNxlfiTUHSgRCp8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.ru.min.js" integrity="sha256-iGDUwn2IPSzlnLlVeCe3M4ZIxQxjUoDYdEO6oBZw/Go=" crossorigin="anonymous"></script>

    <script type="text/javascript">
        moment.locale('ru');

        ko.bindingHandlers.select2 = {
            init: function (element, valueAccessor, allBindings) {
                const $element = $(element);
                const isMultiple = $element.prop('multiple');
                const valueObservable = allBindings()[!isMultiple ? 'value' : 'selectedOptions'];

                const customOptionNames = ['wrapperCssClass'];

                const defaultOptions = {
                    minimumResultsForSearch: Infinity,
                    language: 'ru',
                    width: 'element',
                    dropdownAutoWidth: true
                };

                if (valueObservable) {
                    $element.val(ko.utils.unwrapObservable(valueObservable));
                }

                const options = ko.utils.unwrapObservable(valueAccessor());

                const customOptions = _.pick(options, customOptionNames);

                const originalRenderFn = $.fn.select2.amd.require('jquery.select2').prototype.render;

                $.fn.select2.amd.require('jquery.select2').prototype.render = function () {
                    const $container = originalRenderFn.call(this, ...arguments);

                    if ('wrapperCssClass' in customOptions) {
                        $container.addClass(customOptions.wrapperCssClass);
                    }

                    return $container;
                };

                $element.select2($.extend(defaultOptions, _.omit(options, customOptionNames)));

                $.fn.select2.amd.require('jquery.select2').prototype.render = originalRenderFn;

                if ('wrapperCssClass' in customOptions) {
                    const $wrapper = $element.data('select2').$container;
                    $wrapper.addClass(customOptions.wrapperCssClass);
                }

                $element.data('select2').$results.addClass('scrollbar-inner').scrollbar();

                if (valueObservable) {
                    if (ko.isObservable(valueObservable)) {
                        $element.on('change', () => {
                            const value = $element.val();
                            valueObservable(value);
                        });
                    }
                }
            },
            update: function (element, valueAccessor, allBindings) {
                const $element = $(element);
                const isMultiple = $element.prop('multiple');

                if (!isMultiple) {
                    const valueObservable = allBindings()['value'];

                    if (valueObservable && ko.isObservable(valueObservable)) {
                        valueObservable.subscribe(v => {
                            $element.val(v).trigger('change');
                        });
                    }
                }
            }
        };

        ko.bindingHandlers.fade = {
            init: function (element, valueAccessor) {
                const value = ko.unwrap(valueAccessor());

                if (value) {
                    $(element).fadeIn(0);
                } else {
                    $(element).fadeOut(0);
                }

                $(element).data('fade', value);
            },
            update: function (element, valueAccessor, allBindings) {
                const value = ko.unwrap(valueAccessor());
                const duration = allBindings.get('fadeDuration') || 200;

                if ($(element).data('fade') !== value) {
                    if (value) {
                        $(element).fadeIn(duration);
                    } else {
                        $(element).fadeOut(duration);
                    }

                    $(element).data('fade', value);
                }
            }
        };

        ko.bindingHandlers.bodySidebarContent = {
            update: function (element, valueAccessor, allBindings) {
                const targetEventIndex = allBindings.get('bodySidebarContentTargetEventIndex');

                if (targetEventIndex !== -1 && $(element).children().eq(targetEventIndex).length > 0) {
                    $(element).animate({
                        scrollTop: $(element).children().eq(targetEventIndex).offset().top - $(element).offset().top + $(element).scrollTop()
                    }, 200);
                } else {
                    $(element).finish();
                }
            }
        };

        ko.bindingHandlers.scrollbar = {
            init: function (element) {
                $(element).addClass('scrollbar-inner').scrollbar();
            }
        };

        $(document).ready(function () {
            initHatNavbar(document);

            const ViewModel = function() {
                this.viewportSize = ko.observable({width: $(window).width(), height: $(window).height()});
                this.currentDate = moment().toDate();
                this.currentWeekDay = moment(this.currentDate).day();
                this.currentHour = moment(this.currentDate).hour();
                this.currentMinute = moment(this.currentDate).minute();

                this.rangeDate = ko.observable(moment(new Date()).startOf('day').toDate());
                this.rangeSize = ko.observable(3);

                this.isFiltersExpanded = ko.observable(true);

                this.isBodySidebarOpen = ko.observable(true);

                this.selectedDay = ko.observable(this.currentDate);
                this.blinkingEventId = ko.observable(null);

                this.events = [
                    {
                        id: 0,
                        type: 0,
                        timestamp: 1574896884,
                        branch: 'Филиал #1',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: 'images/candidate-avatar.png'
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    },
                    {
                        id: 1,
                        type: 0,
                        timestamp: 1574896984,
                        branch: 'Филиал #2',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: null
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    },
                    {
                        id: 2,
                        type: 1,
                        timestamp: 1574897384,
                        branch: 'Филиал #2',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: null
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    },
                    {
                        id: 3,
                        type: 1,
                        timestamp: 1574897984,
                        branch: 'Филиал #2',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: null
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    },
                    {
                        id: 4,
                        type: 0,
                        timestamp: 1574900484,
                        branch: 'Филиал #2',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: null
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    },
                    {
                        id: 5,
                        type: 1,
                        timestamp: 1574904084,
                        branch: 'Филиал #3',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: null
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    },
                    {
                        id: 6,
                        type: 1,
                        timestamp: 1574904084,
                        branch: 'Филиал #4',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: null
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    },
                    {
                        id: 7,
                        type: 1,
                        timestamp: 1574904084,
                        branch: 'Филиал #5',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: null
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    },
                    {
                        id: 8,
                        type: 1,
                        timestamp: 1574904084,
                        branch: 'Филиал #6',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: null
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    },
                    {
                        id: 9,
                        type: 1,
                        timestamp: 1574904084,
                        branch: 'Филиал #7',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: null
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    },
                    {
                        id: 10,
                        type: 1,
                        timestamp: 1574907684,
                        branch: 'Филиал #4',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: null
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    },
                    {
                        id: 11,
                        type: 1,
                        timestamp: 1577959900,
                        branch: 'Филиал #6',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: null
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    },
                    {
                        id: 12,
                        type: 1,
                        timestamp: 1577960800,
                        branch: 'Филиал #6',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: null
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    },
                    {
                        id: 13,
                        type: 1,
                        timestamp: 1577961700,
                        branch: 'Филиал #6',
                        manager: {
                            name: 'Подзигунова Кристина Марселевна',
                            photoUrl: null
                        },
                        candidate: {
                            name: 'Константинопольская Евгения Анатольевна',
                            position: {
                                name: 'Администратор филиала'
                            },
                            phone: '8(917)367-8708'
                        },
                        comment: 'Отличные рекомендации с прошлого места работы (прямые конкуренты)'
                    }
                ];

                this.bodyClass = ko.computed(() => {
                    const result = [];

                    if ([0, 1, 2].includes(this.rangeSize())) {
                        result.push('employee-calendar__body-with-sidebar');

                        if (!this.isBodySidebarOpen()) {
                            result.push('employee-calendar__body-with-sidebar--closed')
                        }
                    }

                    return result.join(' ');
                }, this);

                this.forward = function () {
                    let period;

                    switch (this.rangeSize()) {
                        case 0: period = 'day'; break;
                        case 1: period = 'week'; break;
                        case 2: period = 'month'; break;
                        case 3: period = 'year'; break;
                    }

                    this.rangeDate(moment(this.rangeDate()).add(1, period).toDate());
                };

                this.backward = function () {
                    let period;

                    switch (this.rangeSize()) {
                        case 0: period = 'day'; break;
                        case 1: period = 'week'; break;
                        case 2: period = 'month'; break;
                        case 3: period = 'year'; break;
                    }

                    this.rangeDate(moment(this.rangeDate()).subtract(1, period).toDate());
                };

                this.getMonthName = function (month) {
                    switch (month) {
                        case 1: return 'Январь';
                        case 2: return 'Февраль';
                        case 3: return 'Март';
                        case 4: return 'Апрель';
                        case 5: return 'Май';
                        case 6: return 'Июнь';
                        case 7: return 'Июль';
                        case 8: return 'Август';
                        case 9: return 'Сентябрь';
                        case 10: return 'Октябрь';
                        case 11: return 'Ноябрь';
                        case 12: return 'Декабрь';
                    }
                };

                this.getDateByMonthWeekOffsetWeekDay = function (month, weekOffset, weekDay) {
                    return moment({year: moment(this.rangeDate()).year(), month: month - 1}).startOf('isoWeek').add(weekOffset, 'w').add(weekDay - 1, 'd').toDate();
                };

                this.getDateByWeekOffsetWeekDay = function (weekOffset, weekDay) {
                    return moment(this.rangeDate()).startOf('month').startOf('isoWeek').add(weekOffset, 'w').add(weekDay - 1, 'd').toDate();
                };

                this.getDateByWeekDayHour = function (weekDay, hour) {
                    return moment(this.rangeDate()).startOf('isoWeek').add(weekDay - 1, 'd').startOf('day').add(hour, 'h').toDate();
                };

                this.getDateByHour = function (hour) {
                    return moment(this.rangeDate()).startOf('day').add(hour, 'h').toDate();
                };

                this.getDateByWeekDay = function (weekDay) {
                    return moment(this.rangeDate()).startOf('isoWeek').add(weekDay - 1, 'd').toDate();
                };

                this.getDateOfMonth = function (date) {
                    return moment(date).date();
                };

                this.getMonth = function (date) {
                    return moment(date).month() + 1;
                };

                this.getMinute = function (date) {
                    return moment(date).minute();
                };

                this.isCurrentDay = function (date) {
                    return moment(this.currentDate).isSame(date, 'day');
                };

                this.isCurrentWeek = function (date) {
                    return moment(this.currentDate).isSame(date, 'week');
                };

                this.isAnotherMonth = function (date) {
                    return !moment(this.rangeDate()).isSame(date, 'month');
                };

                this.getEventsPerDayByDate = function (date) {
                    return this.events.filter(e => moment.unix(e.timestamp).isSame(date, 'day'));
                };

                this.getEventsPerHourByDate = function (date) {
                    return this.events.filter(e => moment.unix(e.timestamp).isSame(date, 'hour'));
                };

                this.isEventPassed = function (event) {
                    return moment(this.currentDate).isAfter(moment(this.getDateByTimestamp(event.timestamp)));
                };

                this.selectDay = function (date) {
                    this.isBodySidebarOpen(true);
                    this.selectedDay(date);
                };

                let blinkingTimerId = null;

                this.selectEvent = function (id) {
                    if (blinkingTimerId !== null) {
                        clearTimeout(blinkingTimerId);
                        blinkingTimerId = null;
                    }

                    const event = this.events.find(e => e.id === id);

                    this.isBodySidebarOpen(true);
                    this.selectedDay(moment(this.getDateByTimestamp(event.timestamp)).startOf('day'));
                    this.blinkingEventId(id);

                    blinkingTimerId = setTimeout(() => {
                        this.blinkingEventId(null);
                        this.blinkingTimerId = null;
                    }, 1200);
                };

                this.openDay = function (date) {
                    this.rangeDate(date);
                    this.rangeSize(0);
                    this.selectedDay(date);
                };

                this.getRangeLabel = function () {
                    const rangeDate = this.rangeDate();
                    switch (this.rangeSize()) {
                        case 0: return moment(rangeDate).format(`D MMMM YYYY`).toLowerCase();
                        case 1:
                            const startOfWeek = moment(rangeDate).startOf('isoWeek');
                            const endOfWeek = moment(rangeDate).endOf('isoWeek');

                            if (startOfWeek.isSame(endOfWeek, 'month')) {
                                return `${startOfWeek.date()}–${endOfWeek.date()} ` + moment(rangeDate).format(`DD MMMM YYYY`).slice(2).toLowerCase();
                            } else {
                                return moment(startOfWeek).format(`D MMMM YYYY`).toLowerCase() + '<br>' + moment(endOfWeek).format(`D MMMM YYYY`).toLowerCase();
                            }
                        case 2: return moment(rangeDate).format(`MMMM YYYY`).toLowerCase();
                        case 3: return moment(rangeDate).format(`YYYY`);
                    }
                };

                this.getTimeByTimestamp = function (timestamp) {
                    return moment.unix(timestamp).format('HH:mm');
                };

                this.getTimeByHour = function (hour) {
                    return moment({hour}).format('HH:mm');
                };

                this.getDateByTimestamp = function (timestamp) {
                    return moment.unix(timestamp).toDate();
                };

                this.getBodyMonthContentTableCellEventClass = function (type) {
                    switch (type) {
                        case 0: return 'employee-calendar__body-month-content-table-cell-event--type_interview';
                        case 1: return 'employee-calendar__body-month-content-table-cell-event--type_testing';
                    }
                };

                this.getWeekDayHeader = function (date) {
                    return moment(date).format('<b>D.MM</b>, dd').toLowerCase();
                };

                this.groupEventsByMinute = function (events) {
                    return _.chain(events).groupBy(e => moment.unix(e.timestamp).format('D MMMM YYYY HH mm')).values().value();
                };

                this.getBodyWeekTableCellEventClass = function (type) {
                    switch (type) {
                        case 0: return 'employee-calendar__body-week-content-table-cell-event--type_interview';
                        case 1: return 'employee-calendar__body-week-content-table-cell-event--type_testing';
                    }
                };

                this.getBodyDayListItemEventClass = function (type) {
                    switch (type) {
                        case 0: return 'employee-calendar__body-day-content-list-item-event--type_interview';
                        case 1: return 'employee-calendar__body-day-content-list-item-event--type_testing';
                    }
                };

                this.getTypeName = function (type) {
                    switch (type) {
                        case 0: return 'Собеседование';
                        case 1: return 'Тестирование';
                    }
                };

                this.getBodySidebarEventTypeClass = function (type) {
                    switch (type) {
                        case 0: return 'employee-calendar__body-sidebar-event-type--value_interview';
                        case 1: return 'employee-calendar__body-sidebar-event-type--value_testing';
                    }
                };

                this.sidebarTitle = ko.computed(() => {
                    return moment(this.selectedDay()).format('D MMMM YYYY, dd').toLowerCase();
                }, this);
            };

            const viewModel = new ViewModel();

            const $documentsContent = $('.employee-calendar__content');

            viewModel.onInit = function() {
                $(window).resize(() => {
                    this.viewportSize({width: $(window).width(), height: $(window).height()});
                });

                initSearchGlobal($documentsContent.find('.search-global'));

                $('.employee-calendar__employee-filter-item').on('click', function() {
                    $(this).toggleClass('employee-calendar__employee-filter-item--selected');
                });

                $('.employee-calendar__calendar-button').datepicker({
                    dateFormat: 'yyyy',
                    language: 'ru'
                }).on('changeDate', function(ev){
                    $('.employee-calendar__calendar-button').datepicker('hide');
                });

                $('.employee-calendar__employee-filter [data-toggle="tooltip"]').tooltip({
                    template: '<div class="tooltip employee-calendar__employee-filter-tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'
                })
            };

            ko.applyBindings(
                viewModel,
                $documentsContent.get()[0]
            );
        });
    </script>
</body>
</html>
