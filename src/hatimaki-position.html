<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Сотрудники</title>

    @@include('include/_css.html')

    @@include('include/_ie8.html')
</head>
<body>
    <div class="hat-scaffold">
        <div class="hat-scaffold__navbar">
            @@include('include/hat-navbar.html')
        </div>

        <div class="hat-scaffold__body">
            <div class="hat-scaffold__content-wrapper">
                <div class="clearfix head-with-btn">
                    <h1>Создать должность</h1>
                </div>

                <hr>

                <form action="" method="post" class="position__form">
                    <div class="form-group">
                        <label for="code">Код должности</label>
                        <input type="text" class="form-control" value="" name="code" id="code">
                    </div>

                    <div class="form-group">
                        <label for="name">Названеие должности</label>
                        <input type="text" class="form-control" value="" name="name" id="name">
                    </div>

                    <div class="form-group">
                        <label for="hatimakiId">ID вакансии на сайте <a target="_blank">Хатимаки</a></label>
                        <input type="text" class="form-control" value="" name="hatimakiId" id="hatimakiId">
                    </div>

                    <div class="form-group">
                        <label for="avitoXml">XML для вакансии на сайте <a target="_blank">Avito</a></label>
                        <input type="text" class="form-control" value="" name="avitoXml" id="avitoXml">
                    </div>

                    <div class="form-group">
                        <div class="checkbox-nice">
                            <label>
                                <input type="checkbox" checked="" name="avitoActivity" id="avitoActivity">
                                <span class="fa fa-check"></span>
                                Активность для сайта <a target="_blank">Avito</a>
                            </label>
                        </div>
                    </div>

                    <ul class="nav nav-tabs">
                        <li class="active"><a href="#tab1" role="tab" data-toggle="tab">Настройки</a></li>
                        <li><a href="#tab2" role="tab" data-toggle="tab">Депозит</a></li>
                    </ul>
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="tab1">
							<div class="form-group">...</div>
							<h3 class="position__head">Основная нагрузка</h3>
							<div class="form-group">
								<label class="control-label" for="settingsform-type_load">Тип нагрузки</label>
								<select id="settingsform-type_load" class="form-control" name="SettingsForm[type_load]">
									<option value="orders_employee">Количество заказов, закрепленных за сотрудником</option>
									<option value="orders_office">Количество заказов, произведенных в филиале</option>
									<option value="payday">Оплата за смену</option>
									<option value="payhour">Оплата за час</option>
									<option value="proceeds_category">Сумма выручки филиала по одной категории товара</option>
									<option value="proceeds_employee">Сумма выручки по товарам (заказам), закрепленным за конкретным сотрудником</option>
									<option value="proceeds_office">Сумма выручки всего филиала</option>
									<option value="proceeds_order_type">Сумма выручки филиала по типу заказа</option>
									<option value="proceeds_product">Сумма выручки филиала по отдельным товарам</option>
									<option value="products_employee">Количество товаров, закрепленных за сотрудником</option>		
								</select>					
							</div>
							
							<h3 class="position__head">Дополнительная нагрузка</h3>
							<div class="form-group position__loads">
							   <table class="table position__loads--table">
									<thead>
										<tr>
											<th>Тип заказа</th>
											<th>Доп. нагрузка, %</th>
											<th class="cell-btns">
												<button type="button" class="btn btn-xs btn-default jsAddNewItem" title="Добавить нагрузку">
													<i class="fas fa-plus"></i>
												</button>
											</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td class="cell-types">
												<select class="js-select2-types form-control" name="types_order[]">
													<option value="-1"></option>
													<option value="0">Зал</option>
													<option value="1">Доставка</option>
													<option value="2">Самовывоз</option>
												</select>
											</td>
											<td class="cell-load">
												<input type="text" class="form-control numbersOnly" name="loads[]" placeholder="Нагрузка, %" maxlength="10">
											</td>
											<td class="cell-btns">
												<button type="button" class="btn btn-xs btn-danger jsRemoveItem" title="Удалить нагрузку">
													<i class="fas fa-minus"></i>
												</button>
											</td>
										</tr>
									</tbody>
								</table>
								<!-- template for row -->
								<script id="rowTemplate" type="text/template">
								<tr>
									<td class="cell-types">
										<select class="js-select2-types form-control" name="types_order[]">
											<option value="-1"></option>
											<option value="0">Зал</option>
											<option value="1">Доставка</option>
											<option value="2">Самовывоз</option>
										</select>
									</td>
									<td class="cell-load">
										<input type="text" class="form-control numbersOnly" name="loads[]" placeholder="Нагрузка, %" maxlength="10">
									</td>
									<td class="cell-btns">
										<button type="button" class="btn btn-xs btn-danger jsRemoveItem" title="Удалить нагрузку">
											<i class="fas fa-minus"></i>
										</button>
									</td>
								</tr>
								</script>
								<!-- / template of Row -->
							</div>
							
							<h3 class="position__head">Расчет ЗП</h3>
							<div class="form-group field-settingsform-norm">
								<label class="control-label" for="settingsform-norm">Норматив выработки</label>
								<input type="text" id="settingsform-norm" class="form-control" name="SettingsForm[norm]">

								<div class="help-block"></div>
							</div>
						</div>
						
                        <div role="tabpanel" class="tab-pane" id="tab2">
                            <div class="position__form-row">
                                <div class="form-group required">
                                    <label for="depositValue">Сумма депозита</label>

                                    <div class="input-group position__input-group">
                                        <input type="number" class="form-control" value="" name="depositValue" id="depositValue" required>

                                        <div class="input-group-addon position__input-group-addon">
                                            <i class="fas fa-ruble-sign"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group position__form-group-checks">
                                    <div class="checkbox-nice">
                                        <label>
                                            <input type="checkbox" name="" id="depositHandMode">
                                            <span class="fa fa-check"></span>
                                            Снимать в ручном режиме
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="js-deposit-settings">
                                <div class="position__form-row">
                                    <div class="form-group required">
                                        <label for="shiftPayment">Взимать за смену</label>

                                        <div class="input-group position__input-group">
                                            <div class="input-group-addon position__input-group-addon position__input-group-addon-payment-type-picker">
                                                <div class="btn-group position__btn-group" role="group">
                                                    <button type="button" class="btn btn-default"><b>%</b></button>
                                                    <button type="button" class="btn btn-default active">
                                                        <i class="fas fa-ruble-sign"></i>
                                                    </button>
                                                </div>
                                            </div>

                                            <input type="number" class="form-control" value="" name="shiftPayment" id="shiftPayment" required>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="minSalary">При min ЗП</label>

                                        <div class="input-group position__input-group">
                                            <input type="number" class="form-control" value="" name="minSalary" id="minSalary" required>

                                            <div class="input-group-addon position__input-group-addon">
                                                <i class="fas fa-ruble-sign"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="position__form-row">
                                    <div class="form-group position__form-group-shift-count">
                                        <label for="shiftCount">Кол-во смен</label>

                                        <input type="number" class="form-control" value="" name="shiftCount" id="shiftCount" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="rank">Разряд</label>
                                        <select class="form-control" name="rank" id="rank">
                                            <option value="0"></option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">30</option>
                                        </select>
                                    </div>

                                    <div class="form-group position__form-group-checks">
                                        <div class="checkbox-nice">
                                            <label>
                                                <input type="checkbox" checked="" name="branchAttached" id="branchAttached">
                                                <span class="fa fa-check"></span>
                                                Закреплён за филиалом
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="position__form-actions">
                            <button type="button" class="btn btn-default btn-p25">Вернуться</button>
                            <button type="button" class="btn btn-primary btn-p25">Сохранить</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    @@include('include/_js.html')

	<script type="text/javascript">
		$(document).ready(function () {
		    initHatNavbar(document);

			$('#depositHandMode').on('click', function() {
				var isChecked = $(this).is(":checked");
				var block = $('.js-deposit-settings');
				if (isChecked) {
					block.hide(300);
				} else {
					block.show(300);
				}
			});
			
            $('.js-select2-types').select2({
                tags: true,
                placeholder: {
                    id: '-1',
                    text: 'Тип заказа'
                },
                allowClear: true,
                width: '100%'
            });				
			
			
            var formLoads = (function() {
                var me = {};
                me.formLoads = $('.position__loads');
                me.init = function() {
                    // для добавления нового item на страницу
                    me.formLoads.on('click', '.jsAddNewItem', me.addNewItem);
                    // для удаления item
                    me.formLoads.on('click', '.jsRemoveItem', me.removeItem);

                    // Restrict input to digits by using a regular expression filter.
                    $(".numbersOnly").inputFilter(me.numbersOnly);
                }
                me.numbersOnly = function(value) {
                    return /^\d*[.,]?\d*$/.test(value);
                }
                me.addNewItem = function() {
                    var table = $(this).closest('table'),
                        rowTemplate = $('#rowTemplate'),
                        tbody = table.find('> tbody'),
                        tr = tbody.find('tr');

                    if (!rowTemplate) return false;
					
                    rowTemplate = $(rowTemplate.html());

                    var input = rowTemplate.find('.numbersOnly');
					input.inputFilter(me.numbersOnly);	

					var select2 = rowTemplate.find('.js-select2-types');
					select2.select2({
						tags: true,
						placeholder: {
							id: '-1',
							text: 'Тип заказа'
						},
						allowClear: true,
						width: '100%'
					});
					
                    rowTemplate.appendTo(tbody);				
                }
                me.removeItem = function() {
                    var tr = $(this).closest('tr');

                    tr.remove();
                }
                return me;
            }());

            formLoads.init();
			
		});
	</script>
</body>

<!-- TODO: удалить после перехода всех страниц на новое меню -->
@@include('include/_hat-navbar-fix.html')

</html>
