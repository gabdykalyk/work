<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Поставщики</title>

    @@include('include/_css.html')

    @@include('include/_ie8.html')
</head>
<body>
<div class="hat-scaffold">
    <div class="hat-scaffold__navbar">
        @@include('include/hat-navbar.html')
    </div>

    <div class="hat-scaffold__body">
        <div class="hat-scaffold__content-wrapper">
            <div class="clearfix head-with-btn head-providers">
                <h1>Поставщики</h1>

                <a href="#" class="btn btn-default btn-p25 btn-with-icon">
                    <i class="fas fa-sync"></i>
                    <span>Обновить</span>
                </a>
            </div>

            <hr class="hidden-xs">

            <div class="providers-list__content">
                <div class="providers-list__search">
                    <input class="form-control providers-list__search-field" value="" placeholder="Поиск">

                    <button type="submit" class="btn btn-primary btn-p25 providers-list__search-button">Сохранить
                    </button>
                </div>

                <div class="providers-list__table">
                    <div class="providers-list__table-header">
                    <span class="providers-list__table-header-cell providers-list__table-header-cell--provider">
                        Поставщик
                    </span>

                        <span class="providers-list__table-header-cell providers-list__table-header-cell--min-sum">
                        Min сумма заказа
                    </span>
                    </div>

                    <div class="providers-list__table-body">
                        <div class="providers-list__table-row">
                            <div class="providers-list__table-row-content">
                                <div class="providers-list__table-sub-row providers-list__table-sub-row--main">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider">
                                        <div class="providers-list__table-toggle">
                                            <i class="fa fa-chevron-circle-down"></i>

                                            ИП Киселева Нина Викторовна
                                        </div>
                                    </div>

                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="providers-list__table-sub-row providers-list__table-sub-row--secondary">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider"></div>
                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__table-branch-input-group">
                                            <select>
                                                <option value="-1"></option>
                                                <option value="0">Коммунарка</option>
                                                <option value="1">Бутово</option>
                                            </select>
                                        </div>

                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>

                                        <button class="btn providers-list__table-button providers-list__table-remove-button">
                                            <i class="fa fa-times"></i>
                                        </button>

                                        <button class="btn providers-list__table-button providers-list__table-add-button">
                                            <i class="fa fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="providers-list__table-row">
                            <div class="providers-list__table-row-content">
                                <div class="providers-list__table-sub-row providers-list__table-sub-row--main">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider">
                                        <div class="providers-list__table-toggle">
                                            <i class="fa fa-chevron-circle-down"></i>

                                            ООО «Авеню Парк‎»‎
                                        </div>
                                    </div>

                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="providers-list__table-sub-row providers-list__table-sub-row--secondary">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider"></div>
                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__table-branch-input-group">
                                            <select>
                                                <option value="-1"></option>
                                                <option value="0">Коммунарка</option>
                                                <option value="1">Бутово</option>
                                            </select>
                                        </div>

                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>

                                        <button class="btn providers-list__table-button providers-list__table-remove-button">
                                            <i class="fa fa-times"></i>
                                        </button>

                                        <button class="btn providers-list__table-button providers-list__table-add-button">
                                            <i class="fa fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="providers-list__table-row">
                            <div class="providers-list__table-row-content">
                                <div class="providers-list__table-sub-row providers-list__table-sub-row--main">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider">
                                        <div class="providers-list__table-toggle">
                                            <i class="fa fa-chevron-circle-down"></i>

                                            ООО «Витаж-М‎»‎
                                        </div>
                                    </div>

                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="providers-list__table-sub-row providers-list__table-sub-row--secondary">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider"></div>
                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__table-branch-input-group">
                                            <select>
                                                <option value="-1"></option>
                                                <option value="0">Коммунарка</option>
                                                <option value="1">Бутово</option>
                                            </select>
                                        </div>

                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>

                                        <button class="btn providers-list__table-button providers-list__table-remove-button">
                                            <i class="fa fa-times"></i>
                                        </button>

                                        <button class="btn providers-list__table-button providers-list__table-add-button">
                                            <i class="fa fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="providers-list__table-row">
                            <div class="providers-list__table-row-content">
                                <div class="providers-list__table-sub-row providers-list__table-sub-row--main">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider">
                                        <div class="providers-list__table-toggle">
                                            <i class="fa fa-chevron-circle-down"></i>

                                            ООО «Мистерия»‎
                                        </div>
                                    </div>

                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="providers-list__table-sub-row providers-list__table-sub-row--secondary">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider"></div>
                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__table-branch-input-group">
                                            <select>
                                                <option value="-1"></option>
                                                <option value="0">Коммунарка</option>
                                                <option value="1">Бутово</option>
                                            </select>
                                        </div>

                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>

                                        <button class="btn providers-list__table-button providers-list__table-remove-button">
                                            <i class="fa fa-times"></i>
                                        </button>

                                        <button class="btn providers-list__table-button providers-list__table-add-button">
                                            <i class="fa fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="providers-list__table-row">
                            <div class="providers-list__table-row-content">
                                <div class="providers-list__table-sub-row providers-list__table-sub-row--main">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider">
                                        <div class="providers-list__table-toggle">
                                            <i class="fa fa-chevron-circle-down"></i>

                                            ООО «Торговый дом "Десерт Фентези"»‎
                                        </div>
                                    </div>

                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="providers-list__table-sub-row providers-list__table-sub-row--secondary">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider"></div>
                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__table-branch-input-group">
                                            <select>
                                                <option value="-1"></option>
                                                <option value="0">Коммунарка</option>
                                                <option value="1">Бутово</option>
                                            </select>
                                        </div>

                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>

                                        <button class="btn providers-list__table-button providers-list__table-remove-button">
                                            <i class="fa fa-times"></i>
                                        </button>

                                        <button class="btn providers-list__table-button providers-list__table-add-button">
                                            <i class="fa fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="providers-list__table-row">
                            <div class="providers-list__table-row-content">
                                <div class="providers-list__table-sub-row providers-list__table-sub-row--main">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider">
                                        <div class="providers-list__table-toggle">
                                            <i class="fa fa-chevron-circle-down"></i>

                                            ООО Кока-Кола ЭйБиСи Евразия
                                        </div>
                                    </div>

                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="providers-list__table-sub-row providers-list__table-sub-row--secondary">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider"></div>
                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__table-branch-input-group">
                                            <select>
                                                <option value="-1"></option>
                                                <option value="0">Коммунарка</option>
                                                <option value="1">Бутово</option>
                                            </select>
                                        </div>

                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>

                                        <button class="btn providers-list__table-button providers-list__table-remove-button">
                                            <i class="fa fa-times"></i>
                                        </button>

                                        <button class="btn providers-list__table-button providers-list__table-add-button">
                                            <i class="fa fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="providers-list__table-row">
                            <div class="providers-list__table-row-content">
                                <div class="providers-list__table-sub-row providers-list__table-sub-row--main">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider">
                                        <div class="providers-list__table-toggle">
                                            <i class="fa fa-chevron-circle-down"></i>

                                            ООО «Продтовары»‎
                                        </div>
                                    </div>

                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="providers-list__table-sub-row providers-list__table-sub-row--secondary">
                                    <div class="providers-list__table-cell providers-list__table-cell--provider"></div>
                                    <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                        <div class="input-group providers-list__table-branch-input-group">
                                            <select>
                                                <option value="-1"></option>
                                                <option value="0">Коммунарка</option>
                                                <option value="1">Бутово</option>
                                            </select>
                                        </div>

                                        <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                            <input class="form-control">

                                            <div class="input-group-addon">
                                                <i class="fa fa-ruble-sign"></i>
                                            </div>
                                        </div>

                                        <button class="btn providers-list__table-button providers-list__table-remove-button">
                                            <i class="fa fa-times"></i>
                                        </button>

                                        <button class="btn providers-list__table-button providers-list__table-add-button">
                                            <i class="fa fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-p25 providers-list__save-button">Сохранить</button>
            </div>
        </div>
    </div>
</div>

@@include('include/_js.html')

<script type="text/javascript">
    $(document).ready(function () {
        initHatNavbar(document);

        class ProviderRow {
            isOpen = false;

            $element;
            $content;
            $toggle;
            $toggleIcon;
            $subRows;

            constructor(element) {
                this.$element = $(element);
                this.$content = this.$element.find('.providers-list__table-row-content');
                this.$toggle = this.$element.find('.providers-list__table-toggle');
                this.$toggleIcon = this.$toggle.find('i');
                this.$subRows = this.$element.find('.providers-list__table-sub-row');

                this._init();
            }

            _init() {
                this.$subRows.each((_, subRow) => this._initSubRow($(subRow)));

                const subRowHeight = this.$subRows.first().height();
                this.$element.height(subRowHeight);

                this._updateRemoveButtonState();

                // Автоматически добавляет пробелы в инпут для чисел
                this.$element.find('.providers-list__table-sub-row--main .providers-list__table-min-sum-input-group .form-control').on('keyup', function () {
                    this.value = this.value.replace(/ /g, '');
                    const number = this.value;
                    this.value = number.replace(/\B(?=(\d{3})+(?!\d))/g, " ");
                });

                this.$toggle.on('click', () => {
                    this.setOpen(!this.isOpen);
                });
            }

            _initSubRow($subRow) {
                $subRow.find('.providers-list__table-branch-input-group select').select2({
                    tags: true,
                    placeholder: {
                        id: '-1',
                        text: 'Выбрать филиал'
                    },
                    allowClear: true
                });

                $subRow.find('.providers-list__table-add-button').on('click', () => {
                    const newSubRow = $.parseHTML(`
                        <div class="providers-list__table-sub-row providers-list__table-sub-row--secondary">
                            <div class="providers-list__table-cell providers-list__table-cell--provider"></div>
                            <div class="providers-list__table-cell providers-list__table-cell--min-sum">
                                <div class="input-group providers-list__table-branch-input-group">
                                    <select>
                                        <option value="-1"></option>
                                        <option value="0">Коммунарка</option>
                                        <option value="1">Бутово</option>
                                    </select>
                                </div>

                                <div class="input-group providers-list__money-input-group providers-list__table-min-sum-input-group">
                                    <input class="form-control">

                                    <div class="input-group-addon">
                                        <i class="fa fa-ruble-sign"></i>
                                    </div>
                                </div>

                                <button class="btn providers-list__table-button providers-list__table-remove-button">
                                    <i class="fa fa-times"></i>
                                </button>

                                <button class="btn providers-list__table-button providers-list__table-add-button">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    `.trim());

                    this.$subRows = this.$subRows.add(newSubRow);

                    const $newSubRow = $(newSubRow);

                    this.$content.append($newSubRow);

                    this._initSubRow($newSubRow);

                    this._updateRemoveButtonState();

                    this.$element.animate({height: this.$content.height()}, 200);
                });

                $subRow.find('.providers-list__table-remove-button').on('click', () => {
                    $subRow.remove();

                    this.$subRows = this.$subRows.not($subRow);

                    this._updateRemoveButtonState();

                    this.$element.animate({height: this.$content.height()}, 200);
                });


                // Автоматически добавляет пробелы в инпут для чисел
                $subRow.find('.providers-list__table-min-sum-input-group .form-control').on('keyup', function () {
                    this.value = this.value.replace(/ /g, '');
                    const number = this.value;
                    this.value = number.replace(/\B(?=(\d{3})+(?!\d))/g, " ");
                });
            }

            _updateRemoveButtonState() {
                const $secondarySubRows = this.$subRows.filter('.providers-list__table-sub-row--secondary');
                const $removeButton = $secondarySubRows.first().find('.providers-list__table-remove-button');
                $removeButton.prop('disabled', $secondarySubRows.size() <= 1);
            }

            setOpen(isOpen) {
                this.isOpen = isOpen;

                this.$element.toggleClass('providers-list__table-row--open', this.isOpen);

                if (this.isOpen) {
                    this.$toggleIcon.removeClass('fa-chevron-circle-down');
                    this.$toggleIcon.addClass('fa-chevron-circle-up');
                    this.$element.animate({height: this.$content.height()}, 200);
                } else {
                    this.$toggleIcon.removeClass('fa-chevron-circle-up');
                    this.$toggleIcon.addClass('fa-chevron-circle-down');
                    const subRowHeight = this.$subRows.first().height();
                    this.$element.animate({height: subRowHeight}, 200);
                }
            }
        }

        $('.providers-list__table-row').each(function () {
            new ProviderRow(this);
        });
    });
</script>
</body>

<!-- TODO: удалить после перехода всех страниц на новое меню -->
<style>
    html, body {
        height: 100%;
    }

    body {
        padding: 0;
        min-height: unset !important;
    }
</style>

</html>
